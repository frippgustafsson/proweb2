<?xml version="1.0" encoding="UTF-8"?>
<Export generator="Cache" version="25" zv="Cache for Windows (x86-64) 2016.1.2 (Build 206U)" ts="2016-09-23 16:06:11">
<Class name="EF.contextDataRegistration">
<Description><![CDATA[
<!-- ;vc;-
;vc;    Object: EF.contextDataRegistration.CLS/EV.4
;vc; Component: CLS.EF.contextDataRegistration
;vc;  Location: SmallDev
;vc; Date/Time: 02-Sep-16 14:23
;vc;      User: JeremyW
;vc; --><p>VC/m status:<table id='vcm' border='1'><tr><th>Object</th><th>Component</th><th>Location</th><th>Date/Time</th><th>User</th></tr><tr><td>EF.contextDataRegistration.CLS/EV.4</td><td>CLS.EF.contextDataRegistration</td><td>SmallDev</td><td style='white-space: nowrap;'>02-Sep-16 14:23</td><td>JeremyW</td></tr></table>
]]></Description>
<Super>EF.contextData</Super>
<TimeChanged>64184,38522.395033</TimeChanged>
<TimeCreated>63755,56082.660879</TimeCreated>

<Property name="tempPurchaseID">
<Type>%Integer</Type>
</Property>

<Property name="isAmendment">
<Type>%Boolean</Type>
<InitialExpression>"0"</InitialExpression>
</Property>

<Property name="attendeeCategoryID">
<Type>%Integer</Type>
</Property>

<Property name="currencyID">
<Type>%Integer</Type>
</Property>

<Property name="tempPersonID">
<Type>%Integer</Type>
</Property>

<Property name="loggedInPersonID">
<Description>
if website is private, this will be set to the cod.objPerson.ID of that logged in person</Description>
<Type>%Integer</Type>
</Property>

<Property name="isBackendBooking">
<Type>%Boolean</Type>
<InitialExpression>"0"</InitialExpression>
</Property>

<Property name="pricingHorologUTC">
<Type>%Integer</Type>
</Property>

<Property name="isTestMode">
<Type>%Boolean</Type>
<InitialExpression>0</InitialExpression>
</Property>

<Property name="prowebMode">
<Type>%String</Type>
<Cardinality>one</Cardinality>
<Parameter name="VALUELIST" value=",&quot;edit&quot;,&quot;preview&quot;"/>
</Property>

<Property name="context">
<Type>%String</Type>
<InitialExpression>"registration"</InitialExpression>
</Property>

<Property name="backendPersonID">
<Type>%Integer</Type>
</Property>

<Property name="pageID">
<Type>%Integer</Type>
</Property>

<Property name="listID">
<Type>%Integer</Type>
</Property>

<Property name="isBackendSuperUser">
<Type>%Boolean</Type>
<InitialExpression>0</InitialExpression>
</Property>

<Property name="componentName">
<Type>%String</Type>
<Parameter name="MAXLEN" value="255"/>
</Property>

<Method name="createFromFrontendCSPSession">
<ClassMethod>1</ClassMethod>
<ReturnType>EF.contextDataRegistration</ReturnType>
<Implementation><![CDATA[
	#dim sessionID as %String = %session.SessionId
	
	set contextData = ##super()
	
	set contextData.tempPersonID=$G(%session.Data("eventsforce","frontend","currentPersonID"))
	set contextData.loggedInPersonID=$G(%session.Data("eventsforce","xtfrontend","MyAccount","personID"))
	set contextData.backendPersonID=$G(%session.Data("eventsforce","backend","xPersonID"))
	set contextData.attendeeCategoryID=##class(eCom.tempPurchase).getEventCategory(sessionID,contextData.tempPersonID)
	if contextData.attendeeCategoryID="" {
		if contextData.loggedInPersonID {
			// this will be used to restrict the categories of sessions in the daily agenda before registration
			set contextData.attendeeCategoryID=##class(links.lnkPersonEventCategory).getPreSelectedAttendeeCategoryID(contextData.eventID,contextData.loggedInPersonID)
		} else {
			set contextData.attendeeCategoryID = ##class(setup.lnkCategoryEvent).getDefault(contextData.eventID)	
		}
	}
	set contextData.currencyID=+##class(eCom.tempPurchase).getCurrencyID(sessionID)
	set contextData.isAmendment=+$G(%session.Data("eventsforce","frontend","amend"))
	set contextData.tempPurchaseID=##class(eCom.tempPerson).getTempPurchaseID(contextData.tempPersonID)
	set contextData.isBackendBooking=##class(eCom.tempPurchase).isBackendBooking(sessionID)
	set contextData.pricingHorologUTC=##class(eCom.tempPurchase).getPriceHorologUTC(contextData.tempPurchaseID)	
	set contextData.prowebMode=%session.Get("mode")
	set contextData.pageID=%session.Get("pageID")
	do contextData.setAuditPersonIDfromFrontend()
	
	set contextData.isBackendSuperUser=##class(eCom.tempPurchase).isBackendSuperUser(sessionID)
	
	return contextData
]]></Implementation>
</Method>

<Method name="createFromTempPersonID">
<ClassMethod>1</ClassMethod>
<FormalSpec>tempPersonID,langID,isAmendment:%Boolean</FormalSpec>
<ReturnType>EF.contextDataRegistration</ReturnType>
<Implementation><![CDATA[
	
	set contextData = ..%New()
	set tempPerson=##class(eCom.tempPerson).%OpenId(tempPersonID)
	do tempPerson.%Reload()
	
	set contextData.tempPurchaseID=tempPerson.tempPurchase.%Id()
	
	set controllerID=tempPerson.tempPurchase.objController.%Id()
	set contextData.eventID=##class(eCom.objController).getEventID(controllerID)
	set contextData.languageID=langID
	set contextData.tempPersonID=tempPerson.%Id()
	set contextData.sessionID=tempPerson.tempPurchase.sessionID
	set contextData.loggedInPersonID=""
	
	set contextData.attendeeCategoryID=##class(eCom.tempPurchase).getEventCategory(contextData.sessionID,contextData.tempPersonID)
	if contextData.attendeeCategoryID="" {
		if contextData.loggedInPersonID {
			// this will be used to restrict the categories of sessions in the daily agenda before registration
			set contextData.attendeeCategoryID=##class(links.lnkPersonEventCategory).getPreSelectedAttendeeCategoryID(contextData.eventID,contextData.loggedInPersonID)
		} else {
			set contextData.attendeeCategoryID = ##class(setup.lnkCategoryEvent).getDefault(contextData.eventID)	
		}
	}
	set contextData.currencyID=+##class(eCom.tempPurchase).getCurrencyID(contextData.sessionID)
	set contextData.isAmendment=isAmendment
	
	set contextData.isBackendBooking=##class(eCom.tempPurchase).isBackendBooking(contextData.sessionID)
	set contextData.pricingHorologUTC=##class(eCom.tempPurchase).getPriceHorologUTC(contextData.tempPurchaseID)	
	set contextData.prowebMode=""
	
	do contextData.setAuditPersonIDfromFrontend()
	if contextData.auditPersonID = "" {
		do contextData.setAuditPersonIDfromBackend()	
	}
	kill tempPerson
	return contextData
]]></Implementation>
</Method>

<Method name="createMock">
<ClassMethod>1</ClassMethod>
<ReturnType>EF.contextDataRegistration</ReturnType>
<Implementation><![CDATA[
	#dim mockpersonID as %Integer = 1
	
	set contextData = ..%New()
	
	set contextData.eventID=1
	set contextData.languageID=1
	set contextData.tempPersonID=mockpersonID
	set contextData.loggedInPersonID=mockpersonID
	set contextData.attendeeCategoryID=1
	set contextData.currencyID=1
	set contextData.isAmendment=0
	set contextData.tempPurchaseID=1
	set contextData.isBackendBooking=0
	set contextData.pricingHorologUTC=##class(shared.timeFunctions).getCurrentHorologUTC()
	set contextData.prowebMode="preview"
	set contextData.sessionID="mockSession"
	
	return contextData
]]></Implementation>
</Method>

<Method name="isMockSession">
<ReturnType>%Boolean</ReturnType>
<Implementation><![CDATA[	return ..sessionID = "mockSession"
]]></Implementation>
</Method>
</Class>


<Class name="EF.contextDataRegistrationMock">
<Description><![CDATA[
<!-- ;vc;-
;vc;    Object: EF.contextDataRegistration.CLS/EV.4
;vc; Component: CLS.EF.contextDataRegistration
;vc;  Location: SmallDev
;vc; Date/Time: 02-Sep-16 14:23
;vc;      User: JeremyW
;vc; --><p>VC/m status:<table id='vcm' border='1'><tr><th>Object</th><th>Component</th><th>Location</th><th>Date/Time</th><th>User</th></tr><tr><td>EF.contextDataRegistration.CLS/EV.4</td><td>CLS.EF.contextDataRegistration</td><td>SmallDev</td><td style='white-space: nowrap;'>02-Sep-16 14:23</td><td>JeremyW</td></tr></table>
]]></Description>
<Super>EF.contextDataRegistration</Super>
<TimeChanged>64178,51986.405601</TimeChanged>
<TimeCreated>63755,56082.660879</TimeCreated>

<Property name="tempPurchaseID">
<Type>%Integer</Type>
</Property>

<Property name="isAmendment">
<Type>%Boolean</Type>
<InitialExpression>"0"</InitialExpression>
</Property>

<Property name="attendeeCategoryID">
<Type>%Integer</Type>
</Property>

<Property name="currencyID">
<Type>%Integer</Type>
</Property>

<Property name="tempPersonID">
<Type>%Integer</Type>
</Property>

<Property name="loggedInPersonID">
<Description>
if website is private, this will be set to the cod.objPerson.ID of that logged in person</Description>
<Type>%Integer</Type>
</Property>

<Property name="isBackendBooking">
<Type>%Boolean</Type>
<InitialExpression>"0"</InitialExpression>
</Property>

<Property name="pricingHorologUTC">
<Type>%Integer</Type>
</Property>

<Property name="isTestMode">
<Type>%Boolean</Type>
<InitialExpression>0</InitialExpression>
</Property>

<Property name="prowebMode">
<Type>%String</Type>
<Cardinality>one</Cardinality>
<Parameter name="VALUELIST" value=",&quot;edit&quot;,&quot;preview&quot;"/>
</Property>

<Property name="context">
<Type>%String</Type>
<InitialExpression>"registration"</InitialExpression>
</Property>

<Property name="backendPersonID">
<Type>%Integer</Type>
</Property>

<Property name="pageID">
<Type>%Integer</Type>
</Property>

<Property name="listID">
<Type>%Integer</Type>
</Property>

<Property name="isBackendSuperUser">
<Type>%Boolean</Type>
<InitialExpression>0</InitialExpression>
</Property>

<Method name="createNew">
<ClassMethod>1</ClassMethod>
<ReturnType>EF.contextDataRegistration</ReturnType>
<Implementation><![CDATA[
	#dim mockTempPersonID as %Integer = 100
	#dim mockBackendUserD as %Integer = 1
	#dim mockEventID as %Integer = 15235
	#dim mockPageID as %Integer = 122589
	
	
	set contextData = ..%New()
	
	set contextData.componentName = "Main List"
	set contextData.eventID = mockEventID
	set contextData.pageID = mockPageID
	set contextData.languageID=1
	set contextData.tempPersonID = mockTempPersonID
	set contextData.loggedInPersonID = mockBackendUserD
	set contextData.attendeeCategoryID=1
	set contextData.currencyID=1
	set contextData.isAmendment=0
	set contextData.tempPurchaseID=1
	set contextData.isBackendBooking=0
	set contextData.pricingHorologUTC=##class(shared.timeFunctions).getCurrentHorologUTC()
	set contextData.prowebMode="preview"
	set contextData.sessionID="mockSession"
	
	return contextData
]]></Implementation>
</Method>
</Class>


<Class name="EF.pageController.page">
<Description><![CDATA[
<!-- ;vc;-
;vc;    Object: EF.pageController.page.CLS/EV.14
;vc; Component: CLS.EF.pageController.page
;vc;  Location: SmallDev
;vc; Date/Time: 02-Sep-16 14:23
;vc;      User: JeremyW
;vc; --><p>VC/m status:<table id='vcm' border='1'><tr><th>Object</th><th>Component</th><th>Location</th><th>Date/Time</th><th>User</th></tr><tr><td>EF.pageController.page.CLS/EV.14</td><td>CLS.EF.pageController.page</td><td>SmallDev</td><td style='white-space: nowrap;'>02-Sep-16 14:23</td><td>JeremyW</td></tr></table>
]]></Description>
<Super>EF.pageController.containerElement</Super>
<TimeChanged>64184,53691.423295</TimeChanged>
<TimeCreated>63350,62788.509584</TimeCreated>

<Property name="sessionID">
<Type>%String</Type>
<Required>1</Required>
<Parameter name="MAXLEN" value="250"/>
<Parameter name="TRUNCATE" value="1"/>
</Property>

<Property name="objEvent">
<Type>setup.objEvent</Type>
</Property>

<Property name="identifier">
<Type>%String</Type>
<InitialExpression>"page_controller"</InitialExpression>
<Required>1</Required>
</Property>

<Parameter name="returnPage">
</Parameter>

<Property name="allPageElements">
<Type>EF.pageController.element</Type>
<Collection>array</Collection>
<Transient>1</Transient>
</Property>

<Property name="hasError">
<Type>%Boolean</Type>
<InitialExpression>0</InitialExpression>
</Property>

<Property name="isPageReadOnly">
<Type>%Boolean</Type>
<InitialExpression>0</InitialExpression>
</Property>

<Property name="isReload">
<Type>%Boolean</Type>
<InitialExpression>0</InitialExpression>
<Transient>1</Transient>
</Property>

<Property name="submitButtonClickedIdentifier">
<Type>%String</Type>
<Transient>1</Transient>
<Parameter name="MAXLEN" value="255"/>
</Property>

<Property name="allAJAXPageElements">
<Type>EF.pageController.element</Type>
<Collection>array</Collection>
<Transient>1</Transient>
</Property>

<Property name="contextData">
<Type>EF.contextData</Type>
<Transient>1</Transient>
</Property>

<Property name="warningMessages">
<Type>%String</Type>
<Transient>1</Transient>
<Parameter name="MAXLEN" value="32000"/>
</Property>

<Property name="isSettingsPageModal">
<Type>%Boolean</Type>
<InitialExpression>0</InitialExpression>
</Property>

<Property name="requestData">
<Type>%ArrayOfDataTypes</Type>
</Property>

<Property name="eventConfiguration">
<Type>setup.eventConfiguration</Type>
<Transient>1</Transient>
</Property>

<Parameter name="isSystemPage">
<Default>0</Default>
</Parameter>

<Parameter name="useAutomaticAudit">
<Default>1</Default>
</Parameter>

<Index name="sessionIDIndex">
<Properties>sessionID</Properties>
</Index>

<Method name="createNew">
<ClassMethod>1</ClassMethod>
<FormalSpec><![CDATA[contextData:EF.contextData,&arrayOfRequestData:%String,clearDown=1,eventConfiguration:setup.eventConfiguration]]></FormalSpec>
<ReturnType>EF.pageController.page</ReturnType>
<Implementation><![CDATA[
	set pageController=..%New()
	set pageController.sessionID=contextData.sessionID
	if (pageController.isSystemPage() = 0)&&(contextData.eventID) {
		do pageController.objEventSetObjectId(contextData.eventID)
	}
	do pageController.createRequestData(.arrayOfRequestData)
	set pageController.contextData = contextData
	set pageController.page=pageController
	do pageController.allPageElements.SetAt(pageController,pageController.identifier)
	if clearDown {
		do pageController.clearDownOld()
		do pageController.deleteForCurrentSession()
	}
	do pageController.%Save()
	if $D(eventConfiguration) {
		set pageController.eventConfiguration=eventConfiguration	
	}
	do pageController.load()
	return pageController
]]></Implementation>
</Method>

<Method name="getEventConfiguration">
<Implementation><![CDATA[
	if '$IsObject(..eventConfiguration) {
		do ..loadEventConfiguration()
	} 
	return ..eventConfiguration
]]></Implementation>
</Method>

<Method name="loadEventConfiguration">
<Implementation><![CDATA[	set ..eventConfiguration=##class(setup.eventConfiguration).createForEventID(..getEventID())
]]></Implementation>
</Method>

<Method name="open">
<ClassMethod>1</ClassMethod>
<FormalSpec>pageControllerID,contextData:EF.contextData</FormalSpec>
<ReturnType>EF.pageController.page</ReturnType>
<Implementation><![CDATA[
	set pageController=##class(EF.pageController.page).%OpenId(pageControllerID)
	do pageController.%Reload()
	if (pageController.sessionID'=contextData.sessionID) {
		throw ##class(shared.exceptions.generalException).%New("Invalid session for page")	
	}
	if (pageController.isSystemPage() = 0) {
		if (pageController.objEvent.%Id() '= contextData.eventID) {
			throw ##class(shared.exceptions.generalException).%New("Invalid event for page")	
		}
	}
	set pageController.contextData = contextData
	do pageController.updateAllPageElements()
	do pageController.reloadUIComponents()
	set pageController.isReload=1
	do pageController.load()
	quit pageController
]]></Implementation>
</Method>

<Method name="createRequestData">
<FormalSpec><![CDATA[&arrayOfRequestData:%String]]></FormalSpec>
<Implementation><![CDATA[
	set name=""
	for {
		set name=$O(arrayOfRequestData(name))
		if name="" quit
		set value=$G(arrayOfRequestData(name))
		do ..requestData.SetAt(value,name)	
	}
]]></Implementation>
</Method>

<Method name="load">
<Implementation><![CDATA[
	do ..loadData()
	do ..updateUIComponents()
]]></Implementation>
</Method>

<Method name="save">
<Implementation><![CDATA[
	if '(..isPageReadOnly) {
		do ..saveData()
		do ..saveInFormModals()
		if ..#useAutomaticAudit {
			do ..auditChanges()
		}
	}
]]></Implementation>
</Method>

<Method name="saveInFormModals">
<Implementation><![CDATA[
	set key=""
	for {
		set element=..allPageElements.GetNext(.key)
		if key="" quit
		if ($IsObject(element))&&(element.%IsA("EF.pageController.buttons.openInFormModal")) {
			do element.modalContents.save()
		}
 	}
]]></Implementation>
</Method>

<Method name="isSystemPage">
<Implementation><![CDATA[	return ..#isSystemPage
]]></Implementation>
</Method>

<Method name="saveData">
<Implementation><![CDATA[	throw ##class(shared.exceptions.generalException).%New("Not implemented")
]]></Implementation>
</Method>

<Method name="processDelete">
<FormalSpec>deleteButtonIdentifier</FormalSpec>
<Implementation><![CDATA[
	set deleteButton=..getElementByIdentifier(deleteButtonIdentifier)
	set deleteMethod=deleteButton.deleteMethod
	do $Method($this,deleteMethod,deleteButton)
]]></Implementation>
</Method>

<Method name="auditChanges">
<Implementation><![CDATA[
	set key=""
	do {
		set element=..allPageElements.GetNext(.key)
		if ('$IsObject(element)) continue
	    if element.isUpdated() {
		 	do element.auditLine()   
	    }
 	} While (key '= "")
]]></Implementation>
</Method>

<Method name="clearDownOld">
<Description>
Clear down all data from more than 2 days old</Description>
<ClassMethod>1</ClassMethod>
<FormalSpec>daysToKeep=2</FormalSpec>
<ReturnType>%String</ReturnType>
<Implementation><![CDATA[
	set rs=##class(%ResultSet).%New("%Library.DynamicQuery:SQL")
	set query="SELECT ID FROM EF_pageController.page WHERE xCRstamp < DATEADD(dd,?,CURRENT_TIMESTAMP)"
	do rs.Prepare(query)
	do rs.Execute(-daysToKeep)
	while rs.Next()	{
		set pageController=##class(EF.pageController.page).%OpenId(rs.Get("ID"),,.sc)
		if 'sc {
			throw ##class(shared.exceptions.generalStatusException).CreateFromStatus(sc)	
		}
		do pageController.delete()
	}
]]></Implementation>
</Method>

<Method name="deleteForCurrentSession">
<Description>
Deletes old data with the same sessionID and loadingClass</Description>
<Implementation><![CDATA[
	set rs=##class(%ResultSet).%New("%Library.DynamicQuery:SQL")
	Set tableName=##class(EF.utils.classes).getFullTableRefFromFullClassName(..%ClassName(1))
	set query="SELECT ID FROM "_##class(EF.encoders.sql).encodeTableName(tableName)_" WHERE (sessionID = ?)"
	do rs.Prepare(query)
	do rs.Execute(..sessionID)
	while rs.Next()	{
		set pageController=##class(EF.pageController.page).%OpenId(rs.Get("ID"))
		do pageController.delete()
	}
]]></Implementation>
</Method>

<Method name="clearDownModalTempData">
<Description>
Clears down elements with isModalTempData = 1 before loading the page</Description>
<ClassMethod>1</ClassMethod>
<FormalSpec>pageControllerID</FormalSpec>
<Implementation><![CDATA[
	set query="SELECT ID FROM EF_pageController.element WHERE page = ? AND isModalTempData = 1"
	set rs=##class(%ResultSet).%New("%Library.DynamicQuery:SQL")
	do rs.Prepare(query)
	do rs.Execute(pageControllerID)
	while rs.Next()	{
		set element=##class(EF.pageController.element).%OpenId(rs.Get("ID"),,.sc)
		if $IsObject(element) {
			do element.delete()
		}
	}
]]></Implementation>
</Method>

<Method name="removeModalTempDataFlagForPage">
<ClassMethod>1</ClassMethod>
<FormalSpec>pageControllerID</FormalSpec>
<Implementation><![CDATA[
	&SQL(UPDATE EF_pageController.element 
		SET isModalTempData=0
		WHERE page = :pageControllerID AND isModalTempData = 1
	)
]]></Implementation>
</Method>

<Method name="canUpdate">
<Description>
Checks whether we are allowed to update this data set</Description>
<FormalSpec>sessionID</FormalSpec>
<ReturnType>%String</ReturnType>
<Implementation><![CDATA[
	set ok=0
	set (userID,function)=""
	&SQL(SELECT xCRUserID,function INTO :tmp,:tmp2 FROM pageClasses.objPageDataPageDetails
		WHERE sessionID = :sessionID
		AND loadingClass=:loadingClass
		AND ID = :pageDataPageDetailsID
	)
	if +SQLCODE=0 {
		set ok=1
		set userID=tmp,function=tmp2
	}
	if $l(function) {
		if '##class(access.objFunction).hasFunctionByAccessID(userID,function) {	
			set ok=0
		}
	}
	quit ok
]]></Implementation>
</Method>

<Method name="getElementByIdentifier">
<FormalSpec>identifier</FormalSpec>
<ReturnType>EF.pageController.element</ReturnType>
<Implementation><![CDATA[
	set element=..allPageElements.GetAt(identifier)	
 	quit element
]]></Implementation>
</Method>

<Method name="renderHTMLControlFromTag">
<FormalSpec><![CDATA[&attrs]]></FormalSpec>
<Implementation><![CDATA[
	
	set identifier=$G(attrs("identifier"))
	set element=..getElementByIdentifier(identifier)
	if $IsObject(element) {
		do element.render()
	} elseif $Get(attrs("prowebcomponentname"))'="" {
		set pageID = $Get(attrs("pageid"))
		if 'pageID {
			throw ##class(shared.exceptions.generalException).%New("No pageID passed in")
		}
		do ##class(EF.pages.frontend.base).outputProwebListRowsExperimental(attrs("prowebcomponentname"), pageID) 
	}
	quit
]]></Implementation>
</Method>

<Method name="renderContainerStartFromTag">
<FormalSpec><![CDATA[&attrs]]></FormalSpec>
<Implementation><![CDATA[
	set uiComponent=..getUIComponentFromTag(.attrs)
	if $IsObject(uiComponent) {
		do uiComponent.renderStart()
	}
	quit
]]></Implementation>
</Method>

<Method name="renderContainerEndFromTag">
<FormalSpec><![CDATA[&attrs]]></FormalSpec>
<Implementation><![CDATA[
	set uiComponent=..getUIComponentFromTag(.attrs)
	if $IsObject(uiComponent) {
		do uiComponent.renderEnd()
	}
	quit
]]></Implementation>
</Method>

<Method name="getUIComponentFromTag">
<FormalSpec><![CDATA[&attrs]]></FormalSpec>
<ReturnType>EF.ui.components.base</ReturnType>
<Implementation><![CDATA[
	set identifier=$G(attrs("identifier"))
	set type=$G(attrs("type"))
	set uiComponent=""
	if $l(identifier) {
		set element=..getElementByIdentifier(identifier)
		if $IsObject(element) {
			set uiComponent=element.uiComponent
		}
	} elseif $l(type) {
		set uiComponent=$CASE(type,
			"column":..getUIComponentColumnFromTag(.attrs),
			"well":..getUIComponentWellFromTag(.attrs),
			"row":..getUIComponentRowFromTag(.attrs),
			"modal-body":..getUIComponentModalBodyFromTag(.attrs),
			"panel-body":..getUIComponentPanelBodyFromTag(.attrs),
			"modal-footer":..getUIComponentModalFooterFromTag(.attrs),
			:""
		)
	}
	quit uiComponent
]]></Implementation>
</Method>

<Method name="getUIComponentModalBodyFromTag">
<FormalSpec><![CDATA[&attrs]]></FormalSpec>
<ReturnType>EF.ui.components.backend.well</ReturnType>
<Implementation><![CDATA[
	set uiComponent=##class(EF.ui.components.backend.modalBody).%New()
	
	quit uiComponent
]]></Implementation>
</Method>

<Method name="getUIComponentPanelBodyFromTag">
<FormalSpec><![CDATA[&attrs]]></FormalSpec>
<ReturnType>EF.ui.components.backend.well</ReturnType>
<Implementation><![CDATA[
	set uiComponent=##class(EF.ui.components.backend.panelBody).%New()
	
	quit uiComponent
]]></Implementation>
</Method>

<Method name="getUIComponentModalFooterFromTag">
<FormalSpec><![CDATA[&attrs]]></FormalSpec>
<ReturnType>EF.ui.components.backend.well</ReturnType>
<Implementation><![CDATA[
	set uiComponent=##class(EF.ui.components.backend.modalFooter).%New()
	
	quit uiComponent
]]></Implementation>
</Method>

<Method name="getUIComponentWellFromTag">
<FormalSpec><![CDATA[&attrs]]></FormalSpec>
<ReturnType>EF.ui.components.backend.well</ReturnType>
<Implementation><![CDATA[
	set width=$G(attrs("width"))
	set uiComponent=##class(EF.ui.components.backend.well).%New()
	if width {
		set uiComponent.width=width
	}
	quit uiComponent
]]></Implementation>
</Method>

<Method name="getUIComponentColumnFromTag">
<FormalSpec><![CDATA[&attrs]]></FormalSpec>
<ReturnType>EF.ui.components.backend.well</ReturnType>
<Implementation><![CDATA[
	set width=$G(attrs("width"))
	set uiComponent=##class(EF.ui.components.backend.column).%New()
	if width {
		set uiComponent.width=width
	}
	quit uiComponent
]]></Implementation>
</Method>

<Method name="getUIComponentRowFromTag">
<FormalSpec><![CDATA[&attrs]]></FormalSpec>
<ReturnType>EF.ui.components.backend.well</ReturnType>
<Implementation><![CDATA[
	set uiComponent=##class(EF.ui.components.backend.row).%New()
	quit uiComponent
]]></Implementation>
</Method>

<Method name="showElementFromTag">
<FormalSpec><![CDATA[&attrs]]></FormalSpec>
<Implementation><![CDATA[
	set show=0
	set type=$G(attrs("type"))
	if $l(type) {
		set show=1
	} else {
		set identifier=$G(attrs("identifier"))
		set element=..getElementByIdentifier(identifier)
		if $IsObject(element) {
			set show=1
		}
	}
	quit show
]]></Implementation>
</Method>

<Method name="reloadUIComponents">
<Implementation><![CDATA[
	set key=""
	for {
		set element=..allPageElements.GetNext(.key)
		if key="" quit
		if '$IsObject(element.uiComponent) {
			do element.reloadUIComponent()
		}
 	}
]]></Implementation>
</Method>

<Method name="updateUIComponents">
<Implementation><![CDATA[
	set key=""
	for {
		set element=..allPageElements.GetNext(.key)
		if key="" quit
	    do element.updateUIComponent()
 	}
]]></Implementation>
</Method>

<Method name="updateUIComponent">
<Implementation><![CDATA[	quit
]]></Implementation>
</Method>

<Method name="updateFromRequest">
<Implementation><![CDATA[
	set key=""
	do {
		set element=..allPageElements.GetNext(.key)
		if ('$IsObject(element)) continue
	    do element.updateValueFromRequest()
 	} While (key '= "")
]]></Implementation>
</Method>

<Method name="validatePage">
<Implementation><![CDATA[
	set ..hasError=0
	do ..validateElement()
	if '..hasError {
	 	do ..validate()
	}
 	do ..updateErrorMessages()
]]></Implementation>
</Method>

<Method name="isAnyElementUpdated">
<Implementation><![CDATA[
	set isUpdated=0
	set key=""
	for {
		set element=..allPageElements.GetNext(.key)
		if key="" quit
		if element.isUpdated() {
			set isUpdated=1	
		}
 	}	
 	quit isUpdated
]]></Implementation>
</Method>

<Method name="existsByIdentifier">
<FormalSpec>identifier</FormalSpec>
<ReturnType>%Boolean</ReturnType>
<Implementation><![CDATA[
	set out=0
	set element=..getElementByIdentifier(identifier)
	if $IsObject(element) {
		set out=1
	}
	quit out
]]></Implementation>
</Method>

<Method name="isUpdatedByIdentifier">
<FormalSpec>identifier</FormalSpec>
<ReturnType>%Boolean</ReturnType>
<Implementation><![CDATA[
	set isUpdated=0
	set element=..getElementByIdentifier(identifier)
	if $IsObject(element) {
		set isUpdated=element.isUpdated()
	}
	quit isUpdated
]]></Implementation>
</Method>

<Method name="getValueByIdentifier">
<FormalSpec>identifier</FormalSpec>
<ReturnType>%String</ReturnType>
<Implementation><![CDATA[
	set element=..getElementByIdentifier(identifier)
	if '$IsObject(element) throw ##class(shared.exceptions.generalException).%New("identifier does not exist")
	quit element.value
]]></Implementation>
</Method>

<Method name="getErrorDisplayElement">
<ReturnType>EF.pageController.element</ReturnType>
<Implementation><![CDATA[
	set key=""
	for {
		set element=..elementChildren.GetNext(.key)
		if key="" quit
		if element.%IsA("EF.pageController.containerElements.panel") {
			return element	
		}
 	}
 	return $this
]]></Implementation>
</Method>

<Method name="addErrorMessagesToElement">
<FormalSpec>elementIdentifier:%String,listOfErrors:%ListOfDataTypes</FormalSpec>
<Implementation><![CDATA[
	set element=..getElementByIdentifier(elementIdentifier)
	for i=1:1:listOfErrors.Count() {
		do element.setErrorMessage(listOfErrors.GetAt(i))	
	}
]]></Implementation>
</Method>

<Method name="setErrorMessage">
<FormalSpec>errorMessage</FormalSpec>
<Implementation><![CDATA[
	set panel=..getErrorDisplayElement()
	if panel'=$this {
		do panel.setErrorMessage(errorMessage)
	}
	do ##super(errorMessage)
]]></Implementation>
</Method>

<Method name="getDataSetForElement">
<FormalSpec>elementID</FormalSpec>
<Implementation><![CDATA[
	set chartElement=..getElementByIdentifier(elementID)
	return chartElement.getDataSet()
]]></Implementation>
</Method>

<Method name="loadData">
</Method>

<Method name="validate">
<Implementation><![CDATA[	Throw ##class(shared.exceptions.generalException).%New("Not implemented")
]]></Implementation>
</Method>

<Method name="getSuccessURL">
<Implementation><![CDATA[	return ..#returnPage
]]></Implementation>
</Method>

<Method name="getAJAXUpdateReturnData">
<Description>
This can be used to return data from a modal when saved via ajax.</Description>
<ReturnType>%ZEN.proxyObject</ReturnType>
<Implementation><![CDATA[	return ""
]]></Implementation>
</Method>

<Storage name="Default">
<Type>%Library.CacheStorage</Type>
<DefaultData>pageDefaultData</DefaultData>
<Data name="pageDefaultData">
<Subscript>"page"</Subscript>
<Value name="1">
<Value>sessionID</Value>
</Value>
<Value name="2">
<Value>objEvent</Value>
</Value>
<Value name="3">
<Value>hasError</Value>
</Value>
<Value name="4">
<Value>isPageReadOnly</Value>
</Value>
<Value name="5">
<Value>isSettingsPageModal</Value>
</Value>
<Value name="6">
<Value>requestData</Value>
</Value>
</Data>
</Storage>
</Class>


<Class name="EF.pageController.proweb.list">
<Description>
a list of proweb items</Description>
<Super>%RegisteredObject</Super>
<TimeChanged>64183,52826.49015</TimeChanged>
<TimeCreated>63992,66338.902496</TimeCreated>

<Property name="listItems">
<Type>EF.pageController.proweb.listItem</Type>
<Collection>list</Collection>
</Property>

<Property name="contextDataRegistration">
<Type>EF.contextDataRegistration</Type>
<Required>1</Required>
</Property>

<Property name="isProwebEditMode">
<Type>%Boolean</Type>
<Required>1</Required>
</Property>

<Method name="createNew">
<ClassMethod>1</ClassMethod>
<FormalSpec>contextDataRegistration:EF.contextDataRegistration</FormalSpec>
<ReturnType>EF.pageController.proweb.list</ReturnType>
<Implementation><![CDATA[
	set list = ..%New()
	set list.contextDataRegistration = contextDataRegistration
	return list
]]></Implementation>
</Method>

<Method name="populateFromListObject">
<FormalSpec>objList:sc.xModules.objList</FormalSpec>
<Implementation><![CDATA[
	#dim listItem as EF.pageController.proweb.listItem
	#dim previousGuestItem as EF.pageController.proweb.listItem
	#dim inputElement as EF.pageController.proweb.listItems.inputElementCOD
	
	if '$IsObject(objList) throw ##class(shared.exceptions.generalException).%New("No list object passed in to populate EF.pageController.proweb.list")
	
	set rsListItems=##class(%ResultSet).%New("sc.xModules.objList:qGetChildren")
	do rsListItems.Execute(objList.%Id())
	while rsListItems.Next() {	
		set dataID = rsListItems.Get("ID")
		set prowebItem = ##class(sc.objData).%OpenId(dataID)

		set listItem = ..createControllerForProwebItem(prowebItem)
		
		if listItem.isOkToAddToList() {
			do ..addListItem(listItem)
		}
	}
]]></Implementation>
</Method>

<Method name="createControllerForProwebItem">
<FormalSpec>prowebItem</FormalSpec>
<Private>1</Private>
<Implementation><![CDATA[
	if prowebItem.dataType = "objCODitem" { 
		set listItem = ##class(EF.pageController.proweb.listItems.inputElementCOD).%New()
		do listItem.populateFromProwebItem(prowebItem, ..contextDataRegistration)
		set listItem.uiComponentType = listItem.getUiComponentTypeFromProwebItem(prowebItem)
		
	} elseif prowebItem.dataType = "objText" {
		set listItem = ##class(EF.pageController.proweb.listItems.textBlock).%New()
		do listItem.populateFromProwebObject(prowebItem)
	
	} elseif prowebItem.dataType = "objFormDivider" {
		set listItem = ##class(EF.pageController.proweb.listItems.divider).%New()

	} else {
		throw ##class(shared.exceptions.generalException).%New("proweb item type not implemented yet")	
	}
	
	return listItem
]]></Implementation>
</Method>

<Method name="addListItem">
<FormalSpec>listItem:EF.pageController.proweb.listItem</FormalSpec>
<Implementation><![CDATA[
	do ..listItems.Insert(listItem)
	set listItem.htmlID = ..generateHtmlID(..listItems.Count())
]]></Implementation>
</Method>

<Method name="generateHtmlID">
<FormalSpec>displayOrder:%Integer</FormalSpec>
<Private>1</Private>
<ReturnType>%String</ReturnType>
<Implementation><![CDATA[
	set baseName = $Replace(..contextDataRegistration.componentName," ","")
	return ##class(shared.stringFunctions).encryptURLsafe(baseName_"|"_displayOrder) // ## may need enhancing ##
]]></Implementation>
</Method>

<Method name="render">
<Implementation><![CDATA[
	#dim listItem As EF.pageController.proweb.listItem
	#dim displayOrder as %Integer=0
	
	for  {
		set listItem = ..listItems.GetNext(.displayOrder)
		if displayOrder="" quit
		
		do listItem.render() 
	}
]]></Implementation>
</Method>

<Method name="debugTarget">
<ClassMethod>1</ClassMethod>
<Implementation><![CDATA[
	#dim contextData as EF.contextDataRegistrationMock
	set contextData = ##class(EF.contextDataRegistrationMock).createNew()

	set list = ##class(EF.pageController.proweb.list).createNew(contextData)
	set listID = ##class(sc.xModules.objList).getListIDFromPageIDAndComponentName(contextData.pageID, contextData.componentName)
	
	set listObject=##class(sc.xModules.objList).%OpenId(listID)
	do list.populateFromListObject(listObject)

	do list.render()
]]></Implementation>
</Method>
</Class>


<Class name="EF.pageController.proweb.listItem">
<Super>%RegisteredObject,EF.htmlGenerator</Super>
<TimeChanged>64183,55165.520408</TimeChanged>
<TimeCreated>63992,65826.878579</TimeCreated>

<Property name="htmlID">
<Type>%String</Type>
<Parameter name="MAXLEN" value="255"/>
</Property>

<Property name="uiComponentType">
<Type>%String</Type>
<Required>1</Required>
<Parameter name="VALUELIST" value=",textInput"/>
</Property>

<Method name="isOkToAddToList">
<ReturnType>%Boolean</ReturnType>
<Implementation><![CDATA[	return 1
]]></Implementation>
</Method>

<Method name="render">
<Implementation><![CDATA[	// not implemented
]]></Implementation>
</Method>

<Method name="getUiComponentTypeFromProwebItem">
<FormalSpec>prowebItem:sc.objData</FormalSpec>
<ReturnType>%String</ReturnType>
<Implementation><![CDATA[
	// ",text,textarea,radiobutton,checkbox,dropdown,password,multibox,date,dateRange,time,emailAddress,multiEmailAddress,phoneNumber,integer,floatingPointNumber,webAddress"
	
	if prowebItem.type = "text" {
		return "textInput"
	
	} elseif prowebItem.type = "dropdown" {
		return "dropdown"
			
	} else {
		throw ##class(shared.exceptions.generalException).%New("Failed to resolve the UI component type")	
	}
]]></Implementation>
</Method>
</Class>


<Class name="EF.pageController.proweb.listItems.alternative">
<Description>
Hold the alternatives to dropdown, radios, multi check etc</Description>
<Super>%RegisteredObject</Super>
<TimeChanged>64183,61178.131402</TimeChanged>
<TimeCreated>64183,56080.501584</TimeCreated>

<Property name="label">
<Type>%String</Type>
<Parameter name="MAXLEN" value="32000"/>
</Property>

<Property name="code">
<Type>%String</Type>
<Parameter name="MAXLEN" value="32000"/>
</Property>

<Property name="isSelected">
<Type>%Boolean</Type>
<InitialExpression>0</InitialExpression>
</Property>

<Property name="isDisabled">
<Type>%Boolean</Type>
<InitialExpression>0</InitialExpression>
</Property>

<Property name="value">
<Type>%String</Type>
<Parameter name="MAXLEN" value="255"/>
</Property>
</Class>


<Class name="EF.pageController.proweb.listItems.divider">
<Super>EF.pageController.proweb.listItem</Super>
<TimeChanged>64183,53088.836253</TimeChanged>
<TimeCreated>64183,52893.320101</TimeCreated>

<Method name="render">
<Implementation><![CDATA[
	set uiComponent = ##class(EF.ui.components.frontend.divider).%New(..htmlID)
	do uiComponent.render()
]]></Implementation>
</Method>
</Class>


<Class name="EF.pageController.proweb.listItems.inputElement">
<Super>EF.pageController.proweb.listItem</Super>
<TimeChanged>64184,57523.551809</TimeChanged>
<TimeCreated>63992,62141.625478</TimeCreated>

<Property name="alternatives">
<Type>EF.pageController.proweb.listItems.alternative</Type>
<Collection>list</Collection>
</Property>

<Property name="labelText">
<Type>%String</Type>
<Parameter name="MAXLEN" value="32000"/>
</Property>

<Property name="isMandatory">
<Type>%Boolean</Type>
</Property>

<Property name="helpText">
<Type>%String</Type>
<Parameter name="MAXLEN" value="32000"/>
</Property>

<Property name="value">
<Type>%String</Type>
<Parameter name="MAXLEN" value="32000"/>
</Property>

<Method name="render">
<Implementation><![CDATA[
	#dim uiComponent as EF.ui.components.base
	set uiComponent = $CLASSMETHOD("EF.ui.components.frontend."_..uiComponentType,"%New",..htmlID)
	set uiComponent.label = ..labelText
	set uiComponent.isMandatory = ..isMandatory
	set uiComponent.helpText = ..helpText
	set uiComponent.value = ..value
	set uiComponent.alternatives = ..alternatives
	do uiComponent.render()
]]></Implementation>
</Method>
</Class>


<Class name="EF.pageController.proweb.listItems.inputElementCOD">
<Description>
Used for all input field on a registration page that are regular database items, as opposed to table booking and ticketing questions.</Description>
<Super>EF.pageController.proweb.listItems.inputElement</Super>
<TimeChanged>64184,57891.714083</TimeChanged>
<TimeCreated>64055,42548.552153</TimeCreated>

<Method name="populateFromProwebItem">
<FormalSpec>prowebItem:sc.objData,contextDataRegistration:EF.contextDataRegistration</FormalSpec>
<Implementation><![CDATA[
	#dim prowebID as %integer = prowebItem.%Id()
	#dim itemName as %String = ##class(sc.xModules.objCODitem).getCODItemName(prowebID)
	#dim tempPersonID as %String = contextDataRegistration.tempPersonID  
	
	if '$IsObject(prowebItem) {
		throw ##class(shared.exceptions.generalException).%New("No proweb item passed in")
	}
	set ..labelText = ##class(sc.objData).getQuestionPrompt(prowebID, contextDataRegistration.languageID)
	set ..helpText = prowebItem.helpText
	set ..isMandatory = prowebItem.mandatory
	set ..value = ##class(eCom.tempCodData).get(tempPersonID, itemName)
	
	do ..addAlternativesFromProwebItem(prowebItem)
]]></Implementation>
</Method>

<Method name="addAlternativesFromProwebItem">
<FormalSpec>prowebItem:sc.objData,contextDataRegistration:EF.contextDataRegistration</FormalSpec>
<Private>1</Private>
<Implementation><![CDATA[
	set rsAlternative = ##class(cod.objItemAlternatives).getAlternativesForCodItemAsResultSet(prowebItem.objItemName.%Id())
	while rsAlternative.Next()	{
		Set alternativeDescription = rsAlternative.Get("description")
		set alternativeCode = rsAlternative.Get("code")
		
		do ..addAlternative(alternativeDescription,alternativeCode)
	}
]]></Implementation>
</Method>

<Method name="addAlternative">
<FormalSpec>alternativeDescription:%String,alternativeCode:%String</FormalSpec>
<Implementation><![CDATA[
	set alternative = ##class(EF.pageController.proweb.listItems.alternative).%New()
	set alternative.label = alternativeDescription
	set alternative.code = alternativeCode
	if alternativeDescription = ..value {
		set alternative.isSelected = 1	
	}
	
	do ..alternatives.Insert(alternative)
]]></Implementation>
</Method>
</Class>


<Class name="EF.pageController.proweb.listItems.textBlock">
<Super>EF.pageController.proweb.listItem</Super>
<TimeChanged>64183,53072.605755</TimeChanged>
<TimeCreated>64183,49747.663252</TimeCreated>

<Property name="text">
<Type>%String</Type>
<Parameter name="MAXLEN" value="1000000"/>
</Property>

<Method name="populateFromProwebObject">
<FormalSpec>prowebItem:sc.objData,contextDataRegistration:EF.contextDataRegistration</FormalSpec>
<Implementation><![CDATA[
	#dim prowebID as %integer = prowebItem.%Id()
	
	if '$IsObject(prowebItem) {
		throw ##class(shared.exceptions.generalException).%New("No proweb item passed in")
	}

	set ..text = prowebItem.description
]]></Implementation>
</Method>

<Method name="render">
<Implementation><![CDATA[
	set uiComponent = ##class(EF.ui.components.frontend.textBlock).%New(..htmlID)
	set uiComponent.text = ..text
	do uiComponent.render()
]]></Implementation>
</Method>
</Class>


<Class name="EF.pageController.proweb.listTestCase">
<Super>EF.ISC.UnitTest.TestCase</Super>
<TimeChanged>64183,59177.184045</TimeChanged>
<TimeCreated>64183,49819.459938</TimeCreated>

<Method name="TestBasicInputTextField">
<Implementation><![CDATA[
	#dim contextData as EF.contextDataRegistrationMock
	#dim inputElement as EF.pageController.proweb.listItems.inputElementCOD
	#dim listItem as EF.pageController.proweb.listItems.inputElementCOD
	
	set contextData = ##class(EF.contextDataRegistrationMock).createNew()

	set list = ##class(EF.pageController.proweb.list).%New()
	
	set listItem = ##class(EF.pageController.proweb.listItems.inputElementCOD).%New()
	set listItem.labelText = "First input field"
	set listItem.uiComponentType = "textInput"
	set listItem.isMandatory = 0
	do list.addListItem(listItem)
	
	// test basic field
	set returnedHTML = ##class(EF.utils.outputRedirection).redirectMethodOutputToString(list,"render")
	set returnedHTML = $ZStrip(returnedHTML,"*WC")
	set expectedHTML = "<divclass='rowdraggableTR'><divclass='col-sm-4ef_proweb_form_prompt'><labelclass=""control-label""for=""|2401"">Firstinputfield</label></div><divclass='col-sm-8ef_proweb_form_prompt'><inputtype=""text""class=""form-control""title=""""id=""|2401""name=""""value=""""placeholder=""""></div></div>"
	do $$$AssertEquals(returnedHTML,expectedHTML)


	// test mandatory field
	set listItem.isMandatory = 1
	set returnedHTML = ##class(EF.utils.outputRedirection).redirectMethodOutputToString(list,"render")
	set returnedHTML = $ZStrip(returnedHTML,"*WC")
	set expectedHTML = "<divclass='rowdraggableTR'><divclass='col-sm-4ef_proweb_form_promptef-required-field'><labelclass=""control-label""for=""|2401"">Firstinputfield</label></div><divclass='col-sm-8ef_proweb_form_prompt'><inputtype=""text""class=""form-control""title=""""id=""|2401""name=""""value=""""placeholder=""""></div></div>"
	do $$$AssertEquals(returnedHTML,expectedHTML)

	// test with a second field
	set listItem2 = ##class(EF.pageController.proweb.listItems.inputElementCOD).%New()
	set listItem2.labelText = "Second input field"
	set listItem2.uiComponentType = "textInput"
	set listItem2.isMandatory = 0
	do list.addListItem(listItem2)

	set returnedHTML = ##class(EF.utils.outputRedirection).redirectMethodOutputToString(list,"render")
	set returnedHTML = $ZStrip(returnedHTML,"*WC")
	set expectedHTML = "<divclass='rowdraggableTR'><divclass='col-sm-4ef_proweb_form_promptef-required-field'><labelclass=""control-label""for=""|2401"">Firstinputfield</label></div><divclass='col-sm-8ef_proweb_form_prompt'><inputtype=""text""class=""form-control""title=""""id=""|2401""name=""""value=""""placeholder=""""></div></div><divclass='rowdraggableTR'><divclass='col-sm-4ef_proweb_form_prompt'><labelclass=""control-label""for=""|2500"">Secondinputfield</label></div><divclass='col-sm-8ef_proweb_form_prompt'><inputtype=""text""class=""form-control""title=""""id=""|2500""name=""""value=""""placeholder=""""></div></div>"
	do $$$AssertEquals(returnedHTML,expectedHTML)
]]></Implementation>
</Method>

<Method name="TestTextBlock">
<Implementation><![CDATA[
	#dim contextData as EF.contextDataRegistrationMock
	#dim listItem as EF.pageController.proweb.listItems.textBlock
	
	set contextData = ##class(EF.contextDataRegistrationMock).createNew()

	set list = ##class(EF.pageController.proweb.list).%New()
	
	set listItem = ##class(EF.pageController.proweb.listItems.textBlock).%New()
	set listItem.text = "Lorem ipsum dolor sit amet, faucibus sagittis dui commodo integer. Vitae fringilla amet, wisi amet suspendisse ut vitae per vitae, pellentesque mi dis nisl tellus donec tempor, laoreet viverra, pellentesque ultricies conubia justo lorem. Torquent nibh risus aliquam fusce lacus in, non mus. Integer velit, volutpat a vel, tincidunt justo mattis, commodo lacus volutpat luctus felis. Sit adipiscing aliquet aenean fringilla nullam ac, velit dui, cum felis a nullam dapibus, condimentum pulvinar quis posuere integer justo."
	set listItem.uiComponentType = "textBlock"
	do list.addListItem(listItem)
	
	set returnedHTML = ##class(EF.utils.outputRedirection).redirectMethodOutputToString(list,"render")
	set returnedHTML = $ZStrip(returnedHTML,"*WC")
	set expectedHTML = "<divclass='rowdraggableTR'><divclass='col-sm-12'>Loremipsumdolorsitamet,faucibussagittisduicommodointeger.Vitaefringillaamet,wisiametsuspendisseutvitaepervitae,pellentesquemidisnisltellusdonectempor,laoreetviverra,pellentesqueultriciesconubiajustolorem.Torquentnibhrisusaliquamfuscelacusin,nonmus.Integervelit,volutpatavel,tinciduntjustomattis,commodolacusvolutpatluctusfelis.Sitadipiscingaliquetaeneanfringillanullamac,velitdui,cumfelisanullamdapibus,condimentumpulvinarquisposuereintegerjusto.</div></div>"
	do $$$AssertEquals(returnedHTML,expectedHTML)
]]></Implementation>
</Method>
</Class>


<Class name="EF.pages.frontend.base">
<Description><![CDATA[
Common page that all frontend pages could/should inherit from.
<!-- ;vc;
;vc;    Object: EF.pages.frontend.base.CLS/EV.9
;vc; Component: CLS.EF.pages.frontend.base
;vc;  Location: SmallDev
;vc; Date/Time: 02-Sep-16 14:23
;vc;      User: JeremyW
;vc; --><p>VC/m status:<table id='vcm' border='1'><tr><th>Object</th><th>Component</th><th>Location</th><th>Date/Time</th><th>User</th></tr><tr><td>EF.pages.frontend.base.CLS/EV.9</td><td>CLS.EF.pages.frontend.base</td><td>SmallDev</td><td style='white-space: nowrap;'>02-Sep-16 14:23</td><td>JeremyW</td></tr></table>
]]></Description>
<Language>cache</Language>
<ProcedureBlock>0</ProcedureBlock>
<Super>shared.pCSPmanage</Super>
<TimeChanged>64184,53272.672314</TimeChanged>
<TimeCreated>63635,40114.778424</TimeCreated>

<Parameter name="showRegistrationProgressBar">
<Default>0</Default>
</Parameter>

<Parameter name="hasRegistrationQuestions">
<Default>0</Default>
</Parameter>

<Parameter name="efUsePageController">
<Type>%Boolean</Type>
<Default>1</Default>
</Parameter>

<Method name="OnPage">
<ClassMethod>1</ClassMethod>
<ReturnType>%Status</ReturnType>
<Implementation><![CDATA[
	
	Do ..OnPageCSPROOT()
	
	Quit $$$OK
]]></Implementation>
</Method>

<Method name="OnPageCSPROOT">
<ClassMethod>1</ClassMethod>
<ReturnType>%Boolean</ReturnType>
<Implementation><![CDATA[
	do ..OnPagePageTop()
	do ..initPageController()
	do ..OnPagePageContent()
	do ..OnPagePageBottom()
]]></Implementation>
</Method>

<Method name="initPageController">
<ClassMethod>1</ClassMethod>
<Implementation><![CDATA[
	set contextData = ##class(EF.contextDataRegistration).createFromFrontendCSPSession()
	if ..usePageController() {
		set contextData = ##class(EF.contextData).createFromBackendCSPSession()
		set pageControllerID=%request.Get("pageControllerID")
		merge requestData=%request.Data
		
		if pageControllerID {
			try {
				do ..beforePageControllerReload(pageControllerID)
				set pageController=##class(EF.pageController.page).open(pageControllerID,contextData)
			} catch {
				// force a reload if there is a problem opening the page
				set pageControllerID=""
			}
		}
		if 'pageControllerID {
			set pageController=$CLASSMETHOD(..getPageDataClassName(),"createNew",contextData,.requestData)
			do pageController.%Save()
		}
		
		set pageControllerID=pageController.%Id()
	}
]]></Implementation>
</Method>

<Method name="OnPagePageTop">
<ClassMethod>1</ClassMethod>
<Implementation><![CDATA[
	w ##class(shared.pageMethods).outputFrontendHeader()
	Write !,"<head>"
	Write !
 	do ##class(layout.objTemplate).writeBit("","{{ef_header}}")
	Write !
	Do ..Include("frontendHTTPheader.csp")
	Write !
	Do ..Include("colourScheme.csp")
	do ..OnPagePageHeaderCSS()
	Write !,!,"</head>"
	Write !,"<body class=""bodyBackground"">"
	Write !,!,!,!
	set app=##class(sc.objData).applicationPath()
	if ..#hasRegistrationQuestions {
		set isCOD = 1
	}
	do ##class(cspRealEV.system.proweb.templatestart).OnPageCSPROOT()
	
 	do ##class(layout.objTemplate).writeBit("{{ef_header}}","{{ef_banner}}")
 	do ##class(layout.objTemplate).writeBit("{{ef_banner}}","{{ef_main_progress}}")
 	if ..#showRegistrationProgressBar {
		if ($G(%session.Data("mode"))="preview")!($G(%session.Data("inSitePageEditing"))) {
			if '%request.Get("hideButtons") {
				Do ..Include("progress.csp")
			}
		}
 	}
 	do ##class(layout.objTemplate).writeBit("{{ef_main_progress}}","{{ef_main_header}}")
]]></Implementation>
</Method>

<Method name="OnPagePageHeaderCSS">
<ClassMethod>1</ClassMethod>
</Method>

<Method name="OnPagePageBottom">
<ClassMethod>1</ClassMethod>
<Implementation><![CDATA[
	do ##class(layout.objTemplate).writeBit("{{ef_main_buttons}}","{{ef_footer}}")
	do ##class(layout.objTemplate).writeBit("{{ef_footer}}","")
	Do ..Include("editingFooter.csp")
	set app=##class(sc.objData).applicationPath()
	do ##class(cspRealEV.system.proweb.templatestop).OnPageCSPROOT()
	Write !,!,"</body>"
	Write !,"</html>",!
]]></Implementation>
</Method>

<Method name="OnPagePageContent">
<ClassMethod>1</ClassMethod>
</Method>

<Method name="outputProwebListRows">
<ClassMethod>1</ClassMethod>
<FormalSpec>componentName,pageID,isHTMLTable:%Boolean,paramIsRepeatedList:%Boolean=0</FormalSpec>
<Implementation><![CDATA[
	if +%session.Get("useExperimentalCMS")=0 {
		set beforeItem=##class(sc.xModules.objPage).getBeforeItem(pageID)
		new pageURL,app
		// Clear previously set component 
		KILL %session.Data("beforeRow")
		KILL %session.Data("afterRow")
		KILL %session.Data("beforeItem")
		KILL %session.Data("afterItem")
		KILL %session.Data("componentName")
		// retrieve the passed component name
		set %session.Data("beforeRow")=""
		set %session.Data("afterRow")=""
		if isHTMLTable {
			set %session.Data("beforeItem")=(beforeItem)
			set %session.Data("afterItem")="</TD></TR>"
		} else {
			set %session.Data("beforeItem")=""
			set %session.Data("afterItem")="" 	
		}
		set %session.Data("componentName")=componentName
		set isRepeatedList=paramIsRepeatedList
		set app=##class(sc.objData).applicationPath()
		set pageURL=app_"/system/proweb/tagFree.csp"
		do ##class(cspRealEV.system.proweb.tagfree).OnPageCSPROOT()
		
	} elseif +%session.Get("useExperimentalCMS")=1 {
		do ..outputProwebListRowsExperimental(componentName, pageID, paramIsRepeatedList)
	}
]]></Implementation>
</Method>

<Method name="outputProwebListRowsExperimental">
<ClassMethod>1</ClassMethod>
<FormalSpec>componentName,pageID</FormalSpec>
<ProcedureBlock>1</ProcedureBlock>
<Implementation><![CDATA[
	#dim list as sc.CMS.list
	#dim contextDataRegistration as EF.contextDataRegistration = ##class(EF.contextDataRegistration).createFromFrontendCSPSession()
	
	set contextDataRegistration.tempPersonID = $G(%session.Data("eventsforce","frontend","currentPersonID"))
	set contextDataRegistration.prowebMode = $G(%session.Data("mode"))
	set contextDataRegistration.componentName = componentName

	set floatingMenuCounter = %session.Data("floatCount") // ######### needs refactoring ######

	set listID = ##class(sc.xModules.objList).getListIDFromPageIDAndComponentName(pageID,componentName)
	set objList = ##class(sc.xModules.objList).%OpenId(listID)
	if '$IsObject(objList) {
		throw ##class(shared.exceptions.generalException).%New("No objList")	
	}
	
	set list = ##class(EF.pageController.proweb.list).createNew(contextDataRegistration)	
	if '$IsObject(list) {
		throw ##class(shared.exceptions.generalException).%New("No list created")
	}	
	do list.populateFromListObject(objList)
	do list.render()
]]></Implementation>
</Method>

<Method name="outputProwebList">
<ClassMethod>1</ClassMethod>
<FormalSpec>componentName,pageID</FormalSpec>
<Implementation><![CDATA[
	&html<<table border=0 cellpadding=0 cellspacing=0 class="black10px" width="100%">>
	do ..outputProwebListRows(componentName,pageID,1)
	&html<</table>>
]]></Implementation>
</Method>

<Method name="isPageBeingEditedOrPreviewed">
<ClassMethod>1</ClassMethod>
<ReturnType>%Boolean</ReturnType>
<Implementation><![CDATA[	return ##class(shared.pageMethodsFrontend).isPageBeingEditedOrPreviewed()
]]></Implementation>
</Method>

<Method name="beforePageControllerReload">
<Description>
################ these methods shuld be moved to a super class ######################</Description>
<ClassMethod>1</ClassMethod>
<FormalSpec>pageControllerID</FormalSpec>
</Method>

<Method name="usePageController">
<ClassMethod>1</ClassMethod>
<Private>1</Private>
<ReturnType>%Boolean</ReturnType>
<Implementation><![CDATA[	Quit ..#efUsePageController
]]></Implementation>
</Method>

<Method name="getPageDataClassName">
<ClassMethod>1</ClassMethod>
<Private>1</Private>
<ReturnType>%String</ReturnType>
<Implementation><![CDATA[	Quit "EF.pageController.pagesFrontend."_$PIECE($PIECE(..#CSPFILE,"\",$LENGTH(..#CSPFILE,"\")),".",1)
]]></Implementation>
</Method>
</Class>


<Class name="EF.ui.components.base">
<Description><![CDATA[
<!-- ;vc;-
;vc;    Object: EF.ui.components.base.CLS/EV.12
;vc; Component: CLS.EF.ui.components.base
;vc;  Location: SmallDev
;vc; Date/Time: 02-Sep-16 14:24
;vc;      User: JeremyW
;vc; --><p>VC/m status:<table id='vcm' border='1'><tr><th>Object</th><th>Component</th><th>Location</th><th>Date/Time</th><th>User</th></tr><tr><td>EF.ui.components.base.CLS/EV.12</td><td>CLS.EF.ui.components.base</td><td>SmallDev</td><td style='white-space: nowrap;'>02-Sep-16 14:24</td><td>JeremyW</td></tr></table>
]]></Description>
<Super>%RegisteredObject,EF.htmlGenerator</Super>
<TimeChanged>64182,41374.783484</TimeChanged>
<TimeCreated>63355,56488.955478</TimeCreated>

<Property name="htmlID">
<Type>%String</Type>
</Property>

<Property name="hasError">
<Type>%Boolean</Type>
<InitialExpression>0</InitialExpression>
</Property>

<Property name="classes">
<Type>%String</Type>
</Property>

<Property name="childComponents">
<Type>EF.ui.components.base</Type>
<Collection>list</Collection>
</Property>

<Property name="parentComponent">
<Type>EF.ui.components.base</Type>
</Property>

<Property name="enableDisableDependencyList">
<Type>EF.ui.components.dependencyList</Type>
</Property>

<Property name="showHideDependencyList">
<Type>EF.ui.components.dependencyList</Type>
</Property>

<Property name="toggleClassDependencyList">
<Type>EF.ui.components.dependencyList</Type>
</Property>

<Property name="toggleClassDependencyClassName">
<Type>%String</Type>
</Property>

<Property name="containerClasses">
<Type>%String</Type>
</Property>

<Property name="isDisabled">
<Type>%Boolean</Type>
<InitialExpression>0</InitialExpression>
</Property>

<Property name="extraAttributes">
<Type>EF.ui.components.attribute</Type>
<Collection>list</Collection>
</Property>

<Method name="getDefaultContainerClasses">
<ClassMethod>1</ClassMethod>
<ReturnType>%String</ReturnType>
<Implementation><![CDATA[	Return ""
]]></Implementation>
</Method>

<Method name="%OnNew">
<FormalSpec>htmlID:%String</FormalSpec>
<Private>1</Private>
<ReturnType>%Status</ReturnType>
<ServerOnly>1</ServerOnly>
<Implementation><![CDATA[
	If ($DATA(htmlID)) {
		Set ..htmlID=htmlID
	} else {
		Set ..htmlID="ef_control_"_$TR(##class(%SYSTEM.Util).CreateGUID(),"-","")
	}
	
	Set ..classes=..getDefaultClasses()
	
	set ..containerClasses=..getDefaultContainerClasses()
	
    Quit $$$OK
]]></Implementation>
</Method>

<Method name="addChild">
<FormalSpec>uiComponent:EF.ui.components.base</FormalSpec>
<Implementation><![CDATA[
	
	do ..childComponents.Insert(uiComponent)
	set uiComponent.parentComponent=$this
]]></Implementation>
</Method>

<Method name="getDefaultClasses">
<ClassMethod>1</ClassMethod>
<ReturnType>%String</ReturnType>
<Implementation><![CDATA[	Return ""
]]></Implementation>
</Method>

<Method name="addClass">
<FormalSpec>className</FormalSpec>
<Implementation><![CDATA[
	if $l(..classes) {
		set ..classes=..classes_" "_className
	} else {
		set ..classes=className
	}
]]></Implementation>
</Method>

<Method name="removeClass">
<FormalSpec>className</FormalSpec>
<Implementation><![CDATA[
	set updatedClasses=..classes
	for i=1:1:$length(updatedClasses," ") {
		if $piece(updatedClasses," ",i)=className {
			set $piece(updatedClasses," ",i,*)=$piece(updatedClasses," ",i+1,*)	
		}
	}
	set ..classes=updatedClasses
]]></Implementation>
</Method>

<Method name="renderChildren">
<Implementation><![CDATA[
	set key=""
	for {
		set uiComponent=..childComponents.GetNext(.key)
		if key="" quit
		if $IsObject(uiComponent) {
			do ..renderChildComponent(uiComponent)
		}
	}
]]></Implementation>
</Method>

<Method name="renderJSForElementAndChildren">
<Implementation><![CDATA[
	do ..renderJS()
	set key=""
	for {
		set uiComponent=..childComponents.GetNext(.key)
		if key="" quit
		if $IsObject(uiComponent) {
			do uiComponent.renderJSForElementAndChildren()
		}
	}
]]></Implementation>
</Method>

<Method name="renderChildComponent">
<FormalSpec>uiComponent:EF.ui.components.base</FormalSpec>
<Implementation><![CDATA[	do uiComponent.render()
]]></Implementation>
</Method>

<Method name="render">
<Implementation><![CDATA[	do ..renderChildren()
]]></Implementation>
</Method>

<Method name="getRendered">
<ReturnType>%String</ReturnType>
<Implementation><![CDATA[
	
	set out=##class(EF.utils.outputRedirection).redirectMethodOutputToString($this,"render")
	quit out
]]></Implementation>
</Method>

<Method name="getRenderedJSForElementAndChildren">
<ReturnType>%String</ReturnType>
<Implementation><![CDATA[
	
	set out=##class(EF.utils.outputRedirection).redirectMethodOutputToString($this,"renderJSForElementAndChildren")
	quit out
]]></Implementation>
</Method>

<Method name="renderJS">
</Method>

<Method name="addAttribute">
<FormalSpec>name,value</FormalSpec>
<Implementation><![CDATA[	do ##class(EF.ui.components.attribute).addAttributeToList(..extraAttributes,name,value)
]]></Implementation>
</Method>

<Method name="getExtraAttributes">
<ReturnType>%String</ReturnType>
<Implementation><![CDATA[
 
	set attributes=""
	if $IsObject(..enableDisableDependencyList) {
		set dependencyListJSON=##class(shared.jsonFunctions).getObjectAsJSONString(..enableDisableDependencyList)
		set attributes="data-enable-disable-dependency-list="""_..encodeForHTMLAttribute(dependencyListJSON)_""" "
	}
	if $IsObject(..showHideDependencyList) {
		set dependencyListJSON=##class(shared.jsonFunctions).getObjectAsJSONString(..showHideDependencyList)
		set attributes=attributes_"data-show-hide-dependency-list="""_..encodeForHTMLAttribute(dependencyListJSON)_""" "
	}
	if $IsObject(..toggleClassDependencyList) {
		set dependencyListJSON=##class(shared.jsonFunctions).getObjectAsJSONString(..toggleClassDependencyList)
		set attributes=attributes_"data-toggle-class-dependency-list="""_..encodeForHTMLAttribute(dependencyListJSON)_""" "
		set attributes=attributes_"data-toggle-class-dependency-class-name="""_..encodeForHTMLAttribute(..toggleClassDependencyClassName)_""" "
	}
	return attributes_##class(EF.ui.components.attribute).getAttributesAsHTML(..extraAttributes)
]]></Implementation>
</Method>
</Class>


<Class name="EF.ui.components.frontend.alternative">
<Description>
Hold the alternatives to dropdown, radios, multi check etc</Description>
<Super>EF.ui.components.alternative</Super>
<TimeChanged>64183,58926.068237</TimeChanged>
<TimeCreated>64183,58572.359354</TimeCreated>

<Property name="code">
<Type>%String</Type>
<Parameter name="MAXLEN" value="32000"/>
</Property>
</Class>


<Class name="EF.ui.components.frontend.divider">
<Super>EF.ui.components.frontend.prowebBase</Super>
<TimeChanged>64183,54031.385852</TimeChanged>
<TimeCreated>64183,53112.09307</TimeCreated>

<Method name="render">
<Implementation><![CDATA[
	do ..renderRowOpening()
		do ..renderCellOpening()
			write "<hr class='ef_form_divider''>"
		do ..renderCellClosing()
	do ..renderRowClosing()
]]></Implementation>
</Method>
</Class>


<Class name="EF.ui.components.frontend.dropdown">
<Super>EF.ui.components.frontend.inputElement,EF.ui.components.listInput</Super>
<TimeChanged>64184,57952.276581</TimeChanged>
<TimeCreated>63355,56609.363142</TimeCreated>

<Method name="render">
<Implementation><![CDATA[
	do ..renderRowOpeningAndLabel()
	set selectClass="form-control"
	&html<		
		<select class="#(..encodeForHTMLAttribute(selectClass))#" name="#(..encodeHTMLAttribute(..htmlName))#" id="#(..encodeHTMLAttribute(..htmlID))#" title="#(..encodeHTMLAttribute(..title))#" #(..rawHTML(..getDisabledString()))# >
    		#[do ..renderAlternatives()]#
        </select>
    >
	do ..renderHelpAndRowClosing()
]]></Implementation>
</Method>

<Method name="renderAlternatives">
<Implementation><![CDATA[
 	do ..renderPlaceholder()
	set key=""
	for  {
		set alternative = ..alternatives.GetNext(.key)
		if key="" quit
		do ..renderAlternative(alternative)	
	}
]]></Implementation>
</Method>

<Method name="renderAlternative">
<FormalSpec>alternative:EF.ui.components.alternative</FormalSpec>
<Implementation><![CDATA[
	set selectedString=""
	if alternative.isSelected {
		set selectedString="selected="""""	
	}
	
	set disabledString=""
	if alternative.isDisabled {
		set disabledString="disabled"	
	}
	
	// The html bit
	&html<
        <option #(..rawHTML(selectedString))# #(..rawHTML(disabledString))# value="#(..encodeHTMLAttribute(alternative.value))#" >#(..encodeHTMLContent(alternative.label))#</option>
	>
]]></Implementation>
</Method>

<Method name="renderPlaceholder">
<Implementation><![CDATA[
	if ..isMandatory {
		write !,"<option value='' selected disabled>",..encodeHTMLContent(##class(shared.pCSP).out("Choose one...")),"</option>",!	
	} else {
		write !,"<option value=''></option>",!
	}
]]></Implementation>
</Method>
</Class>


<Class name="EF.ui.components.frontend.inputElement">
<Super>EF.ui.components.frontend.prowebBase,EF.ui.components.inputBase</Super>
<TimeChanged>64184,57613.603387</TimeChanged>
<TimeCreated>64183,40678.260093</TimeCreated>

<Property name="alternatives">
<Type>EF.ui.components.frontend.alternative</Type>
<Collection>list</Collection>
</Property>

<Property name="isMandatory">
<Type>%Boolean</Type>
</Property>

<Property name="helpText">
<Type>%String</Type>
<Parameter name="MAXLEN" value="32000"/>
</Property>

<Method name="renderRowOpeningAndLabel">
<Implementation><![CDATA[
	do ..renderRowOpening()
	if ..isMandatory {
		do ..renderLabelCellOpeningMandatory()
	} else {
		do ..renderLabelCellOpening()
	}
	do ..renderLabel()
	do ..renderCellClosing()
	do ..renderInputElementCellOpening()
]]></Implementation>
</Method>

<Method name="renderHelpAndRowClosing">
<Implementation><![CDATA[
    Do ##class(sc.codItemMethods).outputHelpTextHTML(..helpText)
	do ..renderCellClosing()
	do ..renderRowClosing()
]]></Implementation>
</Method>

<Method name="renderLabel">
<Implementation><![CDATA[
	if $length(..label) {
		&html<<label class="control-label" for="#(..encodeForHTMLAttribute(..htmlID))#">#(..encodeForHTML(..label))#</label>>
	}
]]></Implementation>
</Method>

<Method name="getDisabledString">
<Implementation><![CDATA[
	set disabledString=""
	if ..isDisabled {
		set disabledString="disabled=""disabled"""
	}
	return disabledString
]]></Implementation>
</Method>

<Method name="getDefaultClasses">
<ClassMethod>1</ClassMethod>
<ReturnType>%String</ReturnType>
<Implementation><![CDATA[	Return ##super()_" form-control"
]]></Implementation>
</Method>

<Method name="getDefaultContainerClasses">
<ClassMethod>1</ClassMethod>
<ReturnType>%String</ReturnType>
<Implementation><![CDATA[	Return ##super()_" form-group"
]]></Implementation>
</Method>

<Method name="renderLabelCellOpeningMandatory">
<Implementation><![CDATA[	write "<div class='col-sm-4 ef_proweb_form_prompt ef-required-field'>"
]]></Implementation>
</Method>

<Method name="renderLabelCellOpening">
<Implementation><![CDATA[	write "<div class='col-sm-4 ef_proweb_form_prompt'>"
]]></Implementation>
</Method>

<Method name="renderInputElementCellOpening">
<Implementation><![CDATA[	write "<div class='col-sm-8 ef_proweb_form_prompt'>"
]]></Implementation>
</Method>
</Class>


<Class name="EF.ui.components.frontend.prowebBase">
<Super>EF.ui.components.base</Super>
<TimeChanged>64183,41819.123112</TimeChanged>
<TimeCreated>64183,41819.123112</TimeCreated>

<Method name="renderRowOpening">
<Implementation><![CDATA[	write "<div class='row draggableTR'>"
]]></Implementation>
</Method>

<Method name="renderCellOpening">
<Implementation><![CDATA[	write "<div class='col-sm-12'>"
]]></Implementation>
</Method>

<Method name="renderCellClosing">
<Implementation><![CDATA[	write "</div>"
]]></Implementation>
</Method>

<Method name="renderRowClosing">
<Implementation><![CDATA[		write "</div>"
]]></Implementation>
</Method>
</Class>


<Class name="EF.ui.components.frontend.textBlock">
<Super>EF.ui.components.frontend.prowebBase</Super>
<TimeChanged>64183,41875.095016</TimeChanged>
<TimeCreated>64183,38661.128484</TimeCreated>

<Property name="text">
<Type>%String</Type>
<Parameter name="MAXLEN" value="1000000"/>
</Property>

<Method name="render">
<Implementation><![CDATA[
	do ..renderRowOpening()
		do ..renderCellOpening()
			write ..rawHTML(..text)
		do ..renderCellClosing()
	do ..renderRowClosing()
]]></Implementation>
</Method>
</Class>


<Class name="EF.ui.components.frontend.textInput">
<Super>EF.ui.components.frontend.inputElement,EF.ui.components.textInput</Super>
<TimeChanged>64184,57908.395562</TimeChanged>
<TimeCreated>63357,57620.613738</TimeCreated>

<Parameter name="typeAttribute">
<Default>text</Default>
</Parameter>

<Method name="render">
<Implementation><![CDATA[
	do ..renderRowOpeningAndLabel()
	&html<
		    <input type="#(..encodeHTMLAttribute(..#typeAttribute))#" class="#(..encodeHTMLAttribute(..classes))#" #(..rawHTML(..getDisabledString()))# title="#(..encodeHTMLAttribute(..title))#" id="#(..encodeHTMLAttribute(..htmlID))#" name="#(..encodeHTMLAttribute(..htmlName))#" value="#(..encodeHTMLAttribute(..value))#" placeholder="#(..encodeHTMLAttribute(..placeHolder))#"  #(..rawHTML(..getExtraAttributes()))#>
    >
    do ..renderHelpAndRowClosing()
]]></Implementation>
</Method>
</Class>


<CSP name="frontEnd/reg/t4Registration.csp" application="/freddev/" default="1"><![CDATA[
<csp:class super="EF.pages.frontend.registrationProcess">
<script language="cache" runat="server">
	Do ##super()
</script>

  
<csp:section name="PageContent">
	</h1><ef-pc-container type="panel-body">
	   	<ef-pc-container type="row"> 
	   		
		   	
				<ef-pc-element prowebcomponentname="Main List">
			
			
		</ef-pc-container>
	</ef-pc-container>			
</csp:section>

]]></CSP>


<CSP name="system/eventsForceRules.csr" application="/freddev/" default="1"><![CDATA[
	// please note that the NEW command dannot be used in rules! (nor the: <CSP:if>)


// This little beuty replaces the given path in compile time with a call to an inherited page method in runtime!
// It also translates the 'Alt' and the 'Title' attributes
<csr:RULE name="PathExpander" match="IMG[SRC]" empty>
<csr:ACTION>
<script language="cache" runat="compiler">
	set inPath=%this.GetAttribute("SRC")
	if inPath'["StreamServer" { // leave streamed images
		if inPath["#(" {
			// do nothing if dynamic
		} else {
			set inPath="#(..resolvePath("""_inPath_"""))#" 
			do %this.SetAttribute("SRC",inPath)
		}
	}
		
	set titleText=%this.GetAttribute("TITLE")
	//if (titleText'="")&(titleText'["#(") set titleText="#(##class(shared.translation).translateSingle(%request.PageName,%session.Get(""xLanguage""),"""_titleText_"""))#" 
	if (titleText'="")&(titleText'["#(") set titleText="#(..out("""_$TR(titleText,"""","'")_"""))#" 
	do %this.SetAttribute("TITLE",titleText)

	set altText=%this.GetAttribute("ALT")
	//if (altText'="")&(altText'["#(") set altText="#(##class(shared.translation).translateSingle(%request.PageName,%session.Get(""xLanguage""),"""_altText_"""))#" 
	if (altText'="")&(altText'["#(") set altText="#(..out("""_$TR(altText,"""","'")_"""))#" 
	do %this.SetAttribute("ALT",altText)
	
</script>
<csr:DEFAULT>
</csr:ACTION>
</csr:RULE>


//Same as above but for input tags with images (submit button to you and me)
<csr:RULE name="PathExpander2" match="INPUT[SRC]" empty>
<csr:ACTION>
<script language="cache" runat="compiler">
	set inPath=%this.GetAttribute("SRC")
	if inPath'["StreamServer" { // leave streamed images
		if inPath["#(" {
			// do nothing if dynamic
		} else {
			set inPath="#(..resolvePath("""_inPath_"""))#" 
			do %this.SetAttribute("SRC",inPath)
		}

	}

	set titleText=%this.GetAttribute("TITLE")
	//if (titleText'="")&(titleText'["#(") set titleText="#(##class(shared.translation).translateSingle(%request.PageName,%session.Get(""xLanguage""),"""_titleText_"""))#" 
	if (titleText'="")&(titleText'["#(") set titleText="#(..out("""_$TR(titleText,"""","'")_"""))#" 
	do %this.SetAttribute("TITLE",titleText)
	
	set altText=%this.GetAttribute("ALT")
	//if (altText'="")&(altText'["#(") set altText="#(##class(shared.translation).translateSingle(%request.PageName,%session.Get(""xLanguage""),"""_altText_"""))#" 
	if (altText'="")&(altText'["#(") set altText="#(..out("""_$TR(altText,"""","'")_"""))#" 
	do %this.SetAttribute("ALT",altText)
</script>
<csr:DEFAULT>
</csr:ACTION>
</csr:RULE>

<csr:RULE name="efA" match="ef-a" myData>
<csr:ACTION>
<script language="cache" runat="compiler">
	set %this.TagName="a"
	do ##class(EF.ui.cspRuleMethods).linkStandatdURLAttributes(%this)
	do ##class(EF.ui.cspRuleMethods).htmlEncodeAllAttributes(%this)
</script>
<csr:DEFAULT>
</csr:ACTION>
</csr:RULE>

<csr:RULE name="efSelect" match="ef-select" myData>
<csr:ACTION>
<script language="cache" runat="compiler">
	set %this.TagName="select"
	do ##class(EF.ui.cspRuleMethods).linkStandatdURLAttributes(%this)
	do ##class(EF.ui.cspRuleMethods).htmlEncodeAllAttributes(%this)
</script>
<csr:DEFAULT>
</csr:ACTION>
</csr:RULE>

<csr:RULE name="efInput" match="ef-input" myData>
<csr:ACTION>
<script language="cache" runat="compiler">
	set %this.TagName="input"
	do ##class(EF.ui.cspRuleMethods).linkStandatdURLAttributes(%this)
	do ##class(EF.ui.cspRuleMethods).htmlEncodeAllAttributes(%this)
</script>
<csr:DEFAULT>
</csr:ACTION>
</csr:RULE>

// language thing for href tags with titles
<csr:RULE name="titleAHREF" match="A[TITLE]" myData>
<csr:ACTION>
<script language="cache" runat="compiler">
	set titleText=%this.GetAttribute("TITLE")
	if (titleText'="")&(titleText'["#(") set titleText="#(..out("""_$TR(titleText,"""","'")_"""))#" 
	do %this.SetAttribute("TITLE",titleText)
</script>
<csr:DEFAULT>
</csr:ACTION>
</csr:RULE>

// language thing for span tags with titles
<csr:RULE name="titleSPAN" match="SPAN[TITLE]" myData>
<csr:ACTION>
<script language="cache" runat="compiler">
	set titleText=%this.GetAttribute("TITLE")
	if (titleText'="")&(titleText'["#(") set titleText="#(..out("""_$TR(titleText,"""","'")_"""))#" 
	do %this.SetAttribute("TITLE",titleText)
</script>
<csr:DEFAULT>
</csr:ACTION>
</csr:RULE>

// Replace the path to the stylesheet
// No longer needed, but you can't just delete a csp rule
<csr:RULE name="StyleSheetFinder" match="LINK[HREF]" empty>
<csr:ACTION>
<csr:DEFAULT>
</csr:ACTION>
</csr:RULE>


// Translate the breadtext
<csr:RULE name="breadText" match="tx" myData>
<csr:attribute name=cl description="The classname to use in the span" type="expression:STRING">
<csr:attribute name=nospan description="If 1 then do not surround the text with a span" type="expression:STRING">
<csr:ACTION>
<script language="cache" runat="compiler">
	// Replace the innertext with a call to ..out()
	set txText=%this.InnerText()   // GET THE CONTENTS OF THE TX TAGS
	set txText=$TR(txText,"""","'")
	set (v1plus,v2plus,v3plus)=0
	
	// extract the variables
	set var1=$P($p(txText,"#(",2),")#",1)
	if var1?1"+".E set var1=$e(var1,2,99),v1plus=1
	if var1'="" set txText=$p(txText,"#(",1)_"{{{VAR01}}}"_$p(txText,")#",2,99)

	set var2=$P($p(txText,"#(",2),")#",1)
	if var2?1"+".E set var2=$e(var2,2,99),v2plus=1
	if var2'="" set txText=$p(txText,"#(",1)_"{{{VAR02}}}"_$p(txText,")#",2,99)

	set var3=$P($p(txText,"#(",2),")#",1)
	if var3?1"+".E set var3=$e(var3,2,99),v3plus=1
	if var3'="" set txText=$p(txText,"#(",1)_"{{{VAR03}}}"_$p(txText,")#",2,99)
	  
	set routine=classname // classname is intersystems variable. it might change in the next version
	
	set string="..out("""_txText_""""
	set string=string_","""_routine_""""
	if var1'="" {
		if var1="BR" {
			set string=string_","_$S(v1plus:"+",1:"")_"<BR>"
		} else {
			set string=string_","_$S(v1plus:"+",1:"")_"$G("_var1_")"
 		}
	}
	if var2'="" set string=string_","_$S(v2plus:"+",1:"")_"$G("_var2_")"
	if var3'="" set string=string_","_$S(v3plus:"+",1:"")_"$G("_var3_")"
	set string=string_")"
	
	//set CSSclassname="ef_tx_normal" // fred june 2009 - removed becuase it is creating mixed font sizes when data is mixed with text
	set CSSclassname=""
	if $L(..GetAttribute("cl")) set CSSclassname=..GetAttribute("cl")
	
	// do not write out the span if we specifically say so or if backend page
	set doSpan=1
	if CSSclassname="" set doSpan=0
	
	if ..GetAttribute("nospan")=1 set doSpan=0
	if $L($G(%pageName)),$ZCVT(%pageName,"L")["/backend/" set doSpan=0

	if doSpan do ..WriteText("<span class="""_CSSclassname_""">")
	Do ..WriteExpressionText(string) 
	if doSpan do ..WriteText("</span>")

	//Do ..WriteExpressionText("..out("_txText_")   // csp rule:breadText")     
	//
</script>
</csr:ACTION>
</csr:RULE>


<!-- SYSTEMTYPE IF --------------------------------------------- -->
// create if statements around a section of code based on the systemType (setup.objSystemType)
<csr:rule name="systemTypeIF" match="SYSTEMTYPE:IF">
<csr:attribute name=module required description="A run-time expression to be evaluated." type="expression:STRING">
<csr:attribute name=autoelse description="should this write the standard page not allowed msg" type="expression:STRING">

<csr:description>
	The autoelse=1 causes an ELSE to be written automatically containing the "This is only available in the following editions..." message
	If autoelse is used then you CANNOT use ELSE.
	<EXAMPLE>
		<systemType:if module="EMAIL" autoelse="1">
			do email stuff
		</systemType:if>
	</EXAMPLE>
</csr:description>

<csr:class super=%CSP.RuleBlock>

<csr:action>
	<SCRIPT LANGUAGE=CACHE RUNAT=COMPILER>
		Do ..NewBlock()
		Set ..NextLabel=..GetNewLabel()
		Do ..WriteServer(" If '(##class(setup.objSystemTypes).isModuleAllowed("""_..GetAttribute("MODULE")_""")) Goto "_..NextLabel_" ;{")
	</SCRIPT>
	<csr:children>
	<SCRIPT LANGUAGE=CACHE RUNAT=COMPILER>
		New ifblock
		if ..GetAttribute("AUTOELSE")=1	{   // if this is used then cannot use an ELSE tag - otherwise it will not work.
			Set ifblock=..GetCurrentBlock()
			If ifblock.EndLabel="" Set ifblock.EndLabel=..GetNewLabel()
			Do ..WriteServer(" Goto "_ifblock.EndLabel_" ;} END IF")
			Do ..WriteServer(ifblock.NextLabel_" ;{ START ELSE")
			// do the standard msg stuff
			Set ifblock.NextLabel=""
		}

		New comment Set comment=" ;} END ELSE"
		If ..EndLabel'="" Do ..WriteServer(..EndLabel_comment) Set comment=""
		If ..NextLabel'="" Do ..WriteServer(..NextLabel_comment)
		Do ..RemoveBlock()
	</SCRIPT>
</csr:action>

</csr:rule>

<!-- SYSTEMTYPE ELSE --------------------------------------------- -->
<csr:rule name="systemTypeELSE" match="SYSTEMTYPE:IF/SYSTEMTYPE:ELSE" empty>

<csr:description>
	see description for systemTypeIF
</csr:description>

<csr:class super=%CSP.RuleBlock>

<csr:action>
	<SCRIPT LANGUAGE=CACHE RUNAT=COMPILER>
		New ifblock
		Set ifblock=..GetCurrentBlock()
		If ifblock'="" {
			If ifblock.EndLabel="" Set ifblock.EndLabel=..GetNewLabel()
			Do ..WriteServer(" Goto "_ifblock.EndLabel_" ;} END IF")
			Do ..WriteServer(ifblock.NextLabel_" ;{ START ELSE")
			Set ifblock.NextLabel=""
		}
	</SCRIPT>
</csr:action>
</csr:rule>

<csr:rule name="layoutSection0" match="LAYOUT:SECTION" empty>
<csr:attribute name=from required description="the tag to start writing from" type="expression:STRING">
<csr:attribute name=to required description="the tag to end at" type="expression:STRING">
<csr:action>
<script language="cache" runat="compiler">
	//Do ..WriteExpressionText(string) 
	//do ..WriteText("</span>")
    Do ..WriteServer(" do ##class(layout.objTemplate).writeBit("""_..GetAttribute("FROM")_""","""_..GetAttribute("TO")_""")")
</script>
</csr:action>
</csr:rule>

// =============================================================================================================================
<csp:comment><!-- PROWEB RULES--></csp:comment>
	// please note that the NEW command cannot be used in rules! (nor the: <CSP:if>)
// =============================================================================================================================



<csr:rule name="TEMPLATESTART" match="SC:TEMPLATESTART" empty dwenabled>
<csr:description>
	The <B>CS:TEXT</B> tag is the proWeb's initialising a template page.
</csr:description>
<csr:action>
<script language="cache" runat="server">
	set app=##class(sc.objData).applicationPath()
	do ##class(cspRealEV.system.proweb.templatestart).OnPageCSPROOT()
	
	// put the pageID int the session
	// JAW - done in template start (security hole) if %request.Get("pageID")'="" set %session.Data("pageID")=%request.Get("pageID")
</script>

</csr:action>
</csr:rule>

// =============================================================================================================================
<csr:rule name="TEMPLATESTOP" match="SC:TEMPLATESTOP" empty dwenabled>
<csr:description>
	The <B>CS:TEXT</B> tag is the proWeb's ending a template page.
</csr:description>
<csr:action>
<script language="cache" runat="server">
	set app=##class(sc.objData).applicationPath()
	do ##class(cspRealEV.system.proweb.templatestop).OnPageCSPROOT()
</script>
<script language="javascript">
// open popup window
function proWebNewWin(mypage,myname,w,h,scroll){
	leftPos = (screen.width) ? (screen.width-w)/2 : 0;
	topPos = (screen.height) ? (screen.height-h)/2 : 0;
	settings = 'height='+h+',width='+w+',top='+topPos+',left='+leftPos+',scrollbars=' + scroll + ',resizable=yes'
	win = window.open(mypage,myname,settings)
	win.focus();
}
</script>
</csr:action>
</csr:rule>

// =============================================================================================================================
<csr:rule name="TEXT" match="SC:TEXT" empty dwenabled>
<csr:description>
	The <B>CS:TEXT</B> tag is the proWeb's way of outputting a block of text. It will include an external page that only handles texts. Texts may include html formatting.
</csr:description>
<csr:attribute name="NAME" description="Specifies the component name of the template page" type="accessType:STRING">
<csr:action>
 <script language="CACHE" runat="SERVER">
	new pageURL,app
  
	// retrieve the passed component name
	set %session.Data("componentName")=##'%this.GetAttribute("NAME")'##

	set app=##class(sc.objData).applicationPath()
	set pageURL=app_"/system/proWeb/tagText.csp"
	do ##class(cspRealEV.system.proweb.tagtext).OnPageCSPROOT()
 </script>
</csr:action>
</csr:rule>


// =============================================================================================================================
<csr:rule name="FREE" match="SC:FREE" empty dwenabled>
FRRE RULE
<csr:description>
	The <B>SC:FREE</B> tag is the proWeb's way of outputting a list of freely chosed items. It will include an external page that only handles lists.
</csr:description>
<csr:attribute name="NAME" description="Specifies the component name of the template page" type="accessType:STRING">
<csr:action>
<script language="CACHE" runat="SERVER">
	do ##class(EF.pages.frontend.base).outputProwebListRows(##'%this.GetAttribute("NAME")'##, %session.Get("pageID"),1)
	s a="test"
</script>
</csr:action>
</csr:rule>

// =============================================================================================================================
<csr:rule name="IMAGE" match="SC:IMAGE" empty dwenabled>
<csr:description>
	The <B>CS:IMAGE</B> tag is the proWeb's way of outputting an image. It will include an external page that only handles images.
</csr:description>
<csr:attribute name="NAME" description="Specifies the component name of the template page" type="accessType:STRING">
<csr:action>
 <script language="CACHE" runat="SERVER">
  new pageURL,app
  
  // retrieve the passed component name
  set %session.Data("componentName")=##'%this.GetAttribute("NAME")'##
  set app=##class(sc.objData).applicationPath()
  set pageURL=app_"/system/proweb/tagImage.csp"
	if +$system.Version.GetNumber()<5 {		
	  	do DisplayPage^%customCSP(pageURL)
	} else {
		do ##class(cspRealEV.system.proweb.tagimage).OnPageCSPROOT()
	}

 </script>
</csr:action>
</csr:rule>



<csr:RULE name="HTMLLANG" match="HTML" empty>
<csr:ACTION>
<script language="CACHE" runat="COMPILER">
    // set the lang attribute for the HTML tag
    Do ..SetAttribute("lang","en")
</script>
<csr:DEFAULT>
</csr:ACTION>
</csr:RULE>



<csr:RULE name="efBackendToggle" match="EF:BACKEND:TOGGLE" empty>
<csr:ACTION>
<script language="CACHE" runat="COMPILER">
   Do ..WriteServer(" kill efRulesVarBackendToggleAttr")
   kill paramsordered
   do ..GetAttributesOrdered(.paramsordered)
   set index=""
   for {
		set index=$o(paramsordered(index))
		if index="" quit
		set attr=$ZCVT($LIST(paramsordered(index),1),"L")
		set value=..QuoteAttribute(attr)
		Do ..WriteServer(" set efRulesVarBackendToggleAttr"_"("""_attr_""")="_value)
	}
</script>
<script language="CACHE" runat="SERVER">
   Do ##class(pageClasses.backendComponentMethods).renderEfBackendToggle(.efRulesVarBackendToggleAttr)
</script>
</csr:ACTION>
</csr:RULE>



<csr:RULE name="efBackendTextField" match="EF:BACKEND:TEXTFIELD" empty>
<csr:ACTION>
<script language="CACHE" runat="COMPILER">
   Do ..WriteServer(" kill efRulesVarBackendTextFieldAttr")
   kill paramsordered
   do ..GetAttributesOrdered(.paramsordered)
   set index=""
   for {
		set index=$o(paramsordered(index))
		if index="" quit
		set attr=$ZCVT($LIST(paramsordered(index),1),"L")
		set value=..QuoteAttribute(attr)
		Do ..WriteServer(" set efRulesVarBackendTextFieldAttr"_"("""_attr_""")="_value)
	}
</script>
<script language="CACHE" runat="SERVER">
   Do ##class(pageClasses.backendComponentMethods).renderBackendTextField(.efRulesVarBackendTextFieldAttr)
</script>
</csr:ACTION>
</csr:RULE>



<csr:RULE name="efBackendTextArea" match="EF:BACKEND:TEXTAREA" empty>
<csr:ACTION>
<script language="CACHE" runat="COMPILER">
   Do ..WriteServer(" kill efRulesVarBackendTextAreaAttr")
   kill paramsordered
   do ..GetAttributesOrdered(.paramsordered)
   set index=""
   for {
		set index=$o(paramsordered(index))
		if index="" quit
		set attr=$ZCVT($LIST(paramsordered(index),1),"L")
		set value=..QuoteAttribute(attr)
		Do ..WriteServer(" set efRulesVarBackendTextAreaAttr"_"("""_attr_""")="_value)
	}
</script>
<script language="CACHE" runat="SERVER">
   Do ##class(pageClasses.backendComponentMethods).renderBackendTextArea(.efRulesVarBackendTextAreaAttr)
</script>
</csr:ACTION>
</csr:RULE>



<csr:RULE name="efBackendURLField" match="EF:BACKEND:URLFIELD" empty>
<csr:ACTION>
<script language="CACHE" runat="COMPILER">
   Do ..WriteServer(" kill efRulesVarBackendURLFieldAttr")
   kill paramsordered
   do ..GetAttributesOrdered(.paramsordered)
   set index=""
   for {
		set index=$o(paramsordered(index))
		if index="" quit
		set attr=$ZCVT($LIST(paramsordered(index),1),"L")
		set value=..QuoteAttribute(attr)
		Do ..WriteServer(" set efRulesVarBackendURLFieldAttr"_"("""_attr_""")="_value)
	}
</script>
<script language="CACHE" runat="SERVER">
   Do ##class(pageClasses.backendComponentMethods).renderBackendURLField(.efRulesVarBackendURLFieldAttr)
</script>
</csr:ACTION>
</csr:RULE>


<csr:RULE name="efBackendImageUploader" match="EF:BACKEND:IMAGEUPLOADER" empty>
<csr:ACTION>
<script language="CACHE" runat="COMPILER">
   Do ..WriteServer(" kill efRulesVarImageUploaderAttr")
   kill paramsordered
   do ..GetAttributesOrdered(.paramsordered)
   set index=""
   for {
		set index=$o(paramsordered(index))
		if index="" quit
		set attr=$ZCVT($LIST(paramsordered(index),1),"L")
		set value=..QuoteAttribute(attr)
		Do ..WriteServer(" set efRulesVarImageUploaderAttr"_"("""_attr_""")="_value)
	}
</script>

<script language="CACHE" runat="SERVER">
   Do ##class(pageClasses.backendComponentMethods).renderImageUploader(.efRulesVarImageUploaderAttr)
</script>
</csr:ACTION>
</csr:RULE>


<csr:RULE name="efBackendSaveButton" match="EF:BACKEND:SAVEBUTTON" empty>
<csr:ACTION>
<script language="CACHE" runat="COMPILER">
   Do ..WriteServer(" kill efRulesVarBackendSaveButtonAttr")
   kill paramsordered
   do ..GetAttributesOrdered(.paramsordered)
   set index=""
   for {
		set index=$o(paramsordered(index))
		if index="" quit
		set attr=$ZCVT($LIST(paramsordered(index),1),"L")
		set value=..QuoteAttribute(attr)
		Do ..WriteServer(" set efRulesVarBackendSaveButtonAttr"_"("""_attr_""")="_value)
	}
</script>

<script language="CACHE" runat="SERVER">
   Do ##class(pageClasses.backendComponentMethods).renderBackendSaveButton(.efRulesVarBackendSaveButtonAttr)
</script>
</csr:ACTION>
</csr:RULE>

<csr:RULE name="efBackendButton" match="EF:BACKEND:BUTTON" empty>
<csr:ACTION>
<script language="CACHE" runat="COMPILER">
   Do ..WriteServer(" kill efRulesVarBackendButtonAttr")
   kill paramsordered
   do ..GetAttributesOrdered(.paramsordered)
   set index=""
   for {
		set index=$o(paramsordered(index))
		if index="" quit
		set attr=$ZCVT($LIST(paramsordered(index),1),"L")
		set value=..QuoteAttribute(attr)
		Do ..WriteServer(" set efRulesVarBackendButtonAttr"_"("""_attr_""")="_value)
	}
</script>

<script language="CACHE" runat="SERVER">
   Do ##class(pageClasses.backendComponentMethods).renderBackendButton(.efRulesVarBackendButtonAttr)
</script>
</csr:ACTION>
</csr:RULE>

<csr:RULE name="efBackendColorPicker" match="EF:BACKEND:COLORPICKER" empty>
<csr:ACTION>
<script language="CACHE" runat="COMPILER">
   Do ..WriteServer(" kill efRulesVarBackendColorPickerAttr")
   kill paramsordered
   do ..GetAttributesOrdered(.paramsordered)
   set index=""
   for {
		set index=$o(paramsordered(index))
		if index="" quit
		set attr=$ZCVT($LIST(paramsordered(index),1),"L")
		set value=..QuoteAttribute(attr)
		Do ..WriteServer(" set efRulesVarBackendColorPickerAttr"_"("""_attr_""")="_value)
	}
</script>

<script language="CACHE" runat="SERVER">
   Do ##class(pageClasses.backendComponentMethods).renderBackendColorPicker(.efRulesVarBackendColorPickerAttr)
</script>
</csr:ACTION>
</csr:RULE>

<csr:RULE name="efBackendInlineColorPicker" match="EF:BACKEND:INLINECOLORPICKER" empty>
<csr:ACTION>
<script language="CACHE" runat="COMPILER">
   Do ..WriteServer(" kill efRulesVarBackendInlineColorPickerAttr")
   kill paramsordered
   do ..GetAttributesOrdered(.paramsordered)
   set index=""
   for {
		set index=$o(paramsordered(index))
		if index="" quit
		set attr=$ZCVT($LIST(paramsordered(index),1),"L")
		set value=..QuoteAttribute(attr)
		Do ..WriteServer(" set efRulesVarBackendInlineColorPickerAttr"_"("""_attr_""")="_value)
	}
</script>

<script language="CACHE" runat="SERVER">
   Do ##class(pageClasses.backendComponentMethods).renderBackendInlineColorPicker(.efRulesVarBackendInlineColorPickerAttr)
</script>
</csr:ACTION>
</csr:RULE>

<csr:RULE name="efBackendErrorMessage" match="EF:BACKEND:ERRORMESSAGE:START" empty>
<csr:ACTION>
<script language="CACHE" runat="COMPILER">
   Do ..WriteServer(" kill efRulesVarBackendErrorMessage")
   kill paramsordered
   do ..GetAttributesOrdered(.paramsordered)
   set index=""
   for {
		set index=$o(paramsordered(index))
		if index="" quit
		set attr=$ZCVT($LIST(paramsordered(index),1),"L")
		set value=..QuoteAttribute(attr)
		Do ..WriteServer(" set efRulesVarBackendErrorMessage"_"("""_attr_""")="_value)
	}
</script>

<script language="CACHE" runat="SERVER">
   Do ##class(pageClasses.backendComponentMethods).renderBackendErrorMessageStart(.efRulesVarBackendErrorMessage)
</script>
</csr:ACTION>
</csr:RULE>

<csr:RULE name="efBackendErrorMessageEnd" match="EF:BACKEND:ERRORMESSAGE:STOP" empty>
<csr:ACTION>
<script language="CACHE" runat="SERVER">
   Do ##class(pageClasses.backendComponentMethods).renderBackendErrorMessageEnd(.efRulesVarBackendErrorMessage)
</script>
</csr:ACTION>
</csr:RULE>

<csr:RULE name="efPageControllerElement" match="ef-pc-element" empty>
<csr:ACTION>
<script language="CACHE" runat="COMPILER">
   Do ..WriteServer(" kill efRulesTempParams")
   kill paramsordered
   
   do ..GetAttributesOrdered(.paramsordered)
   set index=""
   for {
		set index=$o(paramsordered(index))
		if index="" quit
		set attr=$ZCVT($LIST(paramsordered(index),1),"L")
		set value=..QuoteAttribute(attr)
		Do ..WriteServer(" set efRulesTempParams"_"("""_attr_""")="_value)
	}
	
</script>

<script language="CACHE" runat="SERVER">

    set pageID = ##class(shared.pageMethods).getPageID()
    if pageID {
		set efRulesTempParams("pageid")=pageID
    }

   Do pageController.renderHTMLControlFromTag(.efRulesTempParams)
   kill efRulesTempParams
</script>
</csr:ACTION>
</csr:RULE>


<csr:rule name="efPageControllerContainer" match="ef-pc-container">

<csr:class super=%CSP.RuleBlock>

<csr:action>
	<SCRIPT LANGUAGE=CACHE RUNAT=COMPILER>
		Do ..NewBlock()
		Set ..NextLabel=..GetNewLabel()
		Do ..WriteServer(" kill efRulesTempParams")
		kill paramsordered
		do ..GetAttributesOrdered(.paramsordered)
		set index=""
		for {
			set index=$o(paramsordered(index))
			if index="" quit
			set attr=$ZCVT($LIST(paramsordered(index),1),"L")
			set value=..QuoteAttribute(attr)
			Do ..WriteServer(" set efRulesTempParams"_"("""_attr_""")="_value)
		}
		Do ..WriteServer(" if 'pageController.showElementFromTag(.efRulesTempParams) Goto "_..NextLabel_" ;{")
	</SCRIPT>
	<script language="CACHE" runat="SERVER">
	   Do pageController.renderContainerStartFromTag(.efRulesTempParams)
	   kill efRulesTempParams
	</script>
	<csr:children>
	<SCRIPT LANGUAGE=CACHE RUNAT=COMPILER>
		Do ..WriteServer(" kill efRulesTempParams")
		kill paramsordered
		do ..GetAttributesOrdered(.paramsordered)
		set index=""
		for {
			set index=$o(paramsordered(index))
			if index="" quit
			set attr=$ZCVT($LIST(paramsordered(index),1),"L")
			set value=..QuoteAttribute(attr)
			Do ..WriteServer(" set efRulesTempParams"_"("""_attr_""")="_value)
		}
		Do ..WriteServer(" if 'pageController.showElementFromTag(.efRulesTempParams) Goto "_..NextLabel_" ;{")
	</SCRIPT>
	<script language="CACHE" runat="SERVER">
	   Do pageController.renderContainerEndFromTag(.efRulesTempParams)
	</script>
	<SCRIPT LANGUAGE=CACHE RUNAT=COMPILER>

		New comment Set comment=" ;} END Container"
		If ..NextLabel'="" Do ..WriteServer(..NextLabel_comment)
		Do ..RemoveBlock()
	</SCRIPT>
</csr:action>
</csr:rule>

<csr:RULE name="efFrontendlabel" match="ef-label" empty>
<csr:ACTION>
<script language="CACHE" runat="COMPILER">
   Do ..WriteServer(" kill efRulesTempParams")
   kill paramsordered
   do ..GetAttributesOrdered(.paramsordered)
   set index=""
   for {
		set index=$o(paramsordered(index))
		if index="" quit
		set attr=$ZCVT($LIST(paramsordered(index),1),"L")
		set value=..QuoteAttribute(attr)
		Do ..WriteServer(" set efRulesTempParams"_"("""_attr_""")="_value)
	}
</script>

<script language="CACHE" runat="SERVER">
   do ##class(EF.ui.components.frontend.label).renderFromEfLabelRule(.efRulesTempParams)
   kill efRulesTempParams
</script>
</csr:ACTION>
</csr:RULE>

<csr:RULE name="efAwardsCategoryDropdown" match="ef-awards-category-dropdown" empty>
<csr:ACTION>
<script language="CACHE" runat="COMPILER">
   Do ..WriteServer(" kill efRulesTempParams")
   kill paramsordered
   do ..GetAttributesOrdered(.paramsordered)
   set index=""
   for {
		set index=$o(paramsordered(index))
		if index="" quit
		set attr=$ZCVT($LIST(paramsordered(index),1),"L")
		set value=..QuoteAttribute(attr)
		Do ..WriteServer(" set efRulesTempParams"_"("""_attr_""")="_value)
	}
</script>

<script language="CACHE" runat="SERVER">
   do ##class(EF.ui.backend.controls.awardsCategoryDropdown).renderFromEfLabelRule(.efRulesTempParams)
   kill efRulesTempParams
</script>
</csr:ACTION>
</csr:RULE>
]]></CSP>


<Class name="layout.cssDefaultMethods">
<Description><![CDATA[
<!-- ;vc;-
;vc;    Object: layout.cssDefaultMethods.CLS/EV.78
;vc; Component: CLS.layout.cssDefaultMethods
;vc;  Location: SmallDev
;vc; Date/Time: 02-Sep-16 14:26
;vc;      User: JeremyW
;vc; --><p>VC/m status:<table id='vcm' border='1'><tr><th>Object</th><th>Component</th><th>Location</th><th>Date/Time</th><th>User</th></tr><tr><td>layout.cssDefaultMethods.CLS/EV.78</td><td>CLS.layout.cssDefaultMethods</td><td>SmallDev</td><td style='white-space: nowrap;'>02-Sep-16 14:26</td><td>JeremyW</td></tr></table>
]]></Description>
<Abstract>1</Abstract>
<ClassType/>
<ProcedureBlock>1</ProcedureBlock>
<TimeChanged>64183,51353.148476</TimeChanged>
<TimeCreated>63046,56232.897117</TimeCreated>

<Method name="outputDefaultCSS">
<ClassMethod>1</ClassMethod>
<FormalSpec>xEventID,layoutTemplateID</FormalSpec>
<ReturnType>%String</ReturnType>
<Implementation><![CDATA[
	do ..outputComponentCSS()
	w "<style>",!
	
	do ..outputFonts()
	do ..outputGeneralCSS()
	do ..outputGeneralProgressBarCSS()
	do ..outputGeneralKendoCSS()
	if '##class(layout.objTemplate).isTemplateGen3(layoutTemplateID)	{
		do ..outputLegacyClasses()	
	}
	do ..outputSegmentedButtonCSS()
	do ..outputAgendaGridListSwitchCSS()
	do ..outputAgendaGeneralCSS()
	do ..outputAgendaPopoverCSS()
	
	if ##class(layout.objTemplate).isTemplateGen3(layoutTemplateID)	{
		do ..outputGen2and3Defaults()
		do ..outputGen3Defaults()
		do ##class(layout.cssOverrideMethods).outputDynamicCSS(xEventID)
	}
	w !,"</style>",!
]]></Implementation>
</Method>

<Method name="outputLegacyClasses">
<Description>
yellow red grey etc. Used for ALL templates below gen3</Description>
<ClassMethod>1</ClassMethod>
<Implementation><![CDATA[
	&html<
		/* ======= outputLegacyClasses() ======= */
		a {
			color: #111111; 
		}
		a:hover { 
			color: #666666;
		}
		.yellow {background-color: #F4F4F4;}
		.grey {background-color: #e6e6e6;}
		.red, .k-calendar td.ef-date-picker-event-day {
			background-color : SILVER;
		}
		.k-calendar td.ef-date-picker-event-day {
			border-radius: 0;
		}
		.ef-time-span {
			white-space: nowrap;	
		}
		
		div.ef-button-area .ef_frontend_button_proceed,div.ef-button-area .ef-logout-button {
			float : right;
			margin-right: 0px;
			margin-left: 12px;
		}
		.k-picker-wrap .k-select {
			padding-top: 1px;	
		}
		
		input.efDatePicker, input.efTimePicker { 
			/* input box */
			margin: 0px;
			border-width: 0px;

			color: inherit;
		}

		.efDatePicker .k-picker-wrap, .efTimePicker .k-picker-wrap {
			/* inner span */
			padding: 0px;
			margin: 0px;
		}

		.efDatePicker, .efTimePicker {
			/* out span */
			padding: 0px;
			margin:0px;
		}
		
			
		
	>
]]></Implementation>
</Method>

<Method name="outputGen2and3Defaults">
<ClassMethod>1</ClassMethod>
<Implementation><![CDATA[
	&html<
		/* ======= outputGen2and3Defaults() ======= */
		.ef-registration-section input[type=text],
		.ef-registration-section input[type=password],
		.ef-registration-section input[type=number],
		.ef-registration-section input[type=url],
		.ef-registration-section input[type=tel],
		.ef-registration-section input[type=email],
		.ef-registration-section textarea, 
		.ef-registration-section select,
		.EF_inputBox,ef-table-booking-footer,
		.select2-dropdown {
			font-family: Verdana, Arial, Helvetica, sans-serif; 
			font-size: 14px; 
			font-style: normal; 
			line-height: normal; 
			font-weight: normal; 
			text-decoration: none;			
		}
		.select2-container .select2-selection--single .select2-selection__rendered {
			padding-left: 5px;
		}
		.ef-registration-section input[type=text]:not(.efDatePicker):not(.efTimePicker) ,
		.ef-registration-section input[type=password],
		.ef-registration-section input[type=number],
		.ef-registration-section input[type=url],
		.ef-registration-section input[type=tel],
		.ef-registration-section input[type=email],
		.ef-registration-section textarea, 
		.ef-registration-section select,
		.EF_inputBox:not(.efDatePicker):not(.efTimePicker) {
			padding: 5px;
			margin-top: 2px;
			margin-bottom: 2px;
			border-width: 1px;
			border-style: solid; 
		}

		.ef-registration-section .select2-container {
			padding: 2px 0 2px 0;
		}
		.ef-registration-section .select2-container--default .select2-selection--single {
			background: none;
			border: none;
		}
		.ef-registration-section input[type=text],
		.ef-registration-section input[type=password],
		.ef-registration-section input[type=number],
		.ef-registration-section input[type=url],
		.ef-registration-section input[type=tel],
		.ef-registration-section input[type=email],
		.ef-registration-section textarea, 
		.ef-registration-section select {
			max-width: 481px;
			width: 89%;
		}
	
		
		@font-face {
		  font-family: 'Roboto Slab';
		  font-style: normal;
		  font-weight: 300;
		  src: local('Roboto Slab Light'), local('RobotoSlab-Light'), url(https://themes.googleusercontent.com/static/fonts/robotoslab/v1/dazS1PrQQuCxC3iOAJFEJR_xHqYgAV9Bl_ZQbYUxnQU.woff) format('woff');
		}
		@font-face {
		  font-family: 'Roboto Slab';
		  font-style: normal;
		  font-weight: 400;
		  src: local('Roboto Slab Regular'), local('RobotoSlab-Regular'), url(https://themes.googleusercontent.com/static/fonts/robotoslab/v1/y7lebkjgREBJK96VQi37ZobN6UDyHWBl620a-IRfuBk.woff) format('woff');
		}
		@font-face {
		  font-family: 'Roboto Slab';
		  font-style: normal;
		  font-weight: 700;
		  src: local('Roboto Slab Bold'), local('RobotoSlab-Bold'), url(https://themes.googleusercontent.com/static/fonts/robotoslab/v1/dazS1PrQQuCxC3iOAJFEJTqR_3kx9_hJXbbyU8S6IN0.woff) format('woff');
		}
 		
		.k-datepicker, .k-timepicker {
			border-radius: 0;
		}
		
		.k-picker-wrap {
			border-radius: 0;
			border:none;
		}
		.k-picker-wrap .k-input {
			border-radius: 0;
		}
		
		.ef_frontend_button, .standardButton, .strongButton, .hyperlinkButton, .ef_frontend_file_uploader .k-upload-button {
			margin-top:15px;
			
		}
		
		.ef-table .ef_frontend_button,
		.ef-table .standardButton,
		.ef-table .strongButton,
		.ef-table .hyperlinkButton,
		.ef-registration-section .ef_frontend_button,
		.ef-registration-section .standardButton,
		.ef-registration-section .strongButton,
		.ef-registration-section .hyperlinkButton,
		.ef-registration-section .ef_frontend_file_uploader .k-upload-button {
			margin-top:0px;
			
		}
		.ef_frontend_button, .ef_frontend_file_uploader .k-upload-button {
			cursor: pointer;
			font-family: Verdana, Arial, Helvetica, sans-serif;
			font-weight: normal;
			padding: 6px 15px;
			cursor: pointer;
			font-size: 12px;
			width: auto;
			-moz-border-radius: 5px;
			border-radius: 5px;
			line-height: 18px;
		}
		.ef_frontend_button:hover, .ef_frontend_file_uploader .k-upload-button {
			text-decoration: none;
			background-image:inherit;
			background-position:inherit;
			box-shadow: none;
		}
		.ef_frontend_button_proceed:hover {
			text-decoration: none;
		}
		.ef_proweb_form_prompt {
			text-align: right;
		}
		.ef-required-field::after {
		    content: " *";
		    color: red;			
		}

		.ef-registration-section td label {
			display: inline-block;
		    font-weight: normal;
		    margin-bottom: 0;
		    width: 100%;
		}		

		.ef-registration-section td.ef_proweb_form_prompt label {
		    text-align: right;
		}
		.ef-registration-section label.ef-radio {
			display: inline;
		   
		}
		
		
		body, p, h2, h3, td, div, .black10px, .blackbold10px, .black12px, .blackbold12px, .red9px, .whitebold12px,
		.ef_proweb_menu_ul, .ef_proweb_menu_ul a, .dropdown .btn, .EF_inputBox, .ef_frontend_button,
		.ef_frontend_file_uploader .k-upload-button, .ef_frontend_button:hover, .ef_frontend_file_uploader .k-upload-button:hover,
		.ef_frontend_button_proceed, .ef_frontend_button_proceed:hover, td.ef_proweb_form_prompt,
		.whitebold10px, a.whitebold10px:hover, .yellow, td.yellow, .grey, td.grey,
		.ef_progress_bar_text, .ef-table th,
		.ef-registration-section input[type=text],
		.ef-registration-section input[type=password],
		.ef-registration-section input[type=number],
		.ef-registration-section input[type=url],
		.ef-registration-section input[type=tel],
		.ef-registration-section textarea, 
		.ef-registration-section select {
			font-family: Verdana, Geneva, Kalimati, sans-serif;
		}
		body {
			background-color: #96C3C8;
		}
		h1 {
			color: #17b3c4;
			font-family: 'Roboto Slab',Verdana,Arial,Helvetica,sans-serif	
		}
		.ef_proweb_menu_ul, .ef_proweb_menu_ul a, .dropdown .btn,
		.select2-container--default .select2-results__option--highlighted[aria-selected]  {
			background-color: #17b3c4;	
			color: #FFFFFF;
		}
	>
	w ".ef_proweb_menu_ul li:hover, .ef_proweb_menu_ul a:hover, .dropdown .btn:hover, .dropdown .btn:focus, .open>.dropdown-toggle.btn-primary"
	w "	  {"
	w "		background-color: #128996;"
	w "		color: #FFFFFF;"
	w "	}"
	&html<
		.EF_inputBox, 
		.ef-registration-section input[type=text],
		.ef-registration-section input[type=password],
		.ef-registration-section input[type=number],
		.ef-registration-section input[type=url],
		.ef-registration-section input[type=tel],
		.ef-registration-section textarea, 
		.ef-registration-section select,
		.select2-dropdown,
		.select2-container--default .select2-selection--single .select2-selection__rendered {
			background-color: #D8ECEE; 
			color: #111111;
			border-color: #AAAAAA;
		}
		.select2-container--default .select2-selection--single .select2-selection__placeholder {
			color: inherit;
		}
		.ef-registration-section input[type=text]:disabled,
		.ef-registration-section input[type=password]:disabled,
		.ef-registration-section input[type=number]:disabled,
		.ef-registration-section input[type=url]:disabled,
		.ef-registration-section input[type=tel]:disabled,
		.ef-registration-section textarea:disabled, 
		.ef-registration-section select:disabled {
			background-color: #EEEEEE; 
		}
		.ef_form_divider {
			color: #17b3c4;
			border-color:#17b3c4;
			background-color: #17b3c4;
		}
		.ef_progress_bar_progress_div {	
			background-color:#17b3c4;
		}
		.ef_progress_bar_border_div {	
			border: 1px solid  #AAAAAA;
		}
		.ef_frontend_button, .ef_frontend_file_uploader .k-upload-button {
			color: #111111;
			background-color: #96C3C8;
			border: 1px solid #AAAAAA;
		}
		.ef_frontend_button:hover, .ef_frontend_file_uploader .k-upload-button:hover {
			color: #111111;
			background-color: #D8ECEE;
		}
		.ef_frontend_button_proceed {
			color: #FFFFFF;
			background-color: #17b3c4;
			border: 1px solid #FFFFFF;
		}
		
		.ef_frontend_button_proceed:hover {
			color: #FFFFFF;
			background-color: #128996;
		}
		.ef_frontend_file_uploader .k-file-progress .k-progress {
		    background-color:#17b3c4
		}

		.ef_frontend_help_text_icon {
			background-color: #17b3c4;
			color: #FFFFFF;
			border-color: #128996;
		}
		.ef_frontend_help_text_popover {
			background-color: #17b3c4;
			border-color: #128996;
		}
		.ef_frontend_help_text_popover .ui-tooltip-tip, .ef_frontend_help_text_popover .qtip-tip {
			border-color: #128996;
			background-color: #17b3c4;
		}
		.ef-table-header td, 
		.ef-table-header th,
		.ef-table th {
			background-color:  #128996;
			color: #FFFFFF;
		}
		.ef-table-header a {
			color: inherit;
		}
		.ef-info-table td:first-child {
		    color: #888888;
		}
		.select2-container--default .select2-results__option[aria-selected=true] {
		    background: none;
		}
		
		.k-calendar td.ef-date-picker-event-day {
			background-color: silver;
			border-radius: 0;
		}
		input[type=checkbox].ef-multicheckbox  {
			margin-left: 0px;
			margin-right: 10px;	
		}
		.ef-multicheckbox-checkbox-label  {
			margin-left: 0px;
			margin-right: 10px;	
		}		
	>
	w " .ef_frontend_help_text_content>pre { color: #FFFFFF}"
]]></Implementation>
</Method>

<Method name="outputGen2Defaults">
<ClassMethod>1</ClassMethod>
<Implementation><![CDATA[
	&html<
		.ef-logo {padding-bottom:16px;}
		.red, .k-calendar td.ef-date-picker-event-day {
			background-color: #128996;
		}
		.whitebold10px, a.whitebold10px:hover {
			color: #FFFFFF;
		}
		/* changed box-sizing for Gen2 to make the selects the same widths as the inputs */
		.ef-registration-section select {
			-ms-box-sizing:content-box;
    		-moz-box-sizing:content-box;
    		box-sizing:content-box;
    		-webkit-box-sizing:content-box; 
		}
		.EF_inputBox.efDatePicker {
			padding: 0px;
		}
		
		.EF_inputBox.efTimePicker {
			padding: 0px;	
		}
		input.k-input, .ef-registration-section input.k-input {
			height: 28px;
		}
		.k-picker-wrap .k-select {
			border-left: 0;
		}
		
		.efDatePicker .k-picker-wrap,.efTimePicker .k-picker-wrap{
			/* inner span */
			padding-right: 26px;
		}
		.k-picker-wrap .k-select {
			padding-top: 6px;	
		}

	>
]]></Implementation>
</Method>

<Method name="outputGen3Defaults">
<ClassMethod>1</ClassMethod>
<Implementation><![CDATA[
	&html<
		/* ======= outputGen3Defaults() ======= */
		.ef-custom-content-section img {
		  display: block;
		  max-width: 100%;
		  height: auto;
		}		
		
		a {
			color: #111111; 
			text-decoration:underline;
		}
		a:hover {
			color: #666666;
			text-decoration:underline;
		}
		/* THIS BIT IF FOR THE NEW TABLE CLASSESS */
		.ef-table td {
			color: BLACK;
			border-collapse: collapse;	
		}
		.ef-table-header
		 {
			background-color: SILVER;	
		}
		.ef-table-header td, 
		.ef-table-header th
		 {
			font-weight: bold;
			font-size: 12px;
			vertical-align: bottom;
		}
		.ef-instructionText {
			color: BLACK !important;	/* '!important' to override element style in markup */
			margin-left: 0px !important;	
		}

		.ef-table tr:nth-child(odd) {
		    background-color: #e6e6e6;
		}
		.ef-table tr:nth-child(even) {
		    background-color: #F4F4F4;
		}
		.ef-table tr.ef-row-odd, tr.ef-row-odd {
			background-color: #E6E6E6; 
		}
		.ef-table tr.ef-row-even, tr.ef-row-even {
			background-color: #F4F4F4; 
		}
		.ef-table table tr:nth-child(n) { /* used to stop the striping where each line is a table within a table */
			background-color: inherit;
			padding: 0px;
		}
		.ef-image-table	{
			table-layout: fixed;	/* needed for responsive images*/ 
		}
		.ef-logo { 
			padding-top:16px;
		}
		@media only screen and (min-width: 768px) {
			div.ef-button-area .ef_frontend_button_proceed,div.ef-button-area .ef-logout-button {
				float : right;
				margin-right: 0px;
				margin-left: 12px;
			}
		}
		.ef-table-booking-footer {
			margin-left: 20px;	
		}
		/* THIS BIT IS FOR OOVERRIDING BOOTSTRAP */
		input[type=radio], input[type=checkbox] {
		    margin: 3px 3px 3px 3px;
		}

		.ef-ie6 .container, .ef-ie7 .container, .ef-ie8 .container  {
	            width: 970px; 
	        }
	        #timeoutbox {
				font-size: 12px;
				padding: 12px;
				font-weight: normal;

	        }	
		.ef-table h4 {
			font-size: 12px;
			font-weight: bold;	
		}
		
		[class*="col-"] .select2-container {
		    width:89%!important;
		    max-width: 481px;
		}
		

	>
	write ".dropdown .btn, .btn-primary:hover, .btn-primary:focus, .btn-primary:active, .btn-primary.active, .open > .dropdown-toggle.btn-primary {",!
	write "	border-color: #FFFFFF;",!	
	write "}",!
]]></Implementation>
</Method>

<Method name="outputComponentCSS">
<ClassMethod>1</ClassMethod>
<Implementation><![CDATA[
	set eventID=$G(%session.Data("eventsforce","frontend","xEventID"))
	if eventID {
		set layoutTemplateID=##class(layout.objTemplate).getLayoutForEvent(eventID)
		if ##class(layout.objTemplate).isTemplateUsingBootstrap(layoutTemplateID) {
			&html<
				<!-- ======= outputComponentCSS() ======= -->
				<link rel="stylesheet" href="//netdna.bootstrapcdn.com/bootstrap/3.2.0/css/bootstrap.min.css" type="text/css" />
			>
		}
	}
	&html<

		<link type="text/css" href="#(##class(EF.htmlGenerator).rawHTML(##class(shared.pageMethodsFrontend).getKendoBaseURL()))#/styles/kendo.common.min.css" rel="Stylesheet" />
		<link type="text/css" href="#(##class(EF.htmlGenerator).rawHTML(##class(shared.pageMethodsFrontend).getKendoBaseURL()))#/styles/kendo.silver.min.css" rel="Stylesheet" />

		<link rel="stylesheet" type="text/css" media="screen" href="//cdn.jsdelivr.net/qtip2/2.2.1/jquery.qtip.min.css" />
		
		<link rel="stylesheet" type="text/css" media="screen" href="//cdnjs.cloudflare.com/ajax/libs/select2/4.0.0/css/select2.min.css" />
		<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.5.0/css/font-awesome.min.css">	
	>
]]></Implementation>
</Method>

<Method name="outputFonts">
<ClassMethod>1</ClassMethod>
<Implementation><![CDATA[
	
	&html<
	/* ======= outputFonts() ======= */
	@font-face { 
		font-family: 'CasinoHandRegular';
		src: url('../../media/components/frontend/fonts/Casino_Hand-webfont.eot');
		src: url('../../media/components/frontend/fonts/Casino_Hand-webfont.eot?#iefix') format('embedded-opentype'),
    	url('../../media/components/frontend/fonts/Casino_Hand-webfont.woff') format('woff'),
    	url('../../media/components/frontend/fonts/Casino_Hand-webfont.ttf') format('truetype'),
    	url('../../media/components/frontend/fonts/Casino_Hand-webfont.svg#CasinoHandRegular') format('svg');
    	font-weight: normal;
    	font-style: normal;
	}
	>
	/* end @font-face declarations */
]]></Implementation>
</Method>

<Method name="outputGeneralProgressBarCSS">
<ClassMethod>1</ClassMethod>
<Implementation><![CDATA[
	&html<
		/* ======= outputGeneralProgressBarCSS() ======= */
		.ef_progress_bar_border_div {
			width: 100%;
			max-width: 300px;
			border: 1px solid #AAAAAA;
			height: 12px;
			text-align: center;
			box-sizing: content-box;
			margin: 4px auto 4px auto;
			display:block;
		}
		.ef_progress_bar_progress_div {
			height: 100%;
			border: none;
			background-color: rgb(220, 220, 220);
			text-align: left;
			float: left;
		}
		.ef_progress_bar_text {
			color: #666666;
			font-size: 12px;
			font-style: normal;
			line-height: normal;
			padding:4px;
			text-align: center;
			display:block;
		}
		#ef_progressbar {
			margin-bottom: 12px;	
		}	
	>
]]></Implementation>
</Method>

<Method name="outputGeneralKendoCSS">
<ClassMethod>1</ClassMethod>
<Implementation><![CDATA[
	&html<
		/* ======= outputGeneralKendoCSS() ======= */ 
		
		/* date picker tweaking */

		

		.efDatePicker .k-picker-wrap, .efTimePicker .k-picker-wrap {
			border-width: 1px;
			border-style: solid;
			border-color: inherit;
			color: inherit;
		}
		.efDatePicker, .efTimePicker {
			border-width: 0px;
		}
		
		.k-picker-wrap {
			border-radius: 0;
		}
		.k-picker-wrap .k-input {
			border-radius: 0;
		}
		
		.ef_frontend_file_uploader .k-upload-status {
			display: none;	
		}
		.ef-ie8 .ef_frontend_file_uploader .k-upload-status,
		.ef-ie9 .ef_frontend_file_uploader .k-upload-status {
			display: block;
			position: inherit;
			margin-top: 16px;
			font-weight: normal;
		}
		.ef_frontend_file_uploader .k-upload {
 			position: inherit;
 			border-width:0px;
 			background: none;
		}
		.ef_frontend_file_uploader {
			background-color: inherit;
		}
		.ef_frontend_file_uploader .k-upload-button {
			margin-top:16px;
 			margin-bottom: 16px;
			margin-left: 0px;
			margin-right: 0px;
			line-height: 12px;
			float: left;
			clear: left;
		}
		
	    .ef_frontend_file_uploader .k-upload-files {
	     	border: 0px;   
	    }
	    .ef_frontend_file_uploader .k-file {
	     	border: 0px;
	     	background-color: inherit;
	    }
	    .ef_file_wrapper {
		    color: #000000;
		    text-align: left;
		    width: 100%
	    }
	    .ef_frontend_file_uploader .k-file-progress .k-progress {
		    background-color: #777777;
		}
		.ef_frontend_file_upload_progress_container {
			width:100%;
			position: relative;
			float: left;
			clear: left;
		}
	    li.k-file div.ef_file_wrapper
	    {
	        position: relative;
	    }
	    .ef_file_wrapper {
		 	margin-left:12px;
		 	margin-right:12px;
		 	margin-bottom:6px;  
		 	margin-top:6px;
	    }
	    .ef_frontend_file_uploader.k-content {
		    min-height: 84px;
		    width: 100%;
		    text-align: right;
	    }
	    
	    .ef_frontend_file_uploader .k-upload-files {
		 	line-height: 18px; 
	    }
	    
	>
]]></Implementation>
</Method>

<Method name="outputGeneralCSS">
<Description>
The basic frontend default stuff</Description>
<ClassMethod>1</ClassMethod>
<Implementation><![CDATA[
	&html<
		/* ======= outputGeneralCSS() ======= */ 
		.ef-registration-section input[type=text],
		.ef-registration-section input[type=password],
		.ef-registration-section input[type=number],
		.ef-registration-section input[type=url],
		.ef-registration-section input[type=tel],
		.ef-registration-section input[type=email],
		.ef-registration-section textarea, 
		.ef-registration-section select {
			width: 360px;
		}
		.ef-table {
		    width: 100%;
	    	margin-top: 10px;
	    	margin-bottom: 10px;
		}
		
		.ef-table td {
			padding-top: 7px;
			padding-bottom: 7px;
			padding-left: 8px;
			padding-right: 8px;
		}
		
		/* For embedded tables */
		.ef-table table td {
			padding-top: 0;
			padding-bottom: 0;
			padding-left: 0;
			padding-right: 0;
		}
		
		table.ef-registration-section {
			border-collapse: collapse;
			border-spacing: 0;
			border:0;
		}
		table.ef-registration-section td {
			padding-top: 4px;
			padding-bottom: 4px;
			padding-left: 4px;
			padding-right: 4px;
		}
		
		/* For embedded tables */
		.ef-registration-section table td {
			padding-top: 0;
			padding-bottom: 0;
			padding-left: 0;
			padding-right: 0;
		}

		.ef-registration-section label.ef-radio {
		    margin-right: 12px;
		}
		
		.ef-table .ef-item-discount {
			padding-left: 24px;	
		}
		.noPrint { 
		
		}
		@media print {
			.noPrint { 
				display:none; 
			}
			 a[href]:after {
   				 content: none !important;
  			}
  			a:link {
	  			text-decoration: none;	
  			}
		}
		.ef_form_divider {
			height: 2px;
			border: 0px;
			border-top: 0px solid;
			border-bottom: 0px solid;
			margin-top: 12px;
			margin-bottom: 12px;	
		}
		td.ef_proweb_form_prompt {
			width:31%;
		}
		.ef-registration-section table td.ef_proweb_form_prompt_dependent {
			padding-right: 6px;	
		}
		.ef-registration-section table td.ef_proweb_form_input_dependent {
			padding-left: 3px;	
		}
		.ef_element {
			margin-left: 0px;	
		}
		.ef_element_dependent_disabled_but_visible,
		.select2-container.ef_element_dependent_disabled_but_visible {
			background-color: #DDDDDD;
		}
			
		/* mandatory prompt asterisk */
		.mandatory {
			color: red;	
		}
		
		.ef_frontend_text_limit_exceeded {
			color: red;		
		}
		
		img.helpIcon {
			vertical-align: middle;
		}
		
		/* highlighted mandatory form fields */
		.EF_inputBox.mandatoryIgnored,
		.mandatoryIgnored,
		.ef-registration-section .EF_inputBox.mandatoryIgnored,
		.ef-registration-section .mandatoryIgnored,
		.ef-registration-section .select2-container--default.mandatoryIgnored .select2-selection--single .select2-selection__rendered {
			background-color: #fc9d9d;	
		}
		/* remove spacing on hidden dep prompts + text blocks */
		.hiddenDep { display: none; } 
		/* general instructions text style */
		.ef_frontend_instructions_text {
			font-family: CasinoHandRegular, Verdana, Arial, Helvetica, sans-serif;
			font-size: 16px;
		}
		
		.ef_frontend_overflow_ellipsis {
			white-space: nowrap;
	   		overflow: hidden;
			text-overflow: ellipsis;
			-o-text-overflow: ellipsis;
			-ms-text-overflow: ellipsis;
		}
		
		.ef_frontend_button, .ef_frontend_file_uploader .k-upload-button {
			font-family: Verdana, Geneva, Arial, Helvetica, sans-serif;
			font-weight: bold;
			font-size: 9px;
			text-decoration: none;
			color: black;
		}
		.standardButton {
		}
		.strongButton {
		}
		.hyperlinkButton {
		}
		.ef_frontend_button_proceed {
			min-width:85px;
		}
		.ef_frontend_button_back {
			min-width:85px;
		}
		.ef_frontend_help_text_icon {
			background-color: rgb(220,220,220);
			color: rgb(0,0,0);
			font: 12px Helvetica, Verdana, Arial, sans-serif;
			font-weight: 800;
			height: 16px;
			width: 16px;
			-moz-border-radius: 12px;
			-webkit-border-radius: 12px;
			border-radius: 12px;
			cursor: default;
			display: inline-block;
			text-align: center;
			margin-left: 12px;
			border-width: 1px;
			border-style: solid;
			border-color: #AAAAAA;
			line-height: 17px;
			text-indent: 0;
		}
		.ef_frontend_help_text_popover {
			background-color: rgb(220,220,220);
			border-color: #AAAAAA;
			-moz-border-radius: 6px;
			-webkit-border-radius: 6px;
			border-radius: 6px;
			-webkit-box-shadow: 0px 0px 10px 0px rgb(100,100,100);
			-moz-box-shadow: 0px 0px 10px 0px rgb(100,100,100);
			box-shadow: 0px 0px 10px 0px rgb(100,100,100);
		}
		.ef_frontend_help_text_popover div {
			margin: 0;
		}
		.ef_frontend_help_text_popover .ui-tooltip-tip, .ef_frontend_help_text_popover .qtip-tip {
			border-color: #AAAAAA;
			background-color: rgb(220,220,220);
		}
		
		
		.ef-awards-review hr {
			margin-top: 24px;	
			margin-bottom: 12px;	
		}
		.ef-awards-review h2 {
			margin-bottom:20px;
		}
		.ef-awards-criteria-header {
			padding-bottom:12px;	
		}
		
		.ef-awards-review label {
			font-weight: normal;
		}
		.ef-awards-review .ef-info-label {
			font-weight: bold;
		}
		.ef-primary-field {
			font-weight: bold;	
		}
		.ef-awards-review .reviewDivs {
			padding-top:12px;	
		}
		div.ef-button-area {
			margin-top: 6px;
			margin-bottom: 6px;	
		}
		.ef-button-area .ef_frontend_button, .ef-button-area a {
			margin-top: 6px;
			margin-bottom: 6px;
			margin-right:12px;
		}
		.ef-button-area a {
			white-space:nowrap;		
		}
		
		.ef-meeting-manager-contentbox {
			margin: 12px 0px 12px 0px;
			font-size: 10pt;
			background-color: #F2F2F2;
			border: 1px solid black;
			padding-left: 4px;
			padding-right: 4px;
			padding-top: 4px;
			padding-bottom: 4px;

		}
		
	>
	w " .ef_frontend_help_text_content>pre {",!
	&html<
			color: rgb(0,0,0);
			background-color: transparent;
			border: none;
			padding: 0px;
			font:  12px Helvetica, Verdana, Arial, sans-serif;
			margin: 0px;
			overflow: hidden;
			white-space: pre-wrap;       /* css-3 */
			white-space: -moz-pre-wrap;  /* Mozilla, since 1999 */
			white-space: -pre-wrap;      /* Opera 4-6 */
			white-space: -o-pre-wrap;    /* Opera 7 */
			word-wrap: normal;
			word-break: normal;
		}

		.ef_proweb_form_field_container textarea {
		    resize: vertical;
		}

		#top {position: absolute; top: -8em; display: none} /*Opera*/
		* html #top {display: block; position: absolute; top: -8em; left: 0; z-index: 0} /*Seen by IE*/
		html:not([dummy]) #top {display: block; position: absolute; top: -8em; left: 0; z-index: 0} /*Seen by Moz and FF*/
		/* class for reg prompt table rows while being dragged in edit mode */
		.tDnD_whileDrag {
			background-color:#F0F0F0;
		}
		/*  transparent BG for new templates which add a bg image/color to Moxie */
		.transparentMoxieBG {
			background: transparent none;
		}
		.ef_frontend_presenter_details_biography {
			max-width: 600px;
		}
		.ef_frontend_presenter_details_picture img {
			max-width: 200px;
		}
		.ef_frontend_presenter_details_title_and_name h1 {
			margin-bottom: 8px;
		}
		.ef_frontend_presenter_details_job_title h4 {
			font-weight: 700;
			margin: 0;
		}
		.ef_frontend_presenter_details_company h4 {
			font-weight: 400;
			margin: 0 0 1rem 0;
		}
		.ef-menu-block {
	    	margin-bottom: 20px;
		}
		.ef-menu-block .dropdown-menu {
		    top: auto;
		}

		#timeoutbox {
			position: absolute;
			top: 40%;
			left: 50%;
			width:300px;
			margin-left: -150px;
			z-index: 9999;
			background-color:#ffffff;
			padding:5px;
			border:1px;
			solid #666;
			text-align:center;
			font-weight:bold;
			visibility:hidden;
			-moz-border-radius: 11px;
			-webkit-border-radius: 11px;
			border-radius: 11px;	
		}
		#socialMediaModule{
			width:100%;
			height:100%;
			margin:10px 0px 20px 0px;
			z-index:999;
		}
    	#smShareButtons{
	    	height: 30px; }
    	.addthis_toolbox {
	    	height: 30px;
	    }
    	#smFollowButtons{
	    	margin:20px 0px;
	    }
    	#smFollowButtons img{
	    	vertical-align:bottom;
	    	*vertical-align:middle;
	    	border:0px;
	    	margin:0px 5px;
	    }
    	#smShareButtons .a{
	    	margin:2px 4px 0px;
	    }
    	#socialMediaModuleMenu{
	    	width:100px;
	    	height:40px;
	    	display:block;
	    }		    
    	#smFollowButtonsMenu{
	    	float:left;
	    	padding:0px 20px;
	    }
    	#smFollowButtonsMenu img{
	    	vertical-align:bottom;
	    	margin:5px 10px;
	    	border:0px;
	    }
		.ef-table-sub-heading {
			background-color: #CCCCCC;
			font-weight: bold;
		}
	
		.ef_proweb_form_field_container_type_textarea .ef_frontend_help_text_icon {
			vertical-align: top;
		}
		.ef-info-table td:first-child {
		    text-align: right;
		    padding-right: 5px;
		    min-width: 120px;
		}

		.ef-session-time {
			vertical-align: top;	
			text-align: right;
			width: 150px;
		}
		
		.ef-date-time,
		.ef-session-price,
		.ef-no-wrap {
			white-space: nowrap;
		}
		.ef-table .ef-author-name {
			padding-top: 0px;
		}
		.ef-table .ef-abstract-description {
			padding-bottom: 0px;
		}
		.ef-table .ef-abstract-time,
		.ef-table .ef-abstract-description{
			padding-top: 0px;
		}
		.ef-table .ef-abstract-time {
			padding-bottom: 0px;
			text-align: right;	
		}
		.ef_session_details_panel_session_property_description .ef-author-name {
			margin-bottom:7px;	
		}

		.ef-author-affiliation {
		    font-style: italic;
		}
		.ef-author-country {
			font-style: italic;				
		}

		.ef-info-table td {
		    vertical-align: top;
		}

		.ef-table .ef-table-sub-row td {
		    padding-top: 0px;
		    vertical-align: top;
		}

		.ef-table .ef-table-sub-header {
		    font-weight:bold;
		}

		.ef-session-details-sub-row {
		    margin-bottom: 4px;
		}

		.ef-primary-field {
		    font-weight: bold;
		}


		.ef-info-table pre {
			text-align: left;	
		}
		.ef-table .ef-session-name-with-abstracts,
		.ef-table .ef-session-name-with-abstracts .ef-session-price label
		 {
			font-weight: bold;	
			
		}
		.ef-table .ef-session-name-with-abstracts,
		.ef-table .ef-session-name,
		.ef-table .ef-session-location,
		.ef-table .ef-session-book, 
		.ef-table .ef-session-price,
		.ef-table .ef-session-abstract-price,
		.ef-table .ef-session-boookingLevel-capacity,
		.ef-table .ef-session-abstract-boookingLevel-capacity,
		.ef-table .ef-session-type {
			vertical-align: top;
		}
		.ef-table .ef-session-boookingLevel-capacity,
		.ef-table .ef-session-abstract-boookingLevel-capacity {
			text-align: center;	
		} 
		
		.ef-session-collision {
			background-color: red;	
		}
		.ef-session-price label {
			font-weight: normal;
		}
		.ef-session-booking-checkbox-disabled {
			background-image: url(../../media/images/english/default/frontend/cross_trans.gif);
			width: 13px;
			height: 13px;	
			border: 0px;
			margin-top: 5px;
			margin-bottom: 0px;
		}
		.ef-session-booking-checkbox-ticked {
			background-image: url(../../media/images/english/default/frontend/tick.gif);
			width: 13px;
			height: 13px;	
			border: 0px;
			margin-top: 5px;
			margin-bottom: 0px;
		}		
		.ef-session-list-abstract-row {
			font-weight: normal;	
		}
		.ef-table .ef-presenter {
			padding-top: 0px;	
		}
		.ef-inline-filter-row {
			float: left;
			margin-top: 12px;
			margin-bottom: 12px;
		}
		.ef-inline-filter-dropdown {
			float: left;
		}
		.ef-inline-filter-row .ef-inline-filter-dropdown:not(:first-child) {
			margin-left: 16px;
		}
		.ef-inline-filter-dropdown select {
			min-width: 150px;
			max-width: 300px;
		}
		#ef-absReviewList-review-button-column {
			width: 100px;
		}
		
		.ef-registration-section .select2-container--default .select2-selection--single {
			border-radius: 0;
		}
		.select2-container--default .select2-results__option--highlighted[aria-selected] {
			color: inherit;
		}
		
		.select2-container--default .select2-results__option.loading-results[aria-disabled="true"],
		.select2-container--default .select2-results__options .option.load-more {
			color: inherit;
			opacity: 0.5;
			font-style: italic;
		}
		.select2-container--default .select2-results__options .option.load-more {
			padding: 6px;
		}

		/* bug workaround: https://github.com/select2/select2/issues/3306 */		
		.select2-selection__clear {
		    position: absolute !important;
		    right: 20px !important;
		}
		
		.select2-container--default .select2-selection--single .select2-selection__rendered .ef-select2-templated-selection {
			overflow: hidden;
			text-overflow: ellipsis;
			padding-right: 16px;
			line-height: inherit;
		}
		
		.ef-highlight-warning {
			color: #cc0000;
			font-weight: bold;
		}
	>
]]></Implementation>
</Method>

<Method name="outputAgendaPopoverCSS">
<ClassMethod>1</ClassMethod>
<Implementation><![CDATA[
	&html<
		/* ======= outputAgendaPopoverCSS() ======= */
		/* sesstion details popover panel styles */
		.ef_qtip_session_details_popover {
			min-width: 350px;
			background: none;
			border: 0;
		}
		.ef_qtip_session_details_popover .ui-tooltip-content, .ef_qtip_session_details_popover .qtip-content {
			padding: 0;
			-moz-border-radius: 6px;
			-webkit-border-radius: 6px;
			border-radius: 6px;
			border: 0;
			-webkit-box-shadow: 0px 0px 10px 0px rgb(100,100,100);
			-moz-box-shadow: 0px 0px 10px 0px rgb(100,100,100);
			box-shadow: 0px 0px 10px 0px rgb(100,100,100);
			-ms-filter: "progid:DXImageTransform.Microsoft.Shadow(Strength=4, Direction=135, Color='#646464')";
			filter: progid:DXImageTransform.Microsoft.Shadow(Strength=4, Direction=135, Color='#646464');
		}
		.ef_qtip_session_details_popover .ui-tooltip-tip, .ef_qtip_session_details_popover .qtip-tip {
			border: 1px solid rgb(100,100,100);
			background: rgb(100,100,100);
		}
		/* this is the outermost container */
		.ef_session_details_panel_container {
			background: rgb(255,255,255);
			width: 350px;
			display: none;
			z-index: 999999999;
			overflow: hidden;
			-moz-border-radius: 6px;
			-webkit-border-radius: 6px;
			border-radius: 6px;
			margin: 0;
		}
		
		/* main sub containers */
		.ef_session_details_panel_session_properties_container {
			padding: 10px 10px 10px 10px;
			display: inline-block;
			margin: 0;
		}
		.ef_session_details_panel_session_info_container {
			padding: 12px 12px 12px 12px;
			display: block;
			margin: 0;
		}
	>
	
	w " .ef_session_details_panel_session_info {",!
	w "		_height: expression( this.scrollHeight > 300 ? ""300px"" : ""auto"" );",!
	w "		max-height: 300px;"
	w "		_width: expression( this.scrollWidth > 350 ? ""350px"" : ""auto"" );"
	w "		max-width: 350px;"
	w "		overflow-y: auto;"
	w "		display: block;"
	w "		margin: 0;"
	w "		background: #ffffff;"
	w "	}",!
	&html<
		.ef_session_details_panel_session_info p {
			color: rgb(160,160,160);
		}
		.ef_session_details_panel_action_button_container {
			height: 42px;
			width: 348px;
			text-align: center;
			display: inline-block;
			margin: 0;
		}
		/* each row of ef_session_details_panel_session_properties_container */
		.ef_session_details_panel_session_property_row {
			overflow: hidden;
			display: inline-block;
			margin: 0;
		}
		.ef_session_details_panel_session_property_row_top_spacing {
			margin-top: 10px;
		}
		/* general icon/description styling */
		.ef_session_details_panel_session_property_icon {
			height: 24px;
			width: 24px;
			float: left;
			display: inline;
			background-repeat: no-repeat;
			background-position: left center;
			display: inline-block;
			margin: 0;
			text-align: center;
			vertical-align: middle;
		}
		.ef_session_details_panel_session_property_description {
			float: left;
			display: inline;
			width: 298px;
			padding: 2px 4px 2px 4px;
			display: inline-block;
			margin: 0;
		}
		.ef_session_details_panel_session_property_description p {
			margin-top: 0;
			margin-bottom: 0;
		}
		/* session title / description */
		.ef_session_details_panel_title_icon {
			background-image: url("../../media/images/english/default/frontend/popover_info.png");
			display: inline-block;
			margin: 0;
		}
		.ef_session_details_panel_title_description {
			display: inline-block;
			margin: 0;
		}
		/* time/location */
		.ef_session_details_panel_time_location_icon {
			background-image: url("../../media/images/english/default/frontend/popover_clock.png");
			display: inline-block;
			margin: 0;
		}
		.ef_session_details_panel_time_location_description {
			display: inline-block;
			margin: 0;
		}
		/* presenter */
		.ef_session_details_panel_presenter_icon {
			background-image: url("../../media/images/english/default/frontend/popover_person.png");
			display: inline-block;
			margin: 0;
		}
		/*abstract presentation*/
		.ef_session_details_panel_abstract_icon {
			background-image: url("../../media/images/english/default/frontend/presentation-icon-16x16.png");
			display: inline-block;
			margin: 0;
		}
		
		
		.ef_session_details_panel_presenter_description,
		.ef_session_details_panel_presenter_description	 {
			display: inline-block;
			margin: 0;
		}
		.ef_session_details_panel_abstract_description {
			font-size: 10.5px;
		}
		
				
		
		/* the action button */
		.ef_session_details_panel_action_button {
			width: 326px;
			margin-left: auto;
			margin-right: auto;
			height: 30px;
			display: inline-block;
			text-align: center;
			font-size: 18px;
			font-family: 'Verdana';
			line-height: 30px;
			-webkit-border-radius: 4px; 
			-moz-border-radius: 4px;
			border-radius: 4px; 
			-moz-user-select: none;
		  	-khtml-user-select: none;
		  	-webkit-user-select: none;
		  	user-select: none;
		}
		
		.ef_session_details_panel_action_button_no_info_spacing {
			margin-top: 12px;
		}
		
	    .ef_frontend_ie7 .ef_qtip_session_details_popover .qtip-content,
	    .ef_frontend_ie8 .ef_qtip_session_details_popover .qtip-content {
			filter: none;
	    }
		
	    .ef_frontend_ie9 .ef_session_details_panel_action_button_add,
	    .ef_frontend_ie9 .ef_session_details_panel_action_button_remove {
			filter: none;
	    }
	    
		.ef_session_details_panel_action_button_add {
			border: 1px solid rgb(115,229,255);
			-webkit-border-radius: 4px; 
			-moz-border-radius: 4px;
			border-radius: 4px; 
			-webkit-box-shadow: 0 -1px 1px 0 rgb(48,116,168);
			-moz-box-shadow: 0 -1px 1px 0 rgb(48,116,168);
			box-shadow: 0 -1px 1px 0 rgb(48,116,168);
			color: #FFFFFF;
		 	cursor: pointer;
			background-color: rgb(73,193,242); /* Old browsers */
			background-image: url(data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiA/Pgo8c3ZnIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIgd2lkdGg9IjEwMCUiIGhlaWdodD0iMTAwJSIgdmlld0JveD0iMCAwIDEgMSIgcHJlc2VydmVBc3BlY3RSYXRpbz0ibm9uZSI+CiAgPGxpbmVhckdyYWRpZW50IGlkPSJncmFkLXVjZ2ctZ2VuZXJhdGVkIiBncmFkaWVudFVuaXRzPSJ1c2VyU3BhY2VPblVzZSIgeDE9IjAlIiB5MT0iMCUiIHgyPSIwJSIgeTI9IjEwMCUiPgogICAgPHN0b3Agb2Zmc2V0PSIwJSIgc3RvcC1jb2xvcj0iIzQ5YzFmMiIgc3RvcC1vcGFjaXR5PSIxIi8+CiAgICA8c3RvcCBvZmZzZXQ9IjEwMCUiIHN0b3AtY29sb3I9IiMzMDc0YTgiIHN0b3Atb3BhY2l0eT0iMSIvPgogIDwvbGluZWFyR3JhZGllbnQ+CiAgPHJlY3QgeD0iMCIgeT0iMCIgd2lkdGg9IjEiIGhlaWdodD0iMSIgZmlsbD0idXJsKCNncmFkLXVjZ2ctZ2VuZXJhdGVkKSIgLz4KPC9zdmc+);
			background-image: -moz-linear-gradient(top,  rgb(73,193,242) 0%, rgb(48,116,168) 100%); /* FF3.6+ */
			background-image: -webkit-gradient(linear, left top, left bottom, color-stop(0%,rgb(73,193,242)), color-stop(100%,rgb(48,116,168))); /* Chrome,Safari4+ */
			background-image: -webkit-linear-gradient(top,  rgb(73,193,242) 0%,rgb(48,116,168) 100%); /* Chrome10+,Safari5.1+ */
			background-image: -o-linear-gradient(top,  rgb(73,193,242) 0%,rgb(48,116,168) 100%); /* Opera 11.10+ */
			background-image: -ms-linear-gradient(top,  rgb(73,193,242) 0%,rgb(48,116,168) 100%); /* IE10+ */
			background-image: linear-gradient(to bottom,  rgb(73,193,242) 0%,rgb(48,116,168) 100%); /* W3C */
			filter: progid:DXImageTransform.Microsoft.gradient( startColorstr='#49c1f2', endColorstr='#3074a8',GradientType=0 ); /* IE6-8 */
		}
		.ef_session_details_panel_action_button_remove {
			border: 1px solid rgb(204,125,125); 
			-webkit-border-radius: 4px; 
			-moz-border-radius: 4px;
			border-radius: 4px; 
			-webkit-box-shadow: 0 -1px 0 0 rgb(179,49,36);
			-moz-box-shadow: 0 -1px 0 0 rgb(179,49,36);
			box-shadow: 0 -1px 0 0 rgb(179,49,36);
			color: #FFFFFF;
		 	cursor: pointer;
			background-color: rgb(193,107,93); /* Old browsers */
			background-image: url(data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiA/Pgo8c3ZnIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIgd2lkdGg9IjEwMCUiIGhlaWdodD0iMTAwJSIgdmlld0JveD0iMCAwIDEgMSIgcHJlc2VydmVBc3BlY3RSYXRpbz0ibm9uZSI+CiAgPGxpbmVhckdyYWRpZW50IGlkPSJncmFkLXVjZ2ctZ2VuZXJhdGVkIiBncmFkaWVudFVuaXRzPSJ1c2VyU3BhY2VPblVzZSIgeDE9IjAlIiB5MT0iMCUiIHgyPSIwJSIgeTI9IjEwMCUiPgogICAgPHN0b3Agb2Zmc2V0PSIwJSIgc3RvcC1jb2xvcj0iI2MxNmI1ZCIgc3RvcC1vcGFjaXR5PSIxIi8+CiAgICA8c3RvcCBvZmZzZXQ9IjEwMCUiIHN0b3AtY29sb3I9IiNiMzMxMjQiIHN0b3Atb3BhY2l0eT0iMSIvPgogIDwvbGluZWFyR3JhZGllbnQ+CiAgPHJlY3QgeD0iMCIgeT0iMCIgd2lkdGg9IjEiIGhlaWdodD0iMSIgZmlsbD0idXJsKCNncmFkLXVjZ2ctZ2VuZXJhdGVkKSIgLz4KPC9zdmc+);
			background-image: -moz-linear-gradient(top,  rgb(193,107,93) 0%, rgb(179,49,36) 100%); /* FF3.6+ */
			background-image: -webkit-gradient(linear, left top, left bottom, color-stop(0%,rgb(193,107,93)), color-stop(100%,rgb(179,49,36))); /* Chrome,Safari4+ */
			background-image: -webkit-linear-gradient(top,  rgb(193,107,93) 0%,rgb(179,49,36) 100%); /* Chrome10+,Safari5.1+ */
			background-image: -o-linear-gradient(top,  rgb(193,107,93) 0%,rgb(179,49,36) 100%); /* Opera 11.10+ */
			background-image: -ms-linear-gradient(top,  rgb(193,107,93) 0%,rgb(179,49,36) 100%); /* IE10+ */
			background-image: linear-gradient(to bottom,  rgb(193,107,93) 0%,rgb(179,49,36) 100%); /* W3C */
			filter: progid:DXImageTransform.Microsoft.gradient( startColorstr='#c16b5d', endColorstr='#b33124',GradientType=0 ); /* IE6-8 */
		}
		
		.ef_session_details_panel_action_button_disabled {
			background-image: none;
			cursor: default;
			background: rgb(245,245,245);
			border: 1px solid rgb(220,220,220);
			color: rgb(200,200,200);
		}
		
		.ef_session_details_panel_action_button_conflict_code {
			background-image: none;
			cursor: default;
			background: rgb(245,245,245);
			border: 1px solid rgb(220,220,220);
			color: rgb(200,200,200);
		}
		
		.ef_session_details_panel_action_button_conflict_time {
			background-image: none;
			cursor: default;
			background: rgb(245,245,245);
			border: 1px solid rgb(220,220,220);
			color: rgb(200,200,200);
		}
		.ef_session_details_panel_before_booking_button_icon {
			background-image: url("../../media/images/english/default/frontend/popover_info.png");
			display: inline-block;
			margin: 0;
			height: 24px;
			width: 24px;
			float: left;
			display: inline;
			background-repeat: no-repeat;
			background-position: left center;
			text-align: center;
			vertical-align: top;
			color: rgb(200,200,200);
		}
		
		.ef_session_details_panel_before_booking_button_container {
			padding: 12px;
		}
		
		.ef_session_details_panel_before_booking_button_text {
			padding: 2px 4px 2px 4px;
			color: rgb(130,130,130);
		}
		
		div.qtip-content { margin: 0; }
	>
]]></Implementation>
</Method>

<Method name="outputSegmentedButtonCSS">
<ClassMethod>1</ClassMethod>
<Implementation><![CDATA[
	&html<
		/* ======= outputSegmentedButtonCSS() ======= */
		.ef_segmented_button_container {
			border: 1px solid rgb(255,255,255);
			display: inline-block; /* For modern browsers */
			*display:inline; /* Hack for IE 7 and less */
			 zoom:1; /* Hack for IE */
			_height:1%; /* Hack for IE6 */
			vertical-align:top; /* Just makes sure everything is at the top */
			font-family: "Trebuchet MS", "Lucida Grande", "Lucida Sans Unicode", "Lucida Sans", Tahoma, sans-serif;
			font-size: 14px;
			height: 22px;
			overflow: hidden;
			
			-moz-border-radius: 6px;
			-webkit-border-radius: 6px;
			border-radius: 6px;
			
			-webkit-box-shadow: 0px 1px 2px rgba(0,0,0,0.3);
			-moz-box-shadow: 0px 1px 2px rgba(0,0,0,0.3);
			box-shadow: 0px 1px 2px rgba(0,0,0,0.3);
			
			-moz-user-select: none;
		  	-khtml-user-select: none;
		  	-webkit-user-select: none;
		  	user-select: none;
		  	box-sizing: content-box;
		}
		.ef_segmented_button_container div {
			float: left;
		}
		.ef_segmented_button {
			cursor: pointer;
			height: 22px;
			line-height: 22px;
		}
		.ef_segmented_button_text {
			padding: 0 16px;
		}
		.ef_segmented_button_previous {
			background-image: url("../../media/images/english/default/frontend/left-arrow.png");
		    background-repeat: no-repeat;
		    height: 19px;
		    margin: 2px 4px 1px 8px;
		    width: 12px;
		}
		.ef_segmented_button_next {
			background-image: url("../../media/images/english/default/frontend/right-arrow.png");
		    background-repeat: no-repeat;
		    height: 19px;
		    margin: 2px 8px 1px 4px;
		    width: 12px;
		}
		.ef_segmented_button_disabled_outer_off {
			cursor: default;
		}
		.ef_segmented_button_disabled_off {
			cursor: default;
			background-image: none;
		}
		.ef_segmented_button_icon {
			padding: 0 8px;
		}
		.ef_segmented_button_icon_inner {
			vertical-align: middle;
			background-position: center;
			background-repeat: no-repeat;
			border: 0;
		}
		.ef_segmented_button_off, .ef_segmented_button_main_buttons_container {
			color: rgb(130,130,130);
			text-shadow: 0 1px #FFFFFF;
			background: #ffffff; /* Old browsers */
			/* IE9 SVG, needs conditional override of 'filter' to 'none' */
			background: url(data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiA/Pgo8c3ZnIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIgd2lkdGg9IjEwMCUiIGhlaWdodD0iMTAwJSIgdmlld0JveD0iMCAwIDEgMSIgcHJlc2VydmVBc3BlY3RSYXRpbz0ibm9uZSI+CiAgPGxpbmVhckdyYWRpZW50IGlkPSJncmFkLXVjZ2ctZ2VuZXJhdGVkIiBncmFkaWVudFVuaXRzPSJ1c2VyU3BhY2VPblVzZSIgeDE9IjAlIiB5MT0iMCUiIHgyPSIwJSIgeTI9IjEwMCUiPgogICAgPHN0b3Agb2Zmc2V0PSIwJSIgc3RvcC1jb2xvcj0iI2ZmZmZmZiIgc3RvcC1vcGFjaXR5PSIxIi8+CiAgICA8c3RvcCBvZmZzZXQ9IjcwJSIgc3RvcC1jb2xvcj0iI2UzZTNlNCIgc3RvcC1vcGFjaXR5PSIxIi8+CiAgICA8c3RvcCBvZmZzZXQ9IjEwMCUiIHN0b3AtY29sb3I9IiNlM2UzZTQiIHN0b3Atb3BhY2l0eT0iMSIvPgogIDwvbGluZWFyR3JhZGllbnQ+CiAgPHJlY3QgeD0iMCIgeT0iMCIgd2lkdGg9IjEiIGhlaWdodD0iMSIgZmlsbD0idXJsKCNncmFkLXVjZ2ctZ2VuZXJhdGVkKSIgLz4KPC9zdmc+);
			background: -moz-linear-gradient(top,  #ffffff 0%, #e3e3e4 70%, #e3e3e4 100%); /* FF3.6+ */
			background: -webkit-gradient(linear, left top, left bottom, color-stop(0%,#ffffff), color-stop(70%,#e3e3e4), color-stop(100%,#e3e3e4)); /* Chrome,Safari4+ */
			background: -webkit-linear-gradient(top,  #ffffff 0%,#e3e3e4 70%,#e3e3e4 100%); /* Chrome10+,Safari5.1+ */
			background: -o-linear-gradient(top,  #ffffff 0%,#e3e3e4 70%,#e3e3e4 100%); /* Opera 11.10+ */
			background: -ms-linear-gradient(top,  #ffffff 0%,#e3e3e4 70%,#e3e3e4 100%); /* IE10+ */
			background: linear-gradient(to bottom,  #ffffff 0%,#e3e3e4 70%,#e3e3e4 100%); /* W3C */
			filter: progid:DXImageTransform.Microsoft.gradient( startColorstr='#ffffff', endColorstr='#e3e3e4',GradientType=0 ); /* IE6-8 */
		}
		.ef_segmented_button_on {
			color: rgb(255,255,255);
			background: #3074a8; /* Old browsers */
			background: url(data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiA/Pgo8c3ZnIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIgd2lkdGg9IjEwMCUiIGhlaWdodD0iMTAwJSIgdmlld0JveD0iMCAwIDEgMSIgcHJlc2VydmVBc3BlY3RSYXRpbz0ibm9uZSI+CiAgPGxpbmVhckdyYWRpZW50IGlkPSJncmFkLXVjZ2ctZ2VuZXJhdGVkIiBncmFkaWVudFVuaXRzPSJ1c2VyU3BhY2VPblVzZSIgeDE9IjAlIiB5MT0iMCUiIHgyPSIwJSIgeTI9IjEwMCUiPgogICAgPHN0b3Agb2Zmc2V0PSIwJSIgc3RvcC1jb2xvcj0iIzMwNzRhOCIgc3RvcC1vcGFjaXR5PSIxIi8+CiAgICA8c3RvcCBvZmZzZXQ9IjMwJSIgc3RvcC1jb2xvcj0iIzI5ODlkOCIgc3RvcC1vcGFjaXR5PSIxIi8+CiAgICA8c3RvcCBvZmZzZXQ9IjEwMCUiIHN0b3AtY29sb3I9IiM0OWMxZjIiIHN0b3Atb3BhY2l0eT0iMSIvPgogIDwvbGluZWFyR3JhZGllbnQ+CiAgPHJlY3QgeD0iMCIgeT0iMCIgd2lkdGg9IjEiIGhlaWdodD0iMSIgZmlsbD0idXJsKCNncmFkLXVjZ2ctZ2VuZXJhdGVkKSIgLz4KPC9zdmc+);
			background: -moz-linear-gradient(top,  #3074a8 0%, #2989d8 30%, #49c1f2 100%); /* FF3.6+ */
			background: -webkit-gradient(linear, left top, left bottom, color-stop(0%,#3074a8), color-stop(30%,#2989d8), color-stop(100%,#49c1f2)); /* Chrome,Safari4+ */
			background: -webkit-linear-gradient(top,  #3074a8 0%,#2989d8 30%,#49c1f2 100%); /* Chrome10+,Safari5.1+ */
			background: -o-linear-gradient(top,  #3074a8 0%,#2989d8 30%,#49c1f2 100%); /* Opera 11.10+ */
			background: -ms-linear-gradient(top,  #3074a8 0%,#2989d8 30%,#49c1f2 100%); /* IE10+ */
			background: linear-gradient(to bottom,  #3074a8 0%,#2989d8 30%,#49c1f2 100%); /* W3C */
			filter: progid:DXImageTransform.Microsoft.gradient( startColorstr='#3074a8', endColorstr='#49c1f2',GradientType=0 ); /* IE6-8 */
		}
		.ef_segmented_button_caption {
			line-height: 22px;
			padding: 0 4px 0 8px;
			
			color: rgb(130,130,130);
			text-shadow: 0 1px #FFFFFF;
			background: #ffffff; /* Old browsers */
			/* IE9 SVG, needs conditional override of 'filter' to 'none' */
			background: url(data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiA/Pgo8c3ZnIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIgd2lkdGg9IjEwMCUiIGhlaWdodD0iMTAwJSIgdmlld0JveD0iMCAwIDEgMSIgcHJlc2VydmVBc3BlY3RSYXRpbz0ibm9uZSI+CiAgPGxpbmVhckdyYWRpZW50IGlkPSJncmFkLXVjZ2ctZ2VuZXJhdGVkIiBncmFkaWVudFVuaXRzPSJ1c2VyU3BhY2VPblVzZSIgeDE9IjAlIiB5MT0iMCUiIHgyPSIwJSIgeTI9IjEwMCUiPgogICAgPHN0b3Agb2Zmc2V0PSIwJSIgc3RvcC1jb2xvcj0iI2ZmZmZmZiIgc3RvcC1vcGFjaXR5PSIxIi8+CiAgICA8c3RvcCBvZmZzZXQ9IjcwJSIgc3RvcC1jb2xvcj0iI2UzZTNlNCIgc3RvcC1vcGFjaXR5PSIxIi8+CiAgICA8c3RvcCBvZmZzZXQ9IjEwMCUiIHN0b3AtY29sb3I9IiNlM2UzZTQiIHN0b3Atb3BhY2l0eT0iMSIvPgogIDwvbGluZWFyR3JhZGllbnQ+CiAgPHJlY3QgeD0iMCIgeT0iMCIgd2lkdGg9IjEiIGhlaWdodD0iMSIgZmlsbD0idXJsKCNncmFkLXVjZ2ctZ2VuZXJhdGVkKSIgLz4KPC9zdmc+);
			background: -moz-linear-gradient(top,  #ffffff 0%, #e3e3e4 70%, #e3e3e4 100%); /* FF3.6+ */
			background: -webkit-gradient(linear, left top, left bottom, color-stop(0%,#ffffff), color-stop(70%,#e3e3e4), color-stop(100%,#e3e3e4)); /* Chrome,Safari4+ */
			background: -webkit-linear-gradient(top,  #ffffff 0%,#e3e3e4 70%,#e3e3e4 100%); /* Chrome10+,Safari5.1+ */
			background: -o-linear-gradient(top,  #ffffff 0%,#e3e3e4 70%,#e3e3e4 100%); /* Opera 11.10+ */
			background: -ms-linear-gradient(top,  #ffffff 0%,#e3e3e4 70%,#e3e3e4 100%); /* IE10+ */
			background: linear-gradient(to bottom,  #ffffff 0%,#e3e3e4 70%,#e3e3e4 100%); /* W3C */
			filter: progid:DXImageTransform.Microsoft.gradient( startColorstr='#ffffff', endColorstr='#e3e3e4',GradientType=0 ); /* IE6-8 */
		}
		
		.ef_segmented_button_main_buttons_container {
			overflow: hidden;
		}
		
		.ef-ie7 .ef_segmented_button_main_buttons_container {
			position: relative;
		}
	>
]]></Implementation>
</Method>

<Method name="outputAgendaGridListSwitchCSS">
<ClassMethod>1</ClassMethod>
<Implementation><![CDATA[
	&html<
		/* ======= outputAgendaGridListSwitchCSS() ======= */
		.ef_agenda_view_switch_grid_icon_on {
			background-image: url('../../media/images/english/default/frontend/viewswitch_grid_on_icon.png');
			background-repeat: no-repeat;
			width: 15px;
			height: 15px;
			margin: 4px 0 3px;
		}
		.ef_agenda_view_switch_grid_icon_off {
			background-image: url('../../media/images/english/default/frontend/viewswitch_grid_off_icon.png');
			background-repeat: no-repeat;
			width: 15px;
			height: 15px;
			margin: 4px 0 3px;
		}
		.ef_agenda_view_switch_list_icon_on {
			background-image: url('../../media/images/english/default/frontend/viewswitch_list_on_icon.png');
			background-repeat: no-repeat;
			width: 15px;
			height: 15px;
			margin: 4px 0 3px;
		}
		.ef_agenda_view_switch_list_icon_off {
			background-image: url('../../media/images/english/default/frontend/viewswitch_list_off_icon.png');
			background-repeat: no-repeat;
			width: 15px;
			height: 15px;
			margin: 4px 0 3px;
		}
	>
]]></Implementation>
</Method>

<Method name="outputAgendaGeneralCSS">
<ClassMethod>1</ClassMethod>
<Implementation><![CDATA[
	&html<
		/* ======= outputAgendaGeneralCSS() ======= */
		/* agenda calendar main grid styles */
		
		.ef-reset-box-sizing, .ef-reset-box-sizing *, .ef-reset-box-sizing *:before, .ef-reset-box-sizing *:after {
			-webkit-box-sizing: content-box;
			-moz-box-sizing: content-box;
			box-sizing: content-box;
		}
		
		.ef_agenda_calendar_container {
			table-layout: fixed;
			/* position: relative; pjc - needed for css3pie */
			border-collapse: separate;
			border-spacing: 6px 7px;
		}
		
		.ef_agenda_calendar_header {
			background: rgb(100,100,100);
			color: rgb(255,255,255);
			font-size: 13px;
			padding: 4px 8px 4px 8px;
			height: 20px;
		}
		
		.ef_agenda_calendar_header_time {
			padding-left: 0;
			width: 50px;
			visibility: hidden;
		}
		
		.ef_agenda_calendar_header_loc {
			width: 130px;
		}
		
		.ef_frontend_agenda_grid_time_container {
			float: right;
			padding: 0 2px 0 0;
			margin: 0;
		}
		
		.ef_gridline_horizontal_container {
			position: relative;
			vertical-align: top;
			width: 4px;
		}
		
		.ef_frontend_agenda_grid_gridline_horizontal {
			position: relative;
			z-index: 10;
			display: inline-block;
			height: 0px;
			border-top: 1px solid rgb(220,220,220);
		}
		
		.ef_frontend_agenda_grid_gridline_vertical {
			position: absolute;
			float: left;
			z-index: 10;
			display: inline-block;
			width: 0px;
			border-left: 1px solid rgb(220,220,220);
		}
		
		.ef_agenda_calendar_item {
			-moz-border-radius: 5px;
			-webkit-border-radius: 5px;
			border-radius: 5px;
			width: 100%;
			padding: 0;
			overflow: hidden;
			position: relative;
			z-index: 30;
			vertical-align: top;
		}
		
		/* css attributes added to this will not take effect without change of relevant code */
		.ef_agenda_calendar_item_conflict_time {
			background: rgb(245,245,245);
			border: 1px solid rgb(220,220,220);
			color: rgb(200,200,200);
			opacity: 0.2;
		}
		/* css attributes added to this will not take effect without change of relevant code */
		.ef_agenda_calendar_item_conflict_code {
			background: rgb(245,245,245);
			border: 1px solid rgb(220,220,220);
			color: rgb(200,200,200);
			opacity: 0.2;
		}
		
		.ef_agenda_calendar_item div {
			vertical-align: top;
		}
		
		.ef_agenda_calendar_item div {
			margin: 0;
		}
		
		.ef_agenda_calendar_item_title {
			display: inline-block;
			min-height: 23px;
			padding: 0;
			float: left;
			width: 100%;
		}
		.ef_agenda_calendar_item_time_from {
			display: inline-block;
			float: left;
			padding: 6px;
			vertical-align: top;
			font-size: 12px;
			line-height: 12px;
		}
		.ef_agenda_calendar_item_time_from_single_row {
			display: inline-block;
			float: left;
			padding: 4px 6px 4px 6px;
			
			vertical-align: top;
			font-size: 12px;
		}
		
		.ef_agenda_calendar_item_session_icon {
			display: inline-block;
			background-position: right top;
			background-repeat: no-repeat;
			width: 17px;
			height: 17px;
			float: right;
		}
		
		div.ef_agenda_calendar_item_session_icon {
			margin-top: 4px;
			margin-right: 4px;
		}
		.ef_agenda_calendar_item_session_icon_faded {
			-khtml-opacity:0.2; 
			-moz-opacity:0.2; 
			opacity:0.2; 
		}
		.ef_agenda_calendar_item_selected_icon {
			display: inline-block;
			background-image: url('../../media/images/english/default/frontend/icon_attending_tick.png');
			background-repeat: no-repeat;		
			background-position: right top;
			width: 17px;
			height: 17px;
			float: right;
		}
		div.ef_agenda_calendar_item_selected_icon {
			margin-top: 4px;
			margin-right: 4px;
		}
		.ef_agenda_calendar_item_info {
			display: inline-block;
			float: left;
			width: 100%;
		}
		.ef_agenda_calendar_item_info_inner {
			display: inline-block;
			float: left;
			width: 100%;
		}
		div.ef_agenda_calendar_item_info_single_row {
			float: left;
			padding-top: 4px;
			padding-bottom: 4px;
		}
		
		div.ef_agenda_calendar_item_info_inner_single_row {
			float: left;
			width: 100%;
			font-size: 12px;
		}
		
		.ef_frontend_ie7 div.ef_agenda_calendar_item_info_inner_single_row {
			padding-bottom: 4px;
		}
		
		.ef_agenda_calendar_item_info_inner span {
			display: block;
			padding: 6px;
		}
		.ef_frontend_agenda_time_ampm {
			font-size: smaller;	
		}
		/* agenda calendar filter styles */	
		.ef_agenda_calendar_filters_container {
			text-align: left;
			padding: 0px 0px 0px 0px;
			margin: 0;
			background: #ffffff;
		}
		.ef_agenda_calendar_filters_container p {
			margin-top: 0;
			margin-bottom: 0;
			color: #000000;
		}
		.ef_agenda_calendar_filters_session_types_container {
			margin: 0;
			padding-bottom: 12px;
		}
		
		.ef_agenda_calendar_filters_instructions_text_session_type {
			padding: 16px 10px 16px 10px;
			margin: 0;
		}
		
		.ef_agenda_calendar_filters_filter {
			border: solid 1px rgb(200,200,200);
			margin: 0px 4px 4px 4px;
			cursor: pointer;
			padding: 4px 4px 4px 4px;
			text-align: center;
			-moz-border-radius: 6px;
		    -webkit-border-radius: 6px;
		    -khtml-border-radius: 6px;
		    border-radius: 6px;
		    display: block;
		    position: relative;
		    -moz-user-select: none;
		  	-khtml-user-select: none;
		  	-webkit-user-select: none;
		  	user-select: none;
		}
		
		.ef_agenda_calendar_filters_filter a {
			text-decoration: none;
			display: block;
		}
		.ef_agenda_calendar_filters_my_agenda_container {
			margin: 0;
			padding-top: 16px;
		}
		.ef_agenda_calendar_filters_instructions_text_my_agenda {
			padding: 0px 10px 4px 10px;
			margin: 0;
		}
		
		/* the colors will be overridden by session type color settings 
		for session filters, but will apply for other filters */
		.ef_agenda_calendar_filters_filter_on {
			color: rgb(255,255,255);
			border:1px solid rgb(44,151,204); 
			background-color: rgb(69,176,229);
		}
		.ef_agenda_calendar_filters_filter_on p {
			color: rgb(255,255,255);
		}
		.ef_agenda_calendar_filters_filter_off {
			color: rgb(160,160,160);
			background: rgb(255,255,255);
		}
		
		.ef_agenda_calendar_filters_filter_off p {
			color: rgb(160,160,160);
			background: rgb(255,255,255);
		}
		
		.ef_agenda_filter_my_itinerary {
			background-image: url('../../media/images/english/default/frontend/icon_attending_tick.png');
			background-repeat: no-repeat;		
			background-position: 6px center;
			text-align: left;
			padding-left: 32px;
		}
		
		.ef_agenda_filter_my_itinerary_on {
			background-image: url('../../media/images/english/default/frontend/icon_attending_tick_white.png');
		}
		
		#DayAndViewSelectorAndInstructionTextAndButtons #[w ">"]# #instructionText {
			margin-top: 18px;
			margin-bottom:12px;
		}
		
		#daySwitcher {
			height: 24px;
			float: left;
			text-align: left;
		}
		
		#daySwitcher, #viewSwitcher, #buttonDiv {
			margin-top: 8px;
			margin-bottom: 8px;
			display: block;
			clear: left;
		}
		.ef_agenda_view_switch_container {
			float:left;
			margin-bottom: 12px;
		}
		.ef_agenda_day_selector_day {
			position: relative;
			float: left;
		}
		.ef_frontend_ie6 #DayAndViewSelectorAndInstructionTextAndButtons,
		.ef_frontend_ie7 #DayAndViewSelectorAndInstructionTextAndButtons {
			margin-top: 0;
		}
	>
]]></Implementation>
</Method>

<Method name="outputLegacyDefaultCSS">
<ClassMethod>1</ClassMethod>
<Implementation><![CDATA[
	&html<
		/* ======= outputLegacyDefaultCSS() ======= */
		h1 { font-family: Verdana, Arial, Helvetica, sans-serif; font-size: 24px; font-weight: bold; color: #000000; 	}
		h2 { font-family: Verdana, Arial, Helvetica, sans-serif; font-size: 20px; font-weight: bold; color: #000000; 	}
		h3 { font-family: Verdana, Arial, Helvetica, sans-serif; font-size: 16px; font-weight: bold; color: #000000; 	}
		h4 { font-family: Verdana, Arial, Helvetica, sans-serif; font-size: 14px; font-weight: bold; color: #000000; 	}
		h5 { font-family: Verdana, Arial, Helvetica, sans-serif; font-size: 12px; font-weight: bold; color: #000000; 	}
		h6 { font-family: Verdana, Arial, Helvetica, sans-serif; font-size: 10px; font-weight: bold; color: #000000; 	}
		body
		{
			font-size:12px;
			font-family: Verdana, Geneva, Arial, Helvetica, sans-serif;
		}
		
		.default_text { font-family: Verdana, Arial, Helvetica, sans-serif; font-size: 12px; color: #000000; 	}
		.alt_text_1 { font-family: Verdana, Arial, Helvetica, sans-serif; font-size: 12px; font-weight: bold; color: #000000; 	}
		.alt_text_2 { font-family: Verdana, Arial, Helvetica, sans-serif; font-size: 12px; font-style: italic; color: #000000; 	}
		.alt_text_3 { font-family: Verdana, Arial, Helvetica, sans-serif; font-size: 12px; color: #000000; 	}
		.alt_text_4 { font-family: Verdana, Arial, Helvetica, sans-serif; font-size: 12px; color: #000000; 	}
		.alt_text_5 { font-family: Verdana, Arial, Helvetica, sans-serif; font-size: 12px; color: #000000; 	}
		
		td {font-family: Verdana, Arial, Helvetica, sans-serif; font-size: 12px; color: #000000; 	}
		p, li, div
		{
			margin:0in;
			margin-bottom: 10pt;
			font-size:12px;
			font-family: Verdana, Geneva, Arial, Helvetica, sans-serif;
		}
		li.k-item {
			margin-bottom: 0;
		}
		
		a:link, a:visited, a:hover, a:active {
		}
		
		ul.menuUL	{
			margin:0;
			margin-bottom: 0;
			font-family: Verdana, Geneva, Arial, Helvetica, sans-serif;
		}
		li.menuLI	{
			margin:0;
			margin-bottom: 0;
			font-family: Verdana, Geneva, Arial, Helvetica, sans-serif;
			list-style : none;
			xxborder-bottom: 1px solid red;
		}
		li.menuLI a	{
			margin:0;
			margin-bottom: 0;
			font-family: Verdana, Geneva, Arial, Helvetica, sans-serif;
			list-style : none;
			xxborder-bottom: 1px solid red;
		}
		
		.black8px {  font-family: Verdana, Arial, Helvetica, sans-serif; font-size: 8px; font-style: normal; line-height: normal; font-weight: normal; color: #000000; text-decoration: none}
		.black9px {  font-family: Verdana, Arial, Helvetica, sans-serif; font-size: 9px; font-style: normal; line-height: normal; font-weight: normal; color: #000000; text-decoration: none}
		.black10px {  font-family: Verdana, Arial, Helvetica, sans-serif; font-size: 10px; font-style: normal; line-height: normal; font-weight: normal; color: #000000; text-decoration: none}
		.EF_inputBox {  font-family: Verdana, Arial, Helvetica, sans-serif; font-size: 10px; font-style: normal; line-height: normal; font-weight: normal; color: #000000; text-decoration: none}
		.blackbold10px {  font-family: Verdana, Arial, Helvetica, sans-serif; font-size: 10px; font-style: normal; line-height: normal; font-weight: bold; color: #000000}
		.white9px { font-family: Verdana, Arial, Helvetica, sans-serif; font-size: 9px; font-style: normal; line-height: normal; font-weight: normal; color: #ffffff}
		.white10px { font-family: Verdana, Arial, Helvetica, sans-serif; font-size: 10px; font-style: normal; line-height: normal; font-weight: normal; color: #ffffff}
		.white12px { font-family: Verdana, Arial, Helvetica, sans-serif; font-size: 12px; font-style: normal; line-height: normal; font-weight: normal; color: #ffffff; text-decoration: none}
		.white14px { font-family: Verdana, Arial, Helvetica, sans-serif; font-size: 14px; font-style: normal; line-height: normal; font-weight: normal; color: #ffffff; text-decoration: none}
		.whitebold9px { font-family: Verdana, Arial, Helvetica, sans-serif; font-size: 9px; font-style: normal; line-height: normal; font-weight: bold; color: #ffffff; text-decoration: none}
		.whitebold10px { font-family: Verdana, Arial, Helvetica, sans-serif; font-size: 10px; font-style: normal; line-height: normal; font-weight: bold; color: #ffffff; text-decoration: none}
		.whitebold12px { font-family: Verdana, Arial, Helvetica, sans-serif; font-size: 12px; font-style: normal; line-height: normal; font-weight: bold; color: #ffffff; text-decoration: none}
		.whitebold14px { font-family: Verdana, Arial, Helvetica, sans-serif; font-size: 14px; font-style: normal; line-height: normal; font-weight: bold; color: #ffffff; text-decoration: none}
		.whiteOnGrey10px { margin: 0; padding: 0; vertical-align: middle; line-height: 18px; text-indent: 7px; font-family: Verdana, Arial, Helvetica, sans-serif; font-size: 10px; font-weight: bold; font-style: normal; color: white; background: #959595; }
		.black10pxUL { font-family: Verdana, Arial, Helvetica, sans-serif; font-size: 10px; font-style: normal; line-height: normal; font-weight: normal; color: #000000; text-decoration: underline}
		.blackbold10pxUL { font-family: Verdana, Arial, Helvetica, sans-serif; font-size: 10px; font-style: normal; line-height: normal; font-weight: bold; color: #000000 ; text-decoration: underline}
		.redbold12px { font-family: Verdana, Arial, Helvetica, sans-serif; font-size: 12px; font-style: normal; line-height: normal; font-weight: bold; color: #cc0000; text-decoration: none }
		.redbold10px { font-family: Verdana, Arial, Helvetica, sans-serif; font-size: 10px; font-style: normal; line-height: normal; font-weight: bold; color: #cc0000; text-decoration: none }
		.greybold10px { font-family: Verdana, Arial, Helvetica, sans-serif; font-size: 10px; font-style: normal; line-height: normal; font-weight: bold; color: #666666}
		.blackbold12px { font-family: Verdana, Arial, Helvetica, sans-serif; font-size: 12px; font-style: normal; line-height: normal; font-weight: bold; color: #000000 }
		.bluebold12px { font-family: Verdana, Arial, Helvetica, sans-serif; font-size: 12px; font-style: normal; line-height: normal; font-weight: bold; color: #1F4757}
		.black12px { font-family: Verdana, Arial, Helvetica, sans-serif; font-size: 12px; font-style: normal; line-height: normal; font-weight: normal; color: #000000; text-decoration: none }
		.blue12px { font-family: Verdana, Arial, Helvetica, sans-serif; font-size: 12px; font-style: normal; line-height: normal; font-weight: normal; color: #6699CC }
		.blue10px { font-family: Verdana, Arial, Helvetica, sans-serif; font-size: 10px; font-style: normal; line-height: normal; font-weight: normal; color: #6699CC }
		.blue9px { font-family: Verdana, Arial, Helvetica, sans-serif; font-size: 9px; font-style: normal; line-height: normal; font-weight: normal; color: #6699CC }
		.bluebold9px { font-family: Verdana, Arial, Helvetica, sans-serif; font-size: 9px; font-style: normal; line-height: normal; font-weight: bold; color: #6699CC }
		.yellowbold10px {
			font-family: Verdana, Arial, Helvetica, sans-serif;
			font-size: 10px;
			font-style: normal;
			line-height: normal;
			font-weight: bold;
			color: #FFFF80;
			text-decoration: none;
		}
		.yellow {  background-color: #FFFFCC;}
		.grey {  background-color: #e6e6e6}
		.red, .k-calendar td.ef-date-picker-event-day { 	background-color : #CC0033;}
		.k-calendar td.ef-date-picker-event-day .k-link {
			color: #FFFFFF
		}
		.notSoRed { 	background-color : #FFD1A0;}
		.bluebold10px { font-family: Verdana, Arial, Helvetica, sans-serif; font-size: 10px; font-style: normal; line-height: normal; font-weight: bold; color: #1F4757 }
		.bluebold14px { font-family: Verdana, Arial, Helvetica, sans-serif; font-size: 14px; font-style: normal; line-height: normal; font-weight: bold; color: #1F4757 }
		.activeButton {background-color: #FFDEAD}
		.orangeSelect {
			background-color: #FFDEAD;
			cursor : hand;
		}
		.red9px { font-family: Verdana, Arial, Helvetica, sans-serif; font-size: 9px; font-style: normal; line-height: normal; font-weight: normal; color: #cc0000; text-decoration: none }
		.black9px_UL { font-family: Verdana, Arial, Helvetica, sans-serif; font-size: 9px; font-style: normal; line-height: normal; font-weight: normal; color: #000000; text-decoration: none }
		.grey2 { background-color: #CC0000}
		.butBlueWhite8px {
			font-family : Arial, Helvetica, Verdana;
			font-size: 8pt;
			color: White;
			font-weight: normal;
			background:#6699CC;
			text-align : center;
			font-weight: Bold;
			text-decoration : none;
			padding : 0px;
			cursor:hand;
		}
		.butGreyBlue8px {
			color: #185496;
			background: #B3C4CE;
			text-align : center;
			text-decoration : none;
			padding : 0px;
			cursor:hand;
			font : bold 8pt Arial, Helvetica, sans-serif;
			width: 95px;
			max-width: 95px;
			height: 20px;
			margin: 0px;
		}
		.hiddenDiv	{
			position:absolute;
			visibility:hidden;
			background-color: #FFFFE1;
			border: 1px double;
			width:0px;
			height:0px;
			left:200px;
		}
		td.black10pxBorder {
			border-style: solid none solid none;
			border-width:1px;
			border-color: #FFFFFF #FFFFFF #000000 #000000;
			border-collapse: collapse;
		}
		.mainPageBorderTop	{
			background-color: black;
		}
		.mainPageBorderLeft	{
			background-color: black;
		}
		.mainPageBorderRight	{
			background-color: black;
		}
		.mainPageBorderBottom	{
			background-color: black;
		}
		.mainPageLine	{
		/* need both color (for IE) and background-color (for Mozilla + Opera) */;
			width: 100%;
			color: black;
			background-color: black;
			height: 1px;
		}
	>
]]></Implementation>
</Method>
</Class>


<Project name="proweb 2" LastModified="2016-09-23 15:29:48.620528" Target="freddev/backend/home/login.csp" TargetType="3">
  <Items>
    <ProjectItem name="EF.contextDataRegistration" type="CLS"></ProjectItem>
    <ProjectItem name="EF.contextDataRegistrationMock" type="CLS"></ProjectItem>
    <ProjectItem name="EF.pageController.page" type="CLS"></ProjectItem>
    <ProjectItem name="EF.pageController.proweb.list" type="CLS"></ProjectItem>
    <ProjectItem name="EF.pageController.proweb.listItem" type="CLS"></ProjectItem>
    <ProjectItem name="EF.pageController.proweb.listItems.alternative" type="CLS"></ProjectItem>
    <ProjectItem name="EF.pageController.proweb.listItems.divider" type="CLS"></ProjectItem>
    <ProjectItem name="EF.pageController.proweb.listItems.inputElement" type="CLS"></ProjectItem>
    <ProjectItem name="EF.pageController.proweb.listItems.inputElementCOD" type="CLS"></ProjectItem>
    <ProjectItem name="EF.pageController.proweb.listItems.textBlock" type="CLS"></ProjectItem>
    <ProjectItem name="EF.pageController.proweb.listTestCase" type="CLS"></ProjectItem>
    <ProjectItem name="EF.pages.frontend.base" type="CLS"></ProjectItem>
    <ProjectItem name="EF.ui.components.base" type="CLS"></ProjectItem>
    <ProjectItem name="EF.ui.components.frontend.alternative" type="CLS"></ProjectItem>
    <ProjectItem name="EF.ui.components.frontend.divider" type="CLS"></ProjectItem>
    <ProjectItem name="EF.ui.components.frontend.dropdown" type="CLS"></ProjectItem>
    <ProjectItem name="EF.ui.components.frontend.inputElement" type="CLS"></ProjectItem>
    <ProjectItem name="EF.ui.components.frontend.prowebBase" type="CLS"></ProjectItem>
    <ProjectItem name="EF.ui.components.frontend.textBlock" type="CLS"></ProjectItem>
    <ProjectItem name="EF.ui.components.frontend.textInput" type="CLS"></ProjectItem>
    <ProjectItem name="freddev/frontEnd/reg/t4Registration.csp" type="CSP"></ProjectItem>
    <ProjectItem name="freddev/system/eventsForceRules.csr" type="CSP"></ProjectItem>
    <ProjectItem name="layout.cssDefaultMethods" type="CLS"></ProjectItem>
    <ProjectItem name="shared.pageMethods" type="CLS"></ProjectItem>
  </Items>
  <BreakPoints>
    <BreakPoint Routine="EF.pages.frontend.base.1.INT" Offset="130"></BreakPoint>
    <BreakPoint Routine="cspRealEV.frontend.reg.t4registration.1.INT" Offset="14"></BreakPoint>
  </BreakPoints>
</Project>


<Class name="shared.pageMethods">
<Description><![CDATA[
<!-- ;vc;-
;vc;    Object: shared.pageMethods.CLS/EV.174
;vc; Component: CLS.shared.pageMethods
;vc;  Location: SmallDev
;vc; Date/Time: 02-Sep-16 14:28
;vc;      User: JeremyW
;vc; --><p>VC/m status:<table id='vcm' border='1'><tr><th>Object</th><th>Component</th><th>Location</th><th>Date/Time</th><th>User</th></tr><tr><td>shared.pageMethods.CLS/EV.174</td><td>CLS.shared.pageMethods</td><td>SmallDev</td><td style='white-space: nowrap;'>02-Sep-16 14:28</td><td>JeremyW</td></tr></table>
]]></Description>
<Abstract>1</Abstract>
<ClassType/>
<ProcedureBlock>1</ProcedureBlock>
<TimeChanged>64184,55931.245514</TimeChanged>
<TimeCreated>60747,44410.590792</TimeCreated>

<Method name="prePartOne">
<ClassMethod>1</ClassMethod>
<FormalSpec>frontback:%String</FormalSpec>
<ReturnType>%String</ReturnType>
<Implementation><![CDATA[
	set ip=%request.GetCgiEnv("REMOTE_ADDR","no ip")
	set URL=$ZCVT(%request.URL,"L")				// this is the url and path: /evdev/frontend/reg/homepage.csp
	set pagename=$ZCVT(%request.PageName,"L")	// this is just the url: homepage.csp
	set cspAppName=##class(EF.config.clientData).getCSPAppForCurrentNameSpace()
	set appFromURL=$p(URL,"/",2)
	set pageID=%request.Get("pageID")

	if ..isApplicationStopped() {
		set %response.ServerSideRedirect=##class(shared.pageMethods).getURLforMaintenancePage(cspAppName)
		quit "0|0"
	}
	
	if ..isIncludePage() quit 1
	
	do ..updateLoadMonitor()
	
	do ..manageSEOrequest()
	
	do ..injectP3Ppolicy()
	
	do ..sanitiseRequestData()
	
	if ..isCrossSiteScripting() {
		set %response.Redirect=..getRedirectURLforXSS(cspAppName)
		quit "0|0"
	}

	do ..updatePageHistory()

	if pagename="errorpage.csp" quit "0|1"  // will force quit 1 from preHTTP
	
	if ##class(EF.config.clientData).isAppRedirected(appFromURL) {
		set %response.Redirect=..getURLForRedirectedApp(URL)
		quit "0|0"
	}

	if ..isNewFrontendSession(frontback,URL,pagename) {
		set %response.Redirect=..getRedirectURLforNewSession(pagename) // need to get new session set up if we do not have it and redirect to homepage.csp (for example if you go straight to dailyAgenda.csp)
		quit "0|0"
	}

	if ..hasSwitchedLanguage(frontback,URL,pagename) {
		set %response.Redirect=..getRedirectURLforNewLanguage(pagename)
		quit "0|0"
	}				
	
	if ..isBackendPageAuthorised(frontback,pagename)=0 {
		set %response.Redirect=..getRedirectURLforUnauthorisedBackendPage(pagename)
		quit "0|0"
	}
	if ##class(cod.methods).getCurrentBackendUser() {
		if pageID {
			if '(..isPageIDAllowedForBackendSession(pageID,pagename)) {
				set %response.Redirect=..getRedirectURLforUnauthorisedProwebPage(pagename,pageID) 
				quit "0|0"
			}
		}
	}
	do ..updateDebugInfo(URL,pagename)
	
	quit 1  // continue processing
]]></Implementation>
</Method>

<Method name="prePartThree">
<ClassMethod>1</ClassMethod>
<FormalSpec>frontback:%String,bypassLicenseCheck:%Boolean=0</FormalSpec>
<ReturnType>%String</ReturnType>
<Implementation><![CDATA[
	if ..isIncludePage() quit 1
	set ip=%request.GetCgiEnv("REMOTE_ADDR","no ip")
	set URL=$ZCVT(%request.URL,"L")				// this is the url and path: /evdev/frontend/reg/homepage.csp
	set pagename=$ZCVT(%request.PageName,"L")	// this is just the url: homepage.csp
	set userID=$G(%session.Data("eventsforce","backend","xPersonID"),"")
	
	// log page hit
	do ##class(admin.objLog).logNonProwebPage(userID,URL,"eventsForce")
	
	// am I in an include page?
	set includePage=0
	if $L(%request.Get("CSPInclude")) set includePage=1

	// set menu item selected if it's just been clicked
	if %request.Get("ef_sel_menu"),'includePage set %session.Data("eventsforce","frontend","menu","selected")=%request.Get("ef_sel_menu")
	
	// log backend hits
	if userID,%request.Get("storeBack"),'includePage	{
		set category=%request.Get("category")
		set subcategory=%request.Get("subcategory")
		set subsubcategory=%request.Get("subsubcategory")
		set subsubsubcategory=%request.Get("subsubsubcategory")
		// userID == personID
		do ##class(admin.objLogBackend).logPage(userID,%session.SessionId,category,subcategory,subsubcategory,subsubsubcategory)
	}
	
	// above does not work when gateway holds the app name - replaced with below
	set sharedPath="/"_$ZCVT(^%ZCSPAPPS($ZNSPACE),"L")
	set loginPage=sharedPath_"/backend/home/login.csp"
	set accessDenied=sharedPath_"/frontend/static/accessDenied.htm"
	set invalidURLPage=sharedPath_"/frontend/static/invalidURL.htm"

	set %session.Data("eventsforce",frontback,"requestPage")=URL

	// redirect to login if not logged in
	if frontback="backend"	{
		
		// check user has not logged in on one namespace and changed the URL to get into another clients area...
		if $G(%session.Data("eventsforce","backend","NAMESPACE"))'=$ZNSPACE,(URL'["login")&(URL'["tc.csp") set userID=""

		if userID=""&(URL'["login")&(URL'["tc.csp")&(URL'["initialisenamespace.csp")&(URL'["passwordreset") {
		set %session.Data("eventsforce",frontback,"beforeLogin")=URL
			set %response.Redirect=loginPage
			quit "0|0"
		}
		// Update the selectedMenuAccessID from the request variable to allow for multiple windows, tabs, etc..
		if (URL'["login")&(URL'["tc.csp")&(URL'["tc2.csp")&(URL'["logout.csp") {
			if $l(%request.Get("selectedMenuAccessID")) {
				// selectedMenuAccessID is set when clicking on a menu item
				set %session.Data("eventsforce","backend","xSelectedMenuAccessID")=%request.Get("selectedMenuAccessID")
			} elseif $l(%request.Get("xSelectedMenuAccessID")) {
				// Otherwise use xSelectedMenuAccessID
				set %session.Data("eventsforce","backend","xSelectedMenuAccessID")=%request.Get("xSelectedMenuAccessID")
			
			}
			if $L($G(%session.Data("eventsforce","backend","xSelectedMenuAccessID"))) set %response.Context("xSelectedMenuAccessID")=$G(%session.Data("eventsforce","backend","xSelectedMenuAccessID"))
		}

		// Update the event ID from the menu, if we do not have one goto the eventAdminList
		if ..doesBackendPageRequireEventID(pagename) {
			set xEventID=..requestGetEventID() 
			// We shouldn't select an event for dynamic
			if xEventID'="NEW",'##class(access.objFunction).hasFunction(userID,"Dynamic Reports Only") {
				if 'xEventID set xEventID=..getBackendEventIDFromSession()
				if 'xEventID set xEventID=##class(cod.objItemData).get(userID,"last event selected")
				
				// make sure they have access to their previous selected event - you never know...
				if '##class(links.lnkAccessPersonEvent).hasEvent(userID,xEventID) {
					set xEventID=""
					do ##class(cod.objItemData).set(userID,"last event selected","")
				}
				
				// Set the working language if we have just changed event
				if ##class(setup.objSystemTypes).isModuleAllowed("Multi Lingual Frontend") {
					if xEventID'=..getBackendEventIDFromSession() {
						set %session.Data("eventsforce","backend","xWorkLangID")=##class(setup.objEventSetting).getParameter("backend","default creation language",xEventID)
					}
				}
				if '$G(%session.Data("eventsforce","backend","xWorkLangID")) set %session.Data("eventsforce","backend","xWorkLangID")=1
				
				set %session.Data("eventsforce","backend","xEventID")=xEventID
				// redirect to the event selection unless they are support
				if ('xEventID)&&('##class(admin.objUser).isEFuser(userID)) { 
					set %response.Redirect=sharedPath_"/backend/home/eventSelection.csp"
					quit "0|0"
				}
			}
			
		}
		if ##class(setup.objSetting).getParameter("system","backend menu security") {
			// If pagename is a menu item check that they have access to it
			set ok=0
			// Special cases for pages that can be called from elsewhere
			if pagename="gotoonlinereports.csp" {
				if ##class(access.objRole).hasRole(userID,"Single Report") set ok=1
				if ##class(access.objFunction).hasFunctionByAccessID(userID,"ADVSEARCH") set ok=1
			} elseif pagename="delegatesearchsimple.csp" {
				set ok=1
				if ##class(access.objFunction).hasFunction(userID,"Dynamic Reports Only") set ok=0
				// Just about anyone can get to this page
			} elseif pagename="dynarepstart.csp" {
				if (##class(access.objRole).hasRole(userID,"Reports Only")) set ok=1
				if ##class(access.objFunction).hasFunctionByAccessID(userID,"REPS") set ok=1
				if ##class(access.objFunction).hasFunction(userID,"Dynamic Reports Only") set ok=1
			} elseif pagename="eventemails2.csp" {
				for accessID="EMAIL","MAILCAMP" {
					if ##class(access.objFunction).hasFunctionByAccessID(userID,accessID) set ok=1
				}
			} else {
				set ok=1
			}
			if 'ok {
				set %response.Redirect=##class(access.backendPageNav).whichHomepage(userID)
				quit "0|0"
			}
		}
	}

	// make sure frontend people cannot get to any page if event not live
	if $G(%session.Data("eventsforce","frontend","xEventID"))	{
		if $G(^xDEBUG) set ^xDEBUGPAGES($I(^xDEBUGPAGES),$ZTS,"here 8")=%session.Data("eventsforce","frontend","xEventID")
		// if userID is not numeric then we are not someone with a backend session open = general public
		// allow calls from Protx and Worldpay otherwise we cannot give a response for non-live events
		if 'userID&('##class(shared.pageMethodsFrontend).isPageAnAllowedEntryPage(URL)) {
			set objEvent=##class(setup.objEvent).%OpenId(%session.Data("eventsforce","frontend","xEventID"))
			if objEvent.status'="live"	{
				if $G(^xDEBUG) set ^xDEBUGPAGES($I(^xDEBUGPAGES),$ZTS,"here 8.1")=""
				set %response.Redirect=accessDenied
				kill objEvent
				quit "0|0"
			}
			kill objEvent
		}
	}
	
	quit 1  // continue processing
]]></Implementation>
</Method>

<Method name="resolvePath2">
<ClassMethod>1</ClassMethod>
<FormalSpec>inPath</FormalSpec>
<Implementation><![CDATA[
	// split the path up in two pieces no matter the case with our changing the case
	set loPath=$ZCVT(inPath,"L")
	
	//  allow images that don't use the standard images
	if loPath'["/default/" quit inPath
	
	set part1Len=$L($P(loPath,"/default/",1))
	
	// get rid of the "default"
	set part1=$E(inPath,1,part1Len)
	set part1=$p(part1,"/",1,$L(part1,"/")-1)
	
	// get the filename
	set part2Start=part1Len+10
	set part2=$E(inPath,part2Start,999)
	
	// are we in the frontend or the backend?
	set frontback=##class(shared.pCSP).frontBack()
	
	// do we have a client specific subdirectory for images?
	set subDir=$G(%session.Data("eventsforce",frontback,"xClientDir"))
	if subDir="" set subDir="default"

	// find our preferred language
	if frontback="frontend",$G(%session.Data("eventsforce",frontback,"xPrefLangID")) {
		set language=##class(shared.objLanguage).getLanguageDesc(%session.Data("eventsforce",frontback,"xPrefLangID"))
	} else {
		set language=$G(%session.Data("eventsforce",frontback,"xLanguage"))
	}
	
	// fall back to english if no language found (XT page etc)
	if language="" set language="English"

	// merge it all to a path	
	set outPath=part1_"/"_language_"/"_subDir_"/"_part2
	
	quit outPath
]]></Implementation>
</Method>

<Method name="resolveStyle2">
<ClassMethod>1</ClassMethod>
<FormalSpec>inPath</FormalSpec>
<Implementation><![CDATA[
	if $ZCVT(inPath,"L")'["default" quit inPath // spare proweb from path resolving

	// try to split the path up in two pieces no matter the case with our changing the case
	set loPath=$ZCVT(inPath,"L")
	set part1Len=$L($P(loPath,"/default/",1))
	set part1=$E(inPath,1,part1Len)
	set part2Start=part1Len+10
	set part2=$E(inPath,part2Start,999)
	
	set frontback=##class(shared.pCSP).frontBack()
	set subDir=$G(%session.Data("eventsforce",frontback,"xClientStyleDir"))
	if $L(subDir)>1 {
		set outPath=part1_"/"_$G(%session.Data("eventsforce",frontback,"xClientStyleDir"))_"/"_part2
	} else {
		set outPath=inPath	
	}
	
	quit outPath
]]></Implementation>
</Method>

<Method name="frontBack2">
<ClassMethod>1</ClassMethod>
<Implementation><![CDATA[
	set frontback=""
	// try this current page's URL
	if $ZCVT(%request.URL,"L")["/frontend/" set frontback="frontend"
	if $ZCVT(%request.URL,"L")["/backend/" set frontback="backend"
	// now try the previous page's URL (although this can be blocked by lots of firewall s/w)
	if frontback="",$ZCVT($G(%request.CgiEnvs("HTTP_REFERER")),"L")["/frontend/" set frontback="frontend"
	if frontback="",$ZCVT($G(%request.CgiEnvs("HTTP_REFERER")),"L")["/backend/" set frontback="backend"
	// if in template page (dir=/templates/dd)
	if frontback="",$L(%request.Get("frontback")) set frontback=%request.Get("frontback")
	if frontback="" set frontback="frontend"   // last resort, assume frontend to stop any dodgy access going on
	quit frontback
]]></Implementation>
</Method>

<Method name="outputFrontendHeader">
<ClassMethod>1</ClassMethod>
<FormalSpec>IECompatMode=0</FormalSpec>
<Implementation><![CDATA[
	// used to create the http header and can depend on eventID (as some templates may require this)
	set header=""
	set xEventID=$G(%session.Data("eventsforce","frontend","xEventID"))
	if xEventID="" set xEventID=..getBackendEventIDFromSession()

	set layoutTemplateID="",useHTML5=""
	if $G(xEventID) {
		set layoutTemplateID=##class(layout.objTemplate).getLayoutForEvent(xEventID)
		set useHTML5=##class(layout.objTemplate).isTemplateHTML5Compatible(layoutTemplateID)
	}
	
	set xLangID=$G(%session.Data("eventsforce","frontend","xPrefLangID"))
	if xLangID {
		set ISOlang=##class(shared.objLanguage).getISOCode(xLangID)
	} else {
		set ISOlang="en"	
	}
	
	set IEEdgeStr = "<meta http-equiv=""X-UA-Compatible"" content=""IE=edge"">"
	if (IECompatMode){
		set IEEdgeStr = ""
	}
	if xEventID,##class(setup.objEventSetting).getParameter("website","useHTTPheaderHTML4",xEventID)	{
		set header=header_"<!DOCTYPE HTML PUBLIC ""-//W3C//DTD HTML 4.01 Transitional//EN"" ""http://www.w3.org/TR/html4/loose.dtd"">"_IEEdgeStr_$C(13,10)
		set header=header_"<!--[if IE 7 ]>    <html class=""ef_frontend_ie7 ef-ie7"" lang="""_ISOlang_"""> <![endif]-->"_$C(13,10)
		set header=header_"<!--[if IE 8 ]>    <html class=""ef_frontend_ie8 ef-ie8"" lang="""_ISOlang_"""> <![endif]-->"_$C(13,10)
		set header=header_"<!--[if IE 9 ]>    <html class=""ef_frontend_ie9 ef-ie9"" lang="""_ISOlang_"""> <![endif]-->"_$C(13,10)
		set header=header_"<!--[if (gt IE 9)|!(IE)]><!--> <html lang="""_ISOlang_"""> <!--<![endif]-->"_$C(13,10)
		
	} elseif useHTML5 {  // need the html5 doctype for bootstrap responsive designs and also to make moxie tinymce 4.1.5 appear correctly
		set header=header_"<!DOCTYPE html>"_IEEdgeStr_$C(13,10)
		set header=header_"<!--[if IE 7 ]>    <html class=""ef_frontend_ie7 ef-ie7"" xmlns=""http://www.w3.org/1999/xhtml"" lang="""_ISOlang_""" xml:lang="""_ISOlang_"""> <![endif]-->"_$C(13,10)
		set header=header_"<!--[if IE 8 ]>    <html class=""ef_frontend_ie8 ef-ie8"" xmlns=""http://www.w3.org/1999/xhtml"" lang="""_ISOlang_""" xml:lang="""_ISOlang_"""> <![endif]-->"_$C(13,10)
		set header=header_"<!--[if IE 9 ]>    <html class=""ef_frontend_ie9 ef-ie9"" xmlns=""http://www.w3.org/1999/xhtml"" lang="""_ISOlang_""" xml:lang="""_ISOlang_"""> <![endif]-->"_$C(13,10)
		set header=header_"<!--[if (gt IE 9)|!(IE)]><!--> <html xmlns=""http://www.w3.org/1999/xhtml"" lang="""_ISOlang_""" xml:lang="""_ISOlang_"""> <!--<![endif]-->"_$C(13,10)

	} else {
		set header=header_"<!DOCTYPE html PUBLIC ""-//W3C//DTD XHTML 1.0 Transitional//EN"" ""http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"">"_IEEdgeStr_$C(13,10)
		set header=header_"<!--[if IE 7 ]>    <html class=""ef_frontend_ie7 ef-ie7"" xmlns=""http://www.w3.org/1999/xhtml"" lang="""_ISOlang_""" xml:lang="""_ISOlang_"""> <![endif]-->"_$C(13,10)
		set header=header_"<!--[if IE 8 ]>    <html class=""ef_frontend_ie8 ef-ie8"" xmlns=""http://www.w3.org/1999/xhtml"" lang="""_ISOlang_""" xml:lang="""_ISOlang_"""> <![endif]-->"_$C(13,10)
		set header=header_"<!--[if IE 9 ]>    <html class=""ef_frontend_ie9 ef-ie9"" xmlns=""http://www.w3.org/1999/xhtml"" lang="""_ISOlang_""" xml:lang="""_ISOlang_"""> <![endif]-->"_$C(13,10)
		set header=header_"<!--[if (gt IE 9)|!(IE)]><!--> <html xmlns=""http://www.w3.org/1999/xhtml"" lang="""_ISOlang_""" xml:lang="""_ISOlang_"""> <!--<![endif]-->"_$C(13,10)
	}
	quit header
]]></Implementation>
</Method>

<Method name="getDownloadExpiry">
<ClassMethod>1</ClassMethod>
<Implementation><![CDATA[	quit 5
]]></Implementation>
</Method>

<Method name="getFullPathVCard">
<ClassMethod>1</ClassMethod>
<FormalSpec>eventID</FormalSpec>
<Implementation><![CDATA[
	set overridingSSLmode="" // we might want to change parameterthis in the future if IE decides to give us grief with session cookie again
	quit ..getFullPath(eventID,overridingSSLmode)
]]></Implementation>
</Method>

<Method name="getFullPath">
<Description>
use this method to get the domain and cspapp name along with http or https
returns something like this: https://www.eventsforce.net/support2</Description>
<ClassMethod>1</ClassMethod>
<FormalSpec>eventID="",overridingSSLmode=""</FormalSpec>
<ReturnType>%String</ReturnType>
<Implementation><![CDATA[
 
	set browserDomain=""
	if $D(%request) set browserDomain=$ZCVT(%request.GetCgiEnv("SERVER_NAME"),"L") // use this to determine which backend domain to use/return
	// if calling from a non-web page then should be event related and pick up the event setting

	set useSSL=##class(setup.objSetting).getParameter("system","requires SSL")
	if overridingSSLmode'="" set useSSL=overridingSSLmode
	set fullURL=""

	// only use the event settings if we have specifically set the system setting (to make sure all values are set up correctly at event level)
	if eventID	{
		set fullURL=##class(setup.objEventSetting).getParameter("system","domain",eventID)
	}

	// get backend URLS
	if fullURL="" {
		set dom=##class(setup.objSetting).getParameter("system","domain 1")
		if $L(dom) set domains(dom)=""
		set dom=##class(setup.objSetting).getParameter("system","domain 2")
		if $L(dom) set domains(dom)=""
		set dom=##class(setup.objSetting).getParameter("system","domain 3")
		if $L(dom) set domains(dom)=""
		set dom=##class(setup.objSetting).getParameter("system","domain 4")
		if $L(dom) set domains(dom)=""
		set dom=##class(setup.objSetting).getParameter("system","domain 5")
		if $L(dom) set domains(dom)=""
		
		// check against current
		if $L(browserDomain) {
			set fullURL=browserDomain
			if '$D(domains(browserDomain)) set fullURL=##class(setup.objSetting).getParameter("system","domain 1")
		} else {
			// if not running from browser
			set fullURL=##class(setup.objSetting).getParameter("system","domain 1")
		}
	}
	if fullURL="" set fullURL="www.eventsforce.net"

	// add on the csp app name
	set fullURL=fullURL_"/"_##class(EF.config.clientData).getCSPAppForCurrentNameSpace()

	// make sure always lower case so when cookie path is used, it picks up correct cookie
	set fullURL=$ZCVT(fullURL,"L")
	
	// SSL or not?
	if useSSL	{
		set fullURL="https://"_fullURL
	} else {
		set fullURL="http://"_fullURL
	}
	
	quit fullURL
]]></Implementation>
</Method>

<Method name="removeOpenedImage">
<Description>
removes the image that updates eventsforce to tell us that the email has been opened.
we are doing this because this is not the real mail openeing, it is just a preview or a mainatence thing
pass in mailDate in $H format</Description>
<ClassMethod>1</ClassMethod>
<FormalSpec>xEventID,tempStream:%Library.Stream,mailDate=""</FormalSpec>
<ReturnType>%Library.Stream</ReturnType>
<Implementation><![CDATA[
	set domain=$P(##class(shared.pageMethods).getFullPath(xEventID),"/",3)
	if mailDate="" set mailDate=+$H	
	
	if mailDate<62498 { // 11-Feb-2012
		// email sent before March 2012 did not have the 'ef_xtmo' class on the opening image so we have to remove all images from the preview - Fred Feb 2012
		set orgString="<img src='http"
		set newString="<img alt='http"
		do tempStream.CopyFrom(##class(shared.streamFunctions).replaceString(tempStream,orgString,newString))																			
	}
	
	// made the opened mail image more specific so that only the mail opened link gets replaced not other images on the page
	set orgString2="<img class=""ef_xtmo"" src='http"   
	set newString2="<img class=""ef_xtmo"" alt='http"   // don't load the image or we will loose the session
	do tempStream.CopyFrom(##class(shared.streamFunctions).replaceString(tempStream,orgString2,newString2))																			
	
	// also remove <HTML> and <BODY> tags from the email stream while we are at it
	for tag="<!DOCTYPE html>","<HTML>","</HTML>","<BODY>","</BODY>" {
		do tempStream.CopyFrom(##class(shared.streamFunctions).replaceString(tempStream,tag,""))																			
	}
	
	
	do tempStream.Rewind()
	quit tempStream
]]></Implementation>
</Method>

<Method name="cleanIntRedirect">
<Description>
clean the passed in URL to make sure only allow an internal redirection</Description>
<ClassMethod>1</ClassMethod>
<FormalSpec>url</FormalSpec>
<ReturnType>%String</ReturnType>
<Implementation><![CDATA[
	if '##class(setup.objSetting).getParameter("system","clean internal redirects") quit url

	set invalidURL=0
	
	set url=$TR(url,"\","/")
	
	// get rid of the http bit at the front
	set lowerURL=$ZCVT(url,"L")
	if $E(lowerURL,1,7)="http://"	{
		set url=$E(url,8,$L(url))
		set invalidURL=1
	} elseif $E(lowerURL,1,8)="https://"	{
		set url=$E(url,9,$L(url))
		set invalidURL=1
	} elseif $E(lowerURL,1,5)="data:"	{
		set url=$E(url,6,$L(url))
		set invalidURL=1
	} else {
		// nothing
	}
	
	// if url has a domain name at the front, reject it
	if url["/" {
		set firstBit=$P(url,"/",1)
	} else {
		set firstBit=url
	}
	
	set allowedExtensions("CSP")=1
	set allowedExtensions("HTM")=1
	set allowedExtensions("HTML")=1
	set allowedExtensions("PDF")=1
	set domA=$P(firstBit,".",1),domB=$ZCVT($P(firstBit,".",2),"U")
	if $L(domA),$L(domB) set invalidURL=1
	if $L(domA),$L(domB),$G(allowedExtensions(domB)) set invalidURL=0  // allow CSP pages and other types in redirects...
	
	set sharedPath="/"_$ZCVT(^%ZCSPAPPS($ZNSPACE),"L")
	set invalidURLPage=sharedPath_"/frontend/static/invalidURL.htm?sr=224"
	if invalidURL set url=invalidURLPage

	quit url
]]></Implementation>
</Method>

<Method name="getPageID">
<Description>
 method to be used to get pageID to make sure it's "clean"</Description>
<ClassMethod>1</ClassMethod>
<FormalSpec>fromRequest=1,setIntoSession=1</FormalSpec>
<ReturnType>%String</ReturnType>
<Implementation><![CDATA[
	set pageID=""
	if ..doesPageHaveAProwebPageID(%request.PageName) {
		if fromRequest set pageID=+%request.Get("pageID")
		if 'pageID set pageID=%session.Get("pageID") 
	}
	if 'pageID {
		set pageID = %request.Get("pageID")
	}
	quit pageID
]]></Implementation>
</Method>

<Method name="isPageIDValidForEvent">
<ClassMethod>1</ClassMethod>
<FormalSpec><![CDATA[eventID,pageID,&redirectURL]]></FormalSpec>
<Implementation><![CDATA[
	set out=1,redirectURL=""
	set pageEventID=##class(sc.methods).getEventIDfromPageID(pageID)
	if pageEventID {
		if eventID'=pageEventID {
			set out=0
			set redirectURL=..getFullPath(eventID)_"/frontend/reg/homepage.csp?traceRedir=5&eventID="_pageEventID_"&pageID="_pageID
		}
	}
	quit out
]]></Implementation>
</Method>

<UDLText name="T">
<Content><![CDATA[
// retrieve parameters without caring about upper/lower case

]]></Content>
</UDLText>

<Method name="getParamCaseInsensitive">
<ClassMethod>1</ClassMethod>
<FormalSpec>parameter</FormalSpec>
<Implementation><![CDATA[
	set out=""
	set m=""
	for  {
		set m=$O(%request.Data(m))
		if m="" quit
		set array($ZCVT(m,"L"))=%request.Get(m)	
	}
	set out=$G(array($ZCVT(parameter,"L")))
	
	if (parameter="pageID")!(parameter="eventID") set out=+out  // have to make sure this is numeric otherwise vulnerable to cross site scripting attacks by changing the value in URL
	quit out
]]></Implementation>
</Method>

<Method name="recoverEventID">
<ClassMethod>1</ClassMethod>
<Implementation><![CDATA[
	set eventID=""

	// try for duplicate, case insensitive parameters
 	set m="",hit=0
 	for  {
 		set m=$O(%request.Data(m))
 		if m="" quit
 		for index=1:1:3 {
 			if $ZCVT(m,"U")="EVENTID" {
	 			set hit=hit+1
	 			set tmp=$G(%request.Data(m,index))
	 			if tmp {
		 			set eventID=tmp
	 			}
 			}
 		}
 	}
 	if hit>1 merge ^%xNoEv(1,$p($ZTS,",",2),$ZNSPACE,%request.GetCgiEnv("REMOTE_ADDR","no ip")," 00","recover eventID from duplicate param array")=%request.Data

	set eventID=+eventID   // have to make sure this is numeric otherwise vulnerable to cross site scripting attacks by changing the value in URL
	if 'eventID set eventID=""   // seems there are loads of places checking eventID=""
	quit eventID
]]></Implementation>
</Method>

<Method name="requestGetEventID">
<Description>
this method replaces intersystems %request.Get-method because that one doesn't handle duplicate parameters</Description>
<ClassMethod>1</ClassMethod>
<Implementation><![CDATA[
	set eventID=""
	
	//try regular method first
	set eventID=+%request.Get("eventID")  //  have to make sure this is numeric (so plussed it) otherwise vulnerable to cross site scripting attacks by changing the value in URL
	if eventID quit eventID 
	
	// try recover it if it was passed infrom fHome.csp
	set eventID=$G(%session.Data("eventsforce","frontend","fHome passed in xEventID"))
	if eventID {
		set ^%xNoEv(1,$p($ZTS,",",2),$ZNSPACE,%request.GetCgiEnv("REMOTE_ADDR","no ip")," 00","recovered eventID from fHome via session")=eventID 
		quit eventID
	}
	
	// not try case insenstive serach including duplicated params
	set eventID=..recoverEventID()

	if 'eventID set eventID=""   // seems there are loads of places checking eventID=""
	quit eventID
]]></Implementation>
</Method>

<Method name="getSurveyID">
<Description>
Is the page we're in a survey page</Description>
<ClassMethod>1</ClassMethod>
<FormalSpec>pageID=""</FormalSpec>
<ReturnType>%String</ReturnType>
<Implementation><![CDATA[
	set surveyID=""
	if 'pageID {
		set pageID=..getPageID()
	}
	
	if pageID {
		set parent="",grandParent=""
		&SQL(SELECT parent,parent->parent INTO :parent,:grandParent FROM sc.objData WHERE ID = :pageID)
		if +SQLCODE=0 {
			&SQL(SELECT description INTO :tmp FROM sc_xModules.objGroup WHERE ID = :grandParent)
			if +SQLCODE=0,$ZCVT(tmp,"U")="SURVEYS" {
				set surveyID=parent
			}
			
		}
	}
	quit surveyID
]]></Implementation>
</Method>

<Method name="switchEvent">
<Description>
newEventID can be blank </Description>
<ClassMethod>1</ClassMethod>
<FormalSpec>xPersonID,newEventID</FormalSpec>
<ProcedureBlock>1</ProcedureBlock>
<Implementation><![CDATA[
	do ..clearDownBackendVariables()
	do ..setupBackendEventVariables(newEventID)
	if newEventID do ..addToLastEventSelected(xPersonID,newEventID)
	if newEventID do ..addToMRU(xPersonID,newEventID)
	do ..clearBackendMenuCache()
	quit
]]></Implementation>
</Method>

<Method name="addToLastEventSelected">
<ClassMethod>1</ClassMethod>
<FormalSpec>xPersonID,xEventID</FormalSpec>
<ProcedureBlock>1</ProcedureBlock>
<Implementation><![CDATA[
	if ##class(setup.objEvent).%ExistsId(xEventID) {
		do ##class(cod.objItemData).set(xPersonID,"last event selected",xEventID)
	}
]]></Implementation>
</Method>

<Method name="addToMRU">
<ClassMethod>1</ClassMethod>
<FormalSpec>xPersonID,xEventID</FormalSpec>
<ProcedureBlock>1</ProcedureBlock>
<Implementation><![CDATA[
	if ##class(setup.objEvent).%ExistsId(xEventID) {
		set maxLinks=##class(setup.objSetting).getParameter("homepage","Number of items on Most Recently Used Event list")
		set delim=","
		set MRUlist=##class(cod.objItemData).get(xPersonID,"Most Recently Used Events")
		set addEventToList=1
		for i=1:1:$L(MRUlist,delim) {
			set tmpEventID=$P(MRUlist,delim,i)
			set mru(i)=tmpEventID
			if xEventID=tmpEventID set addEventToList=0
		}
		if addEventToList set mru(i+1)=xEventID

		// new rebuild the string 
		set newMRUlist="",i=""
		for j=1:1:maxLinks {
			set i=$O(mru(i),-1) 
			if i="" quit
			set newMRUlist=mru(i)_$S($L(newMRUlist):delim,1:"")_newMRUlist
		}

		if newMRUlist'=MRUlist { 
			do ##class(cod.objItemData).set(xPersonID,"Most Recently Used Events",newMRUlist)
		}
	}
]]></Implementation>
</Method>

<Method name="clearDownBackendSession">
<Description>
clears the backend session from all session variables when logging out</Description>
<ClassMethod>1</ClassMethod>
<Implementation><![CDATA[
	kill %session.Data("eventsforce","backend")
	kill %session.Data("eventsforce","frontend")
	kill %session.Data("password validated")
	do ##class(shared.pageMethods).clearBackendMenuCache()
]]></Implementation>
</Method>

<UDLText name="T">
<Content><![CDATA[
// this can be called while still being logged in to the backend.

]]></Content>
</UDLText>

<Method name="clearDownBackendVariables">
<Description>
this is clearing all "backend" except the items listed here</Description>
<ClassMethod>1</ClassMethod>
<ProcedureBlock>1</ProcedureBlock>
<Implementation><![CDATA[
	set keep("NAMESPACE")=1
	set keep("xClientDir")=1
	set keep("xClientStyleDir")=1
	set keep("xPersonID")=1
	set keep("xUserID")=1

	set keep("xLangID")=1
	set keep("xLanguage")=1
	set keep("xWorkLangID")=1  // need this for page switching to remember current language

	set keep("xDateFormat")=1
	set keep("xTimeFormat")=1
	
	set keep("xEventID")=1
	
	set keep("orgunit event caching")=1
	
	
	// Settings that only affect your current session
	set keep("proweb emergency repair mode")=1
	set keep("override test colours")=1
	set keep("showLegacyMode")=1
	
	set keep("GlobalSystemSettings")=1
	
	set var=""
	for  {
		set var=$O(%session.Data("eventsforce","backend",var))
		if var="" quit
		
		if '$D(keep(var)) kill %session.Data("eventsforce","backend",var)
	}
]]></Implementation>
</Method>

<Method name="setupBackendEventVariables">
<ClassMethod>1</ClassMethod>
<FormalSpec>xEventID</FormalSpec>
<ProcedureBlock>1</ProcedureBlock>
<Implementation><![CDATA[
	set %session.Data("eventsforce","backend","xEventID")=xEventID
	set %session.Data("eventsforce","backend","xWorkLangID")=##class(setup.objEventSetting).getParameter("backend","default creation language",xEventID)
	if '$G(%session.Data("eventsforce","backend","xWorkLangID")) set %session.Data("eventsforce","backend","xWorkLangID")=1
]]></Implementation>
</Method>

<Method name="createBackendVariables">
<ClassMethod>1</ClassMethod>
<ProcedureBlock>0</ProcedureBlock>
<Implementation><![CDATA[
	if '$GET(xCreatedBackendVariables) {
		set xCreatedBackendVariables = 1

		set sessionID=%session.SessionId

		set xLangID=$G(%session.Data("eventsforce","backend","xLangID"))
		set xLanguage=$G(%session.Data("eventsforce","backend","xLanguage"))
		set xEventID=..getBackendEventIDFromSession()
		set xPersonID=$G(%session.Data("eventsforce","backend","xPersonID"))
		set xUserID=xPersonID
		set xEventDescription=$G(%session.Data("eventsforce","backend","xEventDescription"))

		set xControllerID=""
		if xEventID	{
			set xControllerID=##class(setup.objEvent).getControllerID(xEventID)
		}

		set xDateFormat=##class(setup.objSetting).getParameter("system","defaultDateFormat")
		set xDateFormat=##class(shared.dateFunctions).getBackendOutputDateFormat()
		if xDateFormat="" set xDateFormat=5 // dd/mmm/yyyy
		set xUserInputDateFormat=##class(shared.dateFunctions).getBackendInputDateFormat()
		set xFrontendInputDateFormat=""
		if xEventID {
			set xFrontendInputDateFormat=##class(setup.objEvent).getDateFormat(xEventID)
		}
		set %session.Data("eventsforce","backend","xDateFormat")=xDateFormat
		// using a new var for standard reports - this will get overridden by backendTopExcel so that CSV dates outputted are in an excel friendly form (format 25)  xDateReportFormat
		set xDateFormatForReports=xDateFormat

		set xTimeFormat=##class(shared.timeFunctions).getBackendOutputTimeFormat()
		if xEventID {
			set xFrontendTimeFormat=##class(setup.objEventSetting).getParameter("system","time format",xEventID)
		}
		set %session.Data("eventsforce","backend","xTimeFormat")=xTimeFormat
		
	}
]]></Implementation>
</Method>

<Method name="getWorkLangID">
<ClassMethod>1</ClassMethod>
<FormalSpec>eventID</FormalSpec>
<ReturnType>%String</ReturnType>
<Implementation><![CDATA[
	if $D(%request) set xWorkLangID=%request.Get("xWorkLangID")
	if xWorkLangID="",$D(%session) set xWorkLangID=$G(%session.Data("eventsforce","backend","xWorkLangID"))
	if xWorkLangID="" set xWorkLangID=##class(setup.objEventSetting).getParameter("backend","default creation language",eventID)
	if xWorkLangID="",$D(%session) set xWorkLangID=$G(%session.Data("eventsforce","backend","xWorkLangID"))
	if xWorkLangID="" set xWorkLangID=1

	if $D(%session) set %session.Data("eventsforce","backend","xWorkLangID")=xWorkLangID
	return xWorkLangID
]]></Implementation>
</Method>

<Method name="getBackendEventIDFromSession">
<ClassMethod>1</ClassMethod>
<Implementation><![CDATA[	return $G(%session.Data("eventsforce","backend","xEventID"))
]]></Implementation>
</Method>

<Method name="clearBackendMenuCache">
<ClassMethod>1</ClassMethod>
<Implementation><![CDATA[	kill ^CacheTempUserMenu(%session.SessionId)
]]></Implementation>
</Method>

<Method name="tempPurchaseHasValidBooker">
<Description>
This method checks if the Booker's Identification property is set correctly. This method will be used to nullify booking if the event is using 'email' or 'username' as the identification 
and somehow those values disappear from the current session just before the booking is saved in the database.</Description>
<ClassMethod>1</ClassMethod>
<FormalSpec>eventID:%String,sessionID:%String</FormalSpec>
<Implementation><![CDATA[
	set ok=1
	set tempBookerID=##class(eCom.tempPerson).getBookerID(sessionID)
	if 'tempBookerID set ok=0
	
	// check if the booker's email address is populated correctly otherwise, report error.
	if ((ok) && ('##class(setup.objEventSetting).getParameter("system","do not use email",eventID))) {
	    set identifyBy = $S(##class(setup.objEventSetting).getParameter("system","identifying field",eventID)="username":"username",1:"email")
	    if '$L(##class(eCom.tempCodData).get(tempBookerID,identifyBy)) {
		    set ok=0
	    }
	}
	quit ok
]]></Implementation>
</Method>

<Method name="isEditMode">
<Description>
This method checks if the 'Edit' or 'Preview' flags are set for a proweb page. If so, it returns 1.
Browser dependent %request and %session objects are used here. So, it cannot be used anywhere other than CSP pages.</Description>
<ClassMethod>1</ClassMethod>
<Implementation><![CDATA[
	set editMode = 0
	if %request.Get("hideButtons") set editMode=1
	if %session.Get("mode")="edit",'$G(%session.Data("inSitePageEditing")) set editMode=1
	quit editMode
]]></Implementation>
</Method>

<Method name="getEditMode">
<Description>
This returns the mode of the page E.g. Edit, Preview
Checks the request and the session so that it can be used in the page before the mode is set in the session
Browser dependent %request and %session objects are used here. So, it cannot be used anywhere other than CSP pages.</Description>
<ClassMethod>1</ClassMethod>
<ReturnType>%String</ReturnType>
<Implementation><![CDATA[
	
	set mode=%request.Get("mode")
	if '$l(mode) {
		set mode=%session.Get("mode")
	}
	
	quit mode
]]></Implementation>
</Method>

<Method name="addRequestDataForCurrentPageToURL">
<ClassMethod>1</ClassMethod>
<FormalSpec>inURL:%String</FormalSpec>
<Implementation><![CDATA[
	#dim returnURL As %String = inURL
	
	// Stop new gateway param:
	//   The CSPRQN parameter is the CSP Gateway Request ID, which is sent to Caché with each HTTP request. 
	//   Where available, the request ID is always recorded in the Gateway Event Log header records as a hexadecimal number (e.g. Request-ID: 3a).
	set exclude("CSPRQN")=""
	
	// should probably create a list of allowed parameters at some point
	set paramName=""
	for  {
		set paramName=$o(%request.Data(paramName))
		if paramName="" quit
		
 		set addParam=1
 		if returnURL[(paramName_"=") set addParam=0  // stop duplicates
 		if $D(exclude(paramName)) set addParam=0

		if addParam {
	 		set value=%request.Get(paramName)
	 		set returnURL=##class(EF.htmlGenerator).addParameterToURL(returnURL,paramName,value)
		}
	}
	
	return returnURL
]]></Implementation>
</Method>

<Method name="requestDataToParams">
<Description>
go through %request.Data and create a string to add to URLs
Deprecated as does not encode parameters - use addRequestDataForCurrentPageToURL instead</Description>
<ClassMethod>1</ClassMethod>
<FormalSpec>exclusionList=""</FormalSpec>
<Implementation><![CDATA[
	if '$D(%request) quit ""
	
	// convert exclusion list into array
	for i=1:1:$L(exclusionList,",") {
		set tmpM=$P(exclusionList,",",i)
		if $L(tmpM) set exclude(tmpM)=""
	}

	// should probably create a list of allowed parameters at some point
	set params="",m=""
	for  {
		set m=$o(%request.Data(m))
		if m="" quit
		
 		set addparam=1
 		if params[m_"=" set addparam=0  // stop duplicates
 		if $D(exclude(m)) set addparam=0
 		// Stop new gateway param:
 		//   The CSPRQN parameter is the CSP Gateway Request ID, which is sent to Caché with each HTTP request. 
 		//   Where available, the request ID is always recorded in the Gateway Event Log header records as a hexadecimal number (e.g. Request-ID: 3a).
 		if m="CSPRQN" set addparam=0  

		if addparam {
	 		//implement later: set tmpData=##class(%CSP.Page).EscapeURL(%request.Get(m))
	 		set tmpData=%request.Get(m)
			set params=params_$S($L(params):"&",1:"")_m_"="_tmpData
		}
	}
	
	// returns string without leading & or ? - calling program to add as appropriate
	quit params
]]></Implementation>
</Method>

<Method name="isRequestSecure">
<Description>
method for determining if the incoming request is secure or not </Description>
<ClassMethod>1</ClassMethod>
<ReturnType>%Boolean</ReturnType>
<Implementation><![CDATA[
	set out=0
	
	// in cases where the certificate is terminated on the actual web server
	if %request.Secure=1 set out=1				

	// in cases where the certificate is terminated on the load balancer
	if %request.GetCgiEnv("SERVER_PORT")=8443 set out=1
	
	quit out
]]></Implementation>
</Method>

<Method name="addParamsToURL">
<Description>
Pass in a valid inURL and it will append a parameter string to it
*** Deprecated as it does not encode the parameter, should instead use ##class(EF.htmlGenerator).addParameterToURL(inURL, name, value) ***</Description>
<ClassMethod>1</ClassMethod>
<FormalSpec>inURL,params</FormalSpec>
<ReturnType>%String</ReturnType>
<Implementation><![CDATA[
	// Remove leading  ? or &
	if ($e(params,1)="?")!($e(params,1)="&") {
		set params=$e(params,2,$l(params))
	}
	if $l(params) {
		if inURL["?" {
			set outURL=inURL_"&"_params
		} else {
			set outURL=inURL_"?"_params
		}
	} else {
		set outURL=inURL
	}
	quit outURL
]]></Implementation>
</Method>

<Method name="buildFrontendSessionVariablesFromEventID">
<ClassMethod>1</ClassMethod>
<FormalSpec>xEventID</FormalSpec>
<Implementation><![CDATA[
	set %session.Data("eventsforce","frontend","xEventID")=xEventID
	set %session.Data("eventsforce","frontend","xClientDir")=##class(setup.objSetting).getParameter("paths","clientDirectory")
	set language=##class(setup.objEventSetting).getParameter("system","language",xEventID)   // v1.1.5
	set %session.Data("eventsforce","frontend","xLanguage")=language
	set %session.Data("eventsforce","frontend","xLangID")=##class(shared.objLanguage).getLanguageID(language)
	set xLangID=%session.Data("eventsforce","frontend","xLangID")
	set %session.Data("eventsforce","frontend","xDateFormat")=##class(setup.objEvent).getDateFormat(xEventID)
]]></Implementation>
</Method>

<Method name="getDisplayDescription">
<Description>
get displayable descriptions for certain words</Description>
<ClassMethod>1</ClassMethod>
<FormalSpec>inStr:%String</FormalSpec>
<Implementation><![CDATA[
	Set ret=inStr
	
	If (inStr="bookers") {
		Set ret=##class(shared.pCSP).out("Registration contacts")
	} elseif (inStr="delegates") {
		Set ret=##class(shared.pCSP).out("Attendees")
	} elseif (inStr="cancelled delegates") {
		Set ret=##class(shared.pCSP).out("Cancelled attendees")
	} elseif (inStr="BookingRef") {
		Set ret=##class(shared.pCSP).out("Registration ref")
	} elseif (inStr="BookerName") {
		Set ret=##class(shared.pCSP).out("Registration contact's name")
	} elseif (inStr="BookingType") {
		Set ret=##class(shared.pCSP).out("Registration type")
	} elseif (inStr="AdditionalBookingStatus") {
		Set ret=##class(shared.pCSP).out("Additional registration status")
	}
	
	Quit ret
]]></Implementation>
</Method>

<Method name="doesBackendPageRequireEventID">
<ClassMethod>1</ClassMethod>
<FormalSpec>pagename</FormalSpec>
<ReturnType>%Boolean</ReturnType>
<Implementation><![CDATA[
	if (pagename["login") return 0
	if (pagename["tc.csp") return 0
	if (pagename["tc2.csp") return 0
	if (pagename["eventselection") return 0
	if (pagename["pagecontrollergrid") return 0
	if (pagename["eventcalendarmonthly.csp") return 0
	if (pagename["eventproperties") return 0
	if (pagename["eventcopy") return 0
	if (pagename["logout.csp") return 0
	if (pagename["mydetails.csp") return 0
	if (pagename["changepassword.csp") return 0
	if (pagename["changepasswordmodal.csp") return 0
	if (pagename["pagecontrollerstandardsave.csp") return 0
	if (pagename["pagecontrollerajaxsave.csp") return 0
	if (pagename["addusermetrics.csp") return 0
	if (pagename["passwordreset") return 0
	if (pagename["backendmenuredirect.csp") return 0
	if (pagename["serverstoragesetjson.csp") return 0
	
	return 1
]]></Implementation>
</Method>

<Method name="isPageEventRelated">
<ClassMethod>1</ClassMethod>
<FormalSpec>pagename</FormalSpec>
<ReturnType>%Boolean</ReturnType>
<Implementation><![CDATA[
	set pagename=$ZCVT(pagename,"L")
	if pagename="sessiondump.csp" return 0
	if pagename="sysgettotallogins.csp" return 0
	if pagename="homepage.csp" return 0
	if pagename="initsession.csp" return 0
	if pagename="fhome.csp"	return 0
	return 1
]]></Implementation>
</Method>

<Method name="endSession">
<Description><![CDATA[
Ends current session and clears down cookies
<br/>Should still have %session available in page
<br/>Must be called from preHTTP]]></Description>
<ClassMethod>1</ClassMethod>
<Implementation><![CDATA[
	Set %session.EndSession=1
 	Set Expires=+$H-1
 	Set Expires=$ZD(Expires,11) _ ", " _ $ZD(Expires,2) _ " 00:00:00 GMT"
 	do %response.SetCookie("CSPSESSIONID-SP-8443-UP-","",Expires,"/",,1,1)
]]></Implementation>
</Method>

<Method name="isApplicationStopped">
<ClassMethod>1</ClassMethod>
<ReturnType>%Boolean</ReturnType>
<Implementation><![CDATA[
	// stop application access while upgrading - will unfortunately output the ugly http header underneath the message.
	if $G(^%ZStopApplication($ZNSPACE)) {
		write "<b>Site unavailable, please come back later</b><br><br><br><br>Check in ^%ZStopApplication<br><br>"
		return 1
	}
	return 0
]]></Implementation>
</Method>

<Method name="isIncludePage">
<ClassMethod>1</ClassMethod>
<ReturnType>%Boolean</ReturnType>
<Implementation><![CDATA[
	// quit the whole method if were are a measly include page of little importance
	if $L(%request.Get("CSPInclude")) {
		set pages="frontendHTTPheader.csp,frontendStyles.csp,frontendJS.csp,colourScheme.csp,progress.csp,frontEndButton.csp,commonHTTPheader.csp,socialMediaButtons.csp,frontendBottom.csp,"
		if $ZCVT(pages,"U")[$ZCVT($P(%request.Get("CSPInclude"),"/",$L(%request.Get("CSPInclude"))),"U") return 1
	}	
	return 0
]]></Implementation>
</Method>

<Method name="updateLoadMonitor">
<ClassMethod>1</ClassMethod>
<Implementation><![CDATA[
	// update the current load monitor
	set currentMinute=($P($ZT($P($H,",",2),2),":",2)+1) // 10:23 -> 24 and 13:00 -> 1
	kill ^["EVCOMMON"]qLoadMonitor($S(currentMinute=60:1,1:currentMinute+1)) // kill the next minute
 	if $ZCVT("start.csp","U")'[$ZCVT(%request.PageName,"U") {
		set ^["EVCOMMON"]qLoadMonitor(currentMinute)=$G(^["EVCOMMON"]qLoadMonitor(currentMinute))+1
	}
]]></Implementation>
</Method>

<Method name="manageSEOrequest">
<ClassMethod>1</ClassMethod>
<Implementation><![CDATA[
	set fromSEO=0
	if ##class(setup.seoFiles).isSEOrequest()	{
		set fromSEO=1  // has this request originated from the mini virtual website (SEO mode)?
		do ##class(setup.seoFiles).addSEOcodePre()
	}
	if 'fromSEO do %response.SetHeader("X-Robots-Tag","noindex")   // to stop Google from showing the page link even if it finds it as a link from another site
]]></Implementation>
</Method>

<Method name="injectP3Ppolicy">
<ClassMethod>1</ClassMethod>
<Implementation><![CDATA[
	// fix the problem with IE and privacy when in IFRAMES/FRAMESETS - but needs to be done on all resources that are setting cookies (css/js etc.) so done in IIS instead.
	if ##class(setup.objSetting).getParameter("system","Inject P3P policy") {
		do %response.SetHeader("P3P","CP=""Internet Explorer requires this in order to set session cookies""")
	}
]]></Implementation>
</Method>

<Method name="sanitiseRequestData">
<ClassMethod>1</ClassMethod>
<Implementation><![CDATA[
	set name=""
	for  {
 		set name=$O(%request.Data(name))
 		if name="" quit
 		if $E(name,1,6)="Error:" continue  // errors contain control chars...
 		set value=%request.Get(name)
 		if '$IsObject(value) {
			set %request.Data(name,1) = ##class(EF.sanitiser).sanitise(value)
 		}
	}
]]></Implementation>
</Method>

<Method name="isCrossSiteScripting">
<ClassMethod>1</ClassMethod>
<ReturnType>%Boolean</ReturnType>
<Implementation><![CDATA[
	// check for cross scripting
 	set sharedPageM="",crossScriptingAttack=0
 	set sharedPageAllowedVars("CSPToken")=""
 	set sharedPageAllowedVars("CSPPAGE")=""
 	set sharedPageAllowedVars("Error:ErrorCode")=""
	// backend
 	set sharedPageAllowedVars("editBox")=""
 	set sharedPageAllowedVars("rawText")=""
 	set sharedPageAllowedVars("txtPrompt")=""
 	set sharedPageAllowedVars("textHTML")=""
 	set sharedPageAllowedVars("requiredAnswer")="" // contains pattern matches that are sensitive
 	set sharedPageAllowedVars("txtEmailDetailsPageRawSubject")="" 

	// exclude the style edit boxes and URL field for the menu blocks (proweb\menudetails.csp)
 	set sharedPageAllowedVars("txtULStyle")=""
  	set sharedPageAllowedVars("txtLIStyle")=""
 	set sharedPageAllowedVars("txtLISelectedStyle")=""
 	set sharedPageAllowedVars("txtAStyle")=""
 	set sharedPageAllowedVars("txtAHoverStyle")=""
 	set sharedPageAllowedVars("txtASelectedStyle")=""
 	set sharedPageAllowedVars("txtMILIStyle")=""
 	set sharedPageAllowedVars("txtMILISelectedStyle")=""
 	set sharedPageAllowedVars("txtMIAStyle")=""
 	set sharedPageAllowedVars("txtMIAHoverStyle")=""
 	set sharedPageAllowedVars("txtMIASelectedStyle")=""
 	set sharedPageAllowedVars("txtMILinkURL")=""
	set sharedPageAllowedVars("txtUserMessageBodyBE")=""
 	set sharedPageAllowedVars("moxieElement*")=""
 	set sharedPageAllowedVars("hiddenmoxieElement*")=""
 	
 	set allowedHTMLTagsVar("abstractTitle")=""
 	set allowedHTMLTagsVar("txtMailFrom")=""
 	
 	set stopExtraScripting=1
 	
 	set pagesAllowedToSubmitHTML("pagecontrollerstandardsave.csp")=""
 	set pagesAllowedToSubmitHTML("pagecontrollerajaxsave.csp")=""
 	set pagesAllowedToSubmitHTML("serverstoragesetjson.csp")=""

 	set currentPageName=$ZCVT(%request.PageName,"L")
	set pageName=""
	for	 {
		set pageName=$O(pagesAllowedToSubmitHTML(pageName))
		if pageName="" quit
		
		if $ZCVT(pageName,"U")=$ZCVT(currentPageName,"U") {
	 		set stopExtraScripting=0	
		}
 	}
 	
 	
 	for  {
 		set sharedPageM=$O(%request.Data(sharedPageM))
 		if sharedPageM="" quit
 		
 		set isExcluded=0
 		if $D(sharedPageAllowedVars(sharedPageM)) set isExcluded=1
 		if $D(sharedPageAllowedVars($P(sharedPageM,"_",1)_"*")) set isExcluded=1 // note that the field name must contain underscore for wildcards to work

 		if isExcluded=0 {
	 		// it seems that %3c gets converted to < when stored in %request but I'll leave the one above in case
	 		if $ZCVT(%request.Get(sharedPageM),"L")["%3cscript" set crossScriptingAttack=1
	 		if $ZCVT(%request.Get(sharedPageM),"L")["<script" set crossScriptingAttack=1
	 		if $ZCVT(%request.Get(sharedPageM),"L")["javascript:",%request.Get(sharedPageM)'="badgePrint()" set crossScriptingAttack=1

			if stopExtraScripting {
				// more restrictions
		 		if $ZCVT(%request.Get(sharedPageM),"L")["%3cimg" set crossScriptingAttack=1
		 		if $ZCVT(%request.Get(sharedPageM),"L")["<img" set crossScriptingAttack=1
		 		if $ZCVT(%request.Get(sharedPageM),"L")["onerror" set crossScriptingAttack=1
				// remove CRLF from var names (can't do the values as we may get posting of text areas with CRLFs
				if sharedPageM[$C(13) set crossScriptingAttack=1
				if sharedPageM[$C(10) set crossScriptingAttack=1
		
				// do a catch all for HTML code submitted in any var
				// don't stop it, just change it so that the value stored is not a real HTML character but should be displayed OK as a lt sign
				// allow the email from fields in preregister.csp as now can add names too: "Jeremy Ward" <jeremy@eventsforce.com>
				if (('$D(allowedHTMLTagsVar(sharedPageM)))
					&& (%request.Get(sharedPageM)["<")
					&& (sharedPageM'["txtEmailFrom")
					&& (sharedPageM'["txtFromAddress")
					) {
					set tmpVar=%request.Get(sharedPageM)
					set tmpVar=##class(shared.stringFunctions).hyperTranslate(tmpVar,"<","&lt;")
					set %request.Data(sharedPageM,1)=tmpVar
				}
				if (('$D(allowedHTMLTagsVar(sharedPageM)))
					&& (%request.Get(sharedPageM)[">")
					&& (sharedPageM'["txtEmailFrom")
					&& (sharedPageM'["txtFromAddress")
					) {
					set tmpVar=%request.Get(sharedPageM)
					set tmpVar=##class(shared.stringFunctions).hyperTranslate(tmpVar,">","&gt;")
					set %request.Data(sharedPageM,1)=tmpVar
				}
				if (('$D(allowedHTMLTagsVar(sharedPageM)))
					&& (%request.Get(sharedPageM)[$C(34))
					&& (sharedPageM'["txtEmailFrom")
					&& (sharedPageM'["txtFromAddress")
					) {
					set tmpVar=%request.Get(sharedPageM)
					set tmpVar=##class(shared.stringFunctions).hyperTranslate(tmpVar,$C(34),"&quot;")
					set %request.Data(sharedPageM,1)=tmpVar
				}
			}
			
			if %request.Method="GET" {		
				if %request.Get(sharedPageM)[$C(13) set crossScriptingAttack=1
				if %request.Get(sharedPageM)[$C(10) set crossScriptingAttack=1
			}
 		}
 		
		// exit now if cross scripting found, then store the sharedPageM var found for future reference
 		if crossScriptingAttack quit
 	}
	if crossScriptingAttack	{
		// Store this for now - in case we have issues with some fields not covered by above. 
		// Longer term we should remove this to avoid storage issues if massive requests by a hacker.
		set tmpKey=$I(^%ZCrossScripting($ZNSPACE,+$ZTS))
		set ^%ZCrossScripting($ZNSPACE,+$ZTS,tmpKey,"name")=sharedPageM
		if $L(sharedPageM) set ^%ZCrossScripting($ZNSPACE,+$ZTS,tmpKey,"value")=%request.Get(sharedPageM)
		set cspAppName=$ZCVT(^%ZCSPAPPS($ZNSPACE),"L")
		return 1
	} else {
		return 0	
	}
]]></Implementation>
</Method>

<Method name="hasStringBeenSanitisedForCrossSiteScripting">
<ClassMethod>1</ClassMethod>
<FormalSpec>inString</FormalSpec>
<ReturnType>%Boolean</ReturnType>
<Implementation><![CDATA[
	set out=0
	if inString["&lt;" set out=1
	if inString["&gt;" set out=1
	if inString["&quot;" set out=1

	quit out
]]></Implementation>
</Method>

<Method name="getURLforMaintenancePage">
<ClassMethod>1</ClassMethod>
<FormalSpec>cspAppName</FormalSpec>
<ReturnType>%String</ReturnType>
<Implementation><![CDATA[	return "/"_cspAppName_"/system/maintenancePage.htm"
]]></Implementation>
</Method>

<Method name="getRedirectURLforXSS">
<ClassMethod>1</ClassMethod>
<FormalSpec>cspAppName</FormalSpec>
<ReturnType>%String</ReturnType>
<Implementation><![CDATA[	return "/"_cspAppName_"/frontend/static/invalidURL.htm?reason=csa"
]]></Implementation>
</Method>

<Method name="updatePageHistory">
<ClassMethod>1</ClassMethod>
<Implementation><![CDATA[
	//  store page history
	set hdate=+$ZTS,htime=$P($ZTS,",",2)  
	set ^xPage(hdate,%session.SessionId,htime,$I(^xPage(hdate,%session.SessionId,htime)))=%session.AppTimeout_"|"_%request.URL_"|"_%request.PageName_"|"_%request.Get("CSPInclude")_"|SSL:"_..isRequestSecure()
]]></Implementation>
</Method>

<Method name="isNewFrontendSession">
<ClassMethod>1</ClassMethod>
<FormalSpec>frontback,URL,pagename</FormalSpec>
<ReturnType>%Boolean</ReturnType>
<Implementation><![CDATA[
	set allowREDIRmethod=1
	if $G(^%xPAGESTOPREDIRMETHOD)=1 set allowREDIRmethod=0
	
	// need to get new session set up if we do not have it and redirect to homepage.csp (for example if you go straight to dailyAgenda.csp)
	if frontback="frontend" {
		if allowREDIRmethod {
			if (URL'["/xt/") {
				if $G(%session.Data("eventsforce","frontend","xEventID"))="" {
					if ..requestGetEventID() {
						if '$G(%session.Data("proweb","isSurvey")) { // need to ignore if survey page, since survey pages are not tied to events
							if ..isPageEventRelated(pagename) {
								return 1	 
							}
						}
					}
				}
			}
		}
	}
	return 0
]]></Implementation>
</Method>

<Method name="getRedirectURLforNewSession">
<ClassMethod>1</ClassMethod>
<FormalSpec>pagename</FormalSpec>
<ReturnType>%String</ReturnType>
<Implementation><![CDATA[
	set pagename=$ZCVT(pagename,"L")
	set tmpEID=..requestGetEventID()
	set redirpage=..getFullPath(tmpEID)_"/frontend/reg/homepage.csp?traceRedir=2&eventID="_tmpEID
	
	// special treatment for these pages so that when in SEO mode, clicking on a link to them will redirect via homepage (as there will be no session set up initially)
	// don't want to do for all pages to avoid people bookmarking pages within the registration process etc.
	if (pagename="registernew.csp")!(pagename="registeramend.csp")!(pagename="dailyagenda.csp")!(pagename="dailyagendaalt.csp")	{
		set redirpage=redirpage_"&page="_pagename
	} elseif (pagename="tregisteremailnew.csp") {
		set redirpage=redirpage_"&page=registerNew.csp"
	} elseif (pagename="tregisteremailamend.csp") {
		set redirpage=redirpage_"&page=registerAmend.csp"
	} elseif (pagename="tdailyagenda.csp") {
		set redirpage=redirpage_"&page=dailyAgenda.csp"
	} elseif (pagename="tdailyagendaalt.csp") {
		set redirpage=redirpage_"&page=dailyAgendaalt.csp"
	} elseif (pagename="home")!(pagename="thome.csp")!(pagename="homepage.csp") {
		// use default redirpage
	} elseif %request.Get("pageID") {
		set redirpage=redirpage_"&pageID="_%request.Get("pageID")
	}
	if %request.Get("language") set redirpage=redirpage_"&language="_%request.Get("language")

	// log this
	set hdate=+$ZTS,htime=$P($ZTS,",",2) 
	set ^xPage(hdate,%session.SessionId,htime,$I(^xPage(hdate,%session.SessionId,htime)),"redirmethod")=redirpage

	return redirpage
]]></Implementation>
</Method>

<Method name="hasSwitchedLanguage">
<ClassMethod>1</ClassMethod>
<FormalSpec>frontback,URL,pagename</FormalSpec>
<ReturnType>%Boolean</ReturnType>
<Implementation><![CDATA[
	set allowLANGmethod=1
	if $G(^%xPAGESTOPLANGMETHOD)=1 set allowLANGmethod=0

	// check the language - if a different language is passed as parameter then redirect to homepage
	if frontback="frontend" {
		if allowLANGmethod {
			if (URL'["/xt/"),%request.Get("language"),pagename'="homepage.csp",pagename'="fhome.csp"	{
				// if current lang is not what is on URL, redirect to home to switch it
				if %request.Get("language")'=$G(%session.Data("eventsforce","frontend","xPrefLangID"))	{
					return 1
				}
			}
		}
	}
	return 0
]]></Implementation>
</Method>

<Method name="getRedirectURLforNewLanguage">
<ClassMethod>1</ClassMethod>
<FormalSpec>pagename</FormalSpec>
<ReturnType>%String</ReturnType>
<Implementation><![CDATA[
	set ip=%request.GetCgiEnv("REMOTE_ADDR","no ip")
	set tmpEventID=..requestGetEventID() 
	if 'tmpEventID set tmpEventID=$G(%session.Data("eventsforce","frontend","xEventID"))
	if 'tmpEventID,%request.Get("pageID") {
		set tmpEventID=##class(sc.methods).getEventIDfromPageID(%request.Get("pageID")) 
		set ^%xNoEv(1,$p($ZTS,",",2),$ZNSPACE,ip,-16,"recover eventID from pageID")=tmpEventID
	}

	set redirpage=..getFullPath(tmpEventID)_"/frontend/reg/homepage.csp?traceRedir=3&eventID="_tmpEventID

	// special treatment for these pages so that when in SEO mode, clicking on a link to them will redirect via homepage (as there will be no session set up initially)
	// don't want to do for all pages to avoid people bookmarking pages within the registration process etc.
	if (pagename="registernew.csp")!(pagename="registeramend.csp")!(pagename="dailyagenda.csp")!(pagename="dailyagendaalt.csp")	{
		set redirpage=redirpage_"&page="_pagename
	}

	// log this
	set hdate=+$ZTS,htime=$P($ZTS,",",2) 
	set ^xPage(hdate,%session.SessionId,htime,$I(^xPage(hdate,%session.SessionId,htime)),"langmethod")=redirpage
	
	return redirpage
]]></Implementation>
</Method>

<Method name="isBackendPageAuthorised">
<ClassMethod>1</ClassMethod>
<FormalSpec>frontback,pagename</FormalSpec>
<ReturnType>%Boolean</ReturnType>
<Implementation><![CDATA[
	// check if authorised to view the page (backend stuff)
	set allowAUTHmethod=1
	if $G(^%xPAGESTOPAUTHMETHOD)=1 set allowAUTHmethod=0
	
	set xPersonID=$G(%session.Data("eventsforce","backend","xPersonID"))
	set auth=1
	if frontback="backend" {
		if allowAUTHmethod {
			if pagename="userlist.csp",'##class(access.objFunction).hasFunctionByAccessID(xPersonID,"SYSUSER") set auth=0
			if pagename="userdetails.csp",'##class(access.objFunction).hasFunctionByAccessID(xPersonID,"SYSUSER") set auth=0
			if pagename="userdetails2.csp",'##class(access.objFunction).hasFunctionByAccessID(xPersonID,"SYSUSER") set auth=0
			if pagename="userrolelist.csp",'##class(access.objFunction).hasFunctionByAccessID(xPersonID,"SYSROLE") set auth=0
			if pagename="userroledetails.csp",'##class(access.objFunction).hasFunctionByAccessID(xPersonID,"SYSROLE") set auth=0
			if pagename="userroledetails2.csp",'##class(access.objFunction).hasFunctionByAccessID(xPersonID,"SYSROLE") set auth=0
		}	
	}
	return auth
]]></Implementation>
</Method>

<Method name="isPageIDAllowedForBackendSession">
<ClassMethod>1</ClassMethod>
<FormalSpec>pageID,pageName</FormalSpec>
<Implementation><![CDATA[
	set pageName=$ZCVT(pageName,"L")
	if (..frontBack2()'="frontend")&&(pageName'="codquestiondetails.csp")&&(pageName'="codquestiondetails2.csp") {
		return 1	
	}
	if '##class(cod.methods).getCurrentBackendUser() {
		throw ##class(shared.exceptions.generalException).%New("No backend person ID for isPageIDAllowedForBackendSession")
	}
	if ##class(sc.pageMethods).isPageInFrontendRuntimeMode() {
		return 1	
	}
	if ##class(sc.xModules.objPage).%ExistsId(pageID) {
		set eventIDForPage=##class(sc.methods).getEventIDfromPageID(pageID)
		if 'eventIDForPage {
			return 1	
		}
		if eventIDForPage=..getBackendEventIDFromSession() {
			return 1
		}
	}
	return 0
]]></Implementation>
</Method>

<Method name="getRedirectURLforUnauthorisedBackendPage">
<ClassMethod>1</ClassMethod>
<FormalSpec>pagename</FormalSpec>
<ReturnType>%String</ReturnType>
<Implementation><![CDATA[
	set xPersonID=$G(%session.Data("eventsforce","backend","xPersonID"))
	// redirect to simple unauthorised page if not allowed
	// log this
	set hdate=+$ZTS,htime=$P($ZTS,",",2)
	set ^xPage(hdate,%session.SessionId,htime,$I(^xPage(hdate,%session.SessionId,htime)),"authmethod")=xPersonID_"|"_pagename
	
	return "../../backend/home/unauth.csp"
]]></Implementation>
</Method>

<Method name="getRedirectURLforUnauthorisedProwebPage">
<ClassMethod>1</ClassMethod>
<FormalSpec>pagename,pageID</FormalSpec>
<ReturnType>%String</ReturnType>
<Implementation><![CDATA[
	set xPersonID=$G(%session.Data("eventsforce","backend","xPersonID"))

	// redirect to simple unauthorised page if not allowed
	// log this
	set hdate=+$ZTS,htime=$P($ZTS,",",2)
	set ^xPage(hdate,%session.SessionId,htime,$I(^xPage(hdate,%session.SessionId,htime)),"authmethodpageid")=xPersonID_"|"_pagename_"|"_pageID
	
	return "../../frontend/static/invalidURL.htm"
]]></Implementation>
</Method>

<Method name="updateDebugInfo">
<ClassMethod>1</ClassMethod>
<FormalSpec>URL,pagename</FormalSpec>
<Implementation><![CDATA[
	// store a page history to aid debugging
	if $G(^xDEBUG) set ^xDEBUGPAGES($I(^xDEBUGPAGES),$ZTS,URL)=$G(%session.Data("eventsforce","frontend","xEventID"))
	if $G(^xDEBUG) set ^xDEBUGPAGES($I(^xDEBUGPAGES),$ZTS,"pagename")=pagename
]]></Implementation>
</Method>

<Method name="setHTTPHeaderForJSON">
<ClassMethod>1</ClassMethod>
<Implementation><![CDATA[
	Set %response.ContentType="application/json"
	Set %response.CharSet="utf-8" //Required by cache, even though to the json standard specifies that CharSet should not be output in the header.
]]></Implementation>
</Method>

<Method name="getBackendWorkLangID">
<Description>
sets up the session variables based on the xWorkLangID. If that is not found, we fall back to xLangID which is the passed in default language. </Description>
<ClassMethod>1</ClassMethod>
<FormalSpec>xLangID</FormalSpec>
<Implementation><![CDATA[
	set xWorkLangID=%request.Get("xWorkLangID")
	if xWorkLangID="" set xWorkLangID=$G(%session.Data("eventsforce","backend","xWorkLangID"))
	if xWorkLangID="" set xWorkLangID=xLangID
	set %session.Data("eventsforce","backend","xWorkLangID")=xWorkLangID	
	quit xWorkLangID
]]></Implementation>
</Method>

<Method name="getPageLanguageID">
<ClassMethod>1</ClassMethod>
<FormalSpec>pageID</FormalSpec>
<Implementation><![CDATA[
	set languageID=1
	&SQL(select description INTO :pageDescription FROM sc_xmodules.objpage WHERE id=:pageID)
	if +SQLCODE=0 {
		set languageName=$P(pageDescription," - ",2) // remove the language name	
		if $L(languageName) set languageID=##class(shared.objLanguage).getLanguageID(languageName)
	} else {
		throw ##class(shared.exceptions.generalSQLException).CreateFromSQLCODE(SQLCODE,$GET(%msg))	
	}
	quit languageID
]]></Implementation>
</Method>

<Method name="getURLForRedirectedApp">
<ClassMethod>1</ClassMethod>
<FormalSpec>url</FormalSpec>
<ReturnType>%Library.String</ReturnType>
<Implementation><![CDATA[
	set eventID=..requestGetEventID()
	set path=$P(url,"/",3,$l(url,"/"))
	set extraParams=##class(shared.pageMethods).requestDataToParams("CSPToken,CSPCHD")
	set url=..getFullPath(eventID)_"/"_path
	if $l(extraParams) {
		set url=url_"?"_extraParams
	}
	return url
]]></Implementation>
</Method>

<Method name="setPageIDIntoSession">
<ClassMethod>1</ClassMethod>
<FormalSpec>pageID</FormalSpec>
<Implementation><![CDATA[	set %session.Data("pageID")=pageID
]]></Implementation>
</Method>

<Method name="doesPageHaveAProwebPageID">
<ClassMethod>1</ClassMethod>
<FormalSpec>pageName</FormalSpec>
<Implementation><![CDATA[
	set pageName=$ZCVT(pageName,"L")
	if pageName="start.csp" {
		return 1
	} elseif ##class(sc.objTemplate).isPageNameProwebTemplate(pageName) {
		return 1
	}
	return 0
]]></Implementation>
</Method>

<Method name="getFrontendLanguageID">
<ClassMethod>1</ClassMethod>
<Implementation><![CDATA[	return $G(%session.Data("eventsforce","frontend","xPrefLangID"))
]]></Implementation>
</Method>

<Method name="getPathWithoutApplicationFromURL">
<Description>
E.g https://dev.efsys.net/largedevsrc/backend/dashboard/dashboard.csp returns backend/dashboard/dashboard.csp</Description>
<ClassMethod>1</ClassMethod>
<FormalSpec>url</FormalSpec>
<ReturnType>%String</ReturnType>
<Implementation><![CDATA[	return $p(url,"/",3,99)
]]></Implementation>
</Method>

<Method name="getBackendKendoBaseURL">
<ClassMethod>1</ClassMethod>
<FormalSpec>pageGeneration</FormalSpec>
<Implementation><![CDATA[
	if pageGeneration<4 {
		return "https://da7xgjtj801h2.cloudfront.net/2013.2.716/"
		
	} else {
		return "https://da7xgjtj801h2.cloudfront.net/2015.2.624/"	
	}
]]></Implementation>
</Method>
</Class>
</Export>
